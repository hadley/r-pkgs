<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to create a package, the fundamental unit of shareable, reusable, and reproducible R code.">
<title>10&nbsp; Dependencies: Mindset and Background – R Packages (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dependencies-in-practice.html" rel="next">
<link href="./description.html" rel="prev">
<link href="./images/cover-2e-small.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8c563c05ac8c1d64e78fdaf2b4701079.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./description.html">Package metadata</a></li><li class="breadcrumb-item"><a href="./dependencies-mindset-background.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Packages (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r-pkgs/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Package structure and state</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamental development workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The package within</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Package components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other components</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Package metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Testing basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Designing your test suite</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced testing techniques</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Function documentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Vignettes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other markdown files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Website</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Maintenance and distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Software development practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-dependencies-pros-cons" id="toc-sec-dependencies-pros-cons" class="nav-link active" data-scroll-target="#sec-dependencies-pros-cons"><span class="header-section-number">10.1</span> When should you take a dependency?</a>
  <ul class="collapse">
<li><a href="#dependencies-are-not-equal" id="toc-dependencies-are-not-equal" class="nav-link" data-scroll-target="#dependencies-are-not-equal"><span class="header-section-number">10.1.1</span> Dependencies are not equal</a></li>
  <li><a href="#prefer-a-holistic-balanced-and-quantitative-approach" id="toc-prefer-a-holistic-balanced-and-quantitative-approach" class="nav-link" data-scroll-target="#prefer-a-holistic-balanced-and-quantitative-approach"><span class="header-section-number">10.1.2</span> Prefer a holistic, balanced, and quantitative approach</a></li>
  <li><a href="#sec-dependencies-tidyverse" id="toc-sec-dependencies-tidyverse" class="nav-link" data-scroll-target="#sec-dependencies-tidyverse"><span class="header-section-number">10.1.3</span> Dependency thoughts specific to the tidyverse</a></li>
  <li><a href="#sec-dependencies-imports-vs-suggests" id="toc-sec-dependencies-imports-vs-suggests" class="nav-link" data-scroll-target="#sec-dependencies-imports-vs-suggests"><span class="header-section-number">10.1.4</span> Whether to Import or Suggest</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-namespace" id="toc-sec-dependencies-namespace" class="nav-link" data-scroll-target="#sec-dependencies-namespace"><span class="header-section-number">10.2</span> Namespace</a>
  <ul class="collapse">
<li><a href="#sec-dependencies-namespace-motivation" id="toc-sec-dependencies-namespace-motivation" class="nav-link" data-scroll-target="#sec-dependencies-namespace-motivation"><span class="header-section-number">10.2.1</span> Motivation</a></li>
  <li><a href="#sec-dependencies-NAMESPACE-file" id="toc-sec-dependencies-NAMESPACE-file" class="nav-link" data-scroll-target="#sec-dependencies-NAMESPACE-file"><span class="header-section-number">10.2.2</span> The <code>NAMESPACE</code> file</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-search" id="toc-sec-dependencies-search" class="nav-link" data-scroll-target="#sec-dependencies-search"><span class="header-section-number">10.3</span> Search path</a>
  <ul class="collapse">
<li><a href="#sec-dependencies-search-path-user" id="toc-sec-dependencies-search-path-user" class="nav-link" data-scroll-target="#sec-dependencies-search-path-user"><span class="header-section-number">10.3.1</span> Function lookup for user code</a></li>
  <li><a href="#function-lookup-inside-a-package" id="toc-function-lookup-inside-a-package" class="nav-link" data-scroll-target="#function-lookup-inside-a-package"><span class="header-section-number">10.3.2</span> Function lookup inside a package</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-attach-vs-load" id="toc-sec-dependencies-attach-vs-load" class="nav-link" data-scroll-target="#sec-dependencies-attach-vs-load"><span class="header-section-number">10.4</span> Attaching versus loading</a>
  <ul class="collapse">
<li><a href="#sec-dependencies-imports-vs-depends" id="toc-sec-dependencies-imports-vs-depends" class="nav-link" data-scroll-target="#sec-dependencies-imports-vs-depends"><span class="header-section-number">10.4.1</span> Whether to Import or Depend</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/dependencies-mindset-background.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./description.html">Package metadata</a></li><li class="breadcrumb-item"><a href="./dependencies-mindset-background.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-dependencies-mindset-background" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>You take a dependency when your package uses functionality from another package (or other external tool). In <a href="description.html#sec-description-imports-suggests" class="quarto-xref"><span>Section 9.6</span></a>, we explained how to declare a dependency on another package by listing it in <code>DESCRIPTION</code>, usually in <code>Imports</code> or <code>Suggests</code>. But that still leaves many issues for you to think about:</p>
<ul>
<li><p>When should you take a dependency? What are the risk and rewards? In <a href="#sec-dependencies-pros-cons" class="quarto-xref"><span>Section 10.1</span></a> we provide a framework for deciding whether a dependency is worth it. This chapter also includes specific sections for deciding between <code>Imports</code> and <code>Suggests</code> (<a href="#sec-dependencies-imports-vs-suggests" class="quarto-xref"><span>Section 10.1.4</span></a>) and between <code>Imports</code> and <code>Depends</code> (<a href="#sec-dependencies-imports-vs-depends" class="quarto-xref"><span>Section 10.4.1</span></a>).</p></li>
<li><p>How should you use different kinds of dependencies in different contexts? I.e. imported vs.&nbsp;suggested packages, used inside your functions vs tests vs documentation. We have to defer this to the next chapter (<a href="dependencies-in-practice.html" class="quarto-xref"><span>Chapter 11</span></a>), because the justification for those recommendations relies on some additional technical background that we develop here.</p></li>
</ul>
<p>A key concept for understanding how packages are meant to work together is that of a namespace (<a href="#sec-dependencies-namespace" class="quarto-xref"><span>Section 10.2</span></a>). Although it can be a bit confusing, R’s namespace system is vital for the package ecosystem. It is what ensures that other packages won’t interfere with your code, that your code won’t interfere with other packages, and that your package works regardless of the environment in which it’s run. We will show how the namespace system works alongside and in concert with the user’s search path (<a href="#sec-dependencies-search" class="quarto-xref"><span>Section 10.3</span></a>).</p>
<p>This chapter contains material that could be skipped (or skimmed) when making your first package, when you’re probably happy just to make a package that works! But you’ll want to revisit the material in this chapter as your packages get more ambitious and sophisticated.</p>
<section id="sec-dependencies-pros-cons" class="level2" data-number="10.1"><h2 data-number="10.1" class="anchored" data-anchor-id="sec-dependencies-pros-cons">
<span class="header-section-number">10.1</span> When should you take a dependency?</h2>
<p><em>This section is adapted from the “It Depends” <a href="https://www.tidyverse.org/blog/2019/05/itdepends/">blog post</a> and <a href="https://www.rstudio.com/resources/rstudioconf-2019/it-depends-a-dialog-about-dependencies/">talk</a> authored by Jim Hester.</em></p>
<p>Software dependencies are a double-edged sword. On one hand, they let you take advantage of others’ work, giving your software new capabilities and making its behaviour and interface more consistent with other packages. By using a pre-existing solution, you avoid re-implementing functionality, which eliminates many opportunities for you to introduce bugs. On the other hand, your dependencies will likely change over time, which could require you to make changes to your package, potentially increasing your maintenance burden. Your dependencies can also increase the time and disk space needed when users install your package. These downsides have led some to suggest a ‘dependency zero’ mindset. We feel that this is bad advice for most projects, and is likely to lead to lower functionality, increased maintenance, and new bugs.</p>
<section id="dependencies-are-not-equal" class="level3" data-number="10.1.1"><h3 data-number="10.1.1" class="anchored" data-anchor-id="dependencies-are-not-equal">
<span class="header-section-number">10.1.1</span> Dependencies are not equal</h3>
<p>One problem with simply minimizing the absolute number of dependencies is that it treats all dependencies as equivalent, as if they all have the same costs and benefits (or even, infinite costs and no benefits). However, in reality, this is far from the truth. There are many axes upon which dependencies can differ, but some of the most important include:</p>
<ul>
<li><p>The type of the dependency. Some dependencies come bundled with R itself (e.g.&nbsp;base, utils, stats) or are one of the ‘Recommended’ packages (e.g.&nbsp;Matrix, survival). These packages are very low cost to depend on, as they are (nearly) universally installed on all users’ systems, and mostly change only with new R versions. In contrast, there is a higher cost for a dependency that comes from, e.g., a non-CRAN repository, which requires users to configure additional repositories before installation.</p></li>
<li><p>The number of upstream dependencies, i.e.&nbsp;recursive dependencies. For example, the <a href="https://rlang.r-lib.org">rlang</a> package is intentionally managed as a low-level package and has no upstream dependencies apart from R itself. At the other extreme, there are packages on CRAN with ~250 recursive dependencies.</p></li>
<li><p>Already fulfilled dependencies. If your package depends on dplyr then taking a dependency on tibble does not change the dependency footprint, as dplyr itself already depends on tibble. Additionally, some of the most popular packages (e.g.&nbsp;ggplot2) will already be installed on the majority of users’ machines. So adding a ggplot2 dependency is unlikely to incur additional installation costs in most cases.</p></li>
<li>
<p>The burden of installing the package. Various factors make a package more costly to install, in terms of time, space, and human aggravation:</p>
<ul>
<li><p>Time to compile: Packages that contain C/C++ can take very different amounts of time to install depending on the complexity of the code. For example, the <a href="https://glue.tidyverse.org">glue</a> package takes ~5 seconds to compile on CRAN’s build machines, whereas the <a href="https://readr.tidyverse.org">readr</a> package takes ~100 seconds to install on the same machines.</p></li>
<li><p>Binary package size: Users installing binary packages need to download them, so the size of the binary is relevant, particularly for those with slow internet connections. This also varies a great deal across packages. The smallest packages on CRAN are around 1 Kb in size, while the <a href="https://cran.r-project.org/package=h2o">h2o</a> package is 170 Mb, and there are Bioconductor binaries that are over 4 Gb!</p></li>
<li><p>System requirements: Some packages require additional system dependencies in order to be used. For instance, the <a href="https://cran.r-project.org/package=rjags">rjags</a> package requires a matching installation of the JAGS library. Another example is <a href="https://cran.r-project.org/package=rJava">rJava</a> which requires a Java SDK and also has additional steps needed to configure R for the proper Java installation, which has caused <a href="https://stackoverflow.com/questions/tagged/rjava">installation issues for many people</a>.</p></li>
</ul>
</li>
<li><p>Maintenance capacity. It is reasonable to have higher confidence in a package that is well-established and that is maintained by developers or teams with a long track record and that maintain many other packages. This increases the likelihood that the package will remain on CRAN without interruptions and that the maintainer has an intentional approach to the software life cycle (<a href="lifecycle.html" class="quarto-xref"><span>Chapter 21</span></a>).</p></li>
<li><p>Functionality. Some packages implement a critical piece of functionality that is used across many packages. In the tidyverse, broadly defined, the rlang, tidyselect, vctrs, and tibble packages are all examples of this. By using these packages for tricky tasks like non-standard evaluation or manipulation of vectors and data frames, package authors can avoid re-implementing basic functionality. It’s easy to think “how hard can it be to write my own X?” when you are focused on the Happy Path<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. But a huge part of the value brought by packages like vctrs or tibble is letting someone else worry about edge cases and error handling<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> . There is also value in having shared behaviour with other packages, e.g.&nbsp;the tidyverse rules for <a href="https://vctrs.r-lib.org/reference/vec_as_names.html">name repair</a> or <a href="https://vctrs.r-lib.org/reference/vector_recycling_rules.html">recycling</a>.</p></li>
</ul>
<p>The specifics above hopefully make it clear that package dependencies are not equal.</p>
</section><section id="prefer-a-holistic-balanced-and-quantitative-approach" class="level3" data-number="10.1.2"><h3 data-number="10.1.2" class="anchored" data-anchor-id="prefer-a-holistic-balanced-and-quantitative-approach">
<span class="header-section-number">10.1.2</span> Prefer a holistic, balanced, and quantitative approach</h3>
<p>Instead of striving for a minimal number of dependencies, we recommend a more holistic, balanced, and quantitative approach.</p>
<p>A holistic approach looks at the project as a whole and asks “who is the primary audience?”. If the audience is other package authors, then a leaner package with fewer dependencies may be more appropriate. If, instead, the target user is a data scientist or statistician, they will likely already have many popular dependencies installed and would benefit from a more feature-full package.</p>
<p>A balanced approach understands that adding (or removing) dependencies comes with trade-offs. Adding a dependency gives you additional features, bug fixes, and real-world testing, at the cost of increased installation time, disk space, and maintenance, if the dependency has breaking changes. In some cases, it makes sense to <em>increase</em> dependencies for a package, even if an implementation already exists. For instance, base R has a number of different implementations of non-standard evaluation with varying semantics across its functions. The same used to be true of tidyverse packages as well, but now they all depend on the implementations in the <a href="https://tidyselect.r-lib.org">tidyselect</a> and <a href="https://rlang.r-lib.org">rlang</a> packages. Users benefit from the improved consistency of this feature and individual package developers can let the maintainers of tidyselect and rlang worry about the technical details.</p>
<p>In contrast, removing a dependency lowers installation time, disk space, and avoids potential breaking changes. However, it means your package will have fewer features or that you must re-implement them yourself. That, in turn, takes development time and introduces new bugs. One advantage of using an existing solution is that you’ll get the benefit of all the bugs that have already been discovered and fixed. Especially if the dependency is relied on by many other packages, this is a gift that keeps on giving.</p>
<p>Similar to optimizing performance, if you are worried about the burden of dependencies, it makes sense to address those concerns in a specific and quantitative way. The experimental <a href="https://github.com/r-lib/itdepends">itdepends</a> package was created for the <a href="https://www.rstudio.com/resources/rstudioconf-2019/it-depends-a-dialog-about-dependencies/">talk</a> and <a href="https://www.tidyverse.org/blog/2019/05/itdepends/">blog post</a> this section is based on. It is still a useful source of concrete ideas (and code) for analyzing how heavy a dependency is. The <a href="https://pak.r-lib.org/">pak</a> package also has several functions that are useful for dependency analysis:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_deps_tree.html">pkg_deps_tree</a></span><span class="op">(</span><span class="st">"tibble"</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble 3.1.8 ✨</span></span>
<span><span class="co">#&gt; ├─fansi 1.0.3 ✨</span></span>
<span><span class="co">#&gt; ├─lifecycle 1.0.3 ✨</span></span>
<span><span class="co">#&gt; │ ├─cli 3.4.1 ✨ ⬇ (1.28 MB)</span></span>
<span><span class="co">#&gt; │ ├─glue 1.6.2 ✨</span></span>
<span><span class="co">#&gt; │ └─rlang 1.0.6 ✨ ⬇ (1.81 MB)</span></span>
<span><span class="co">#&gt; ├─magrittr 2.0.3 ✨</span></span>
<span><span class="co">#&gt; ├─pillar 1.8.1 ✨ ⬇ (673.95 kB)</span></span>
<span><span class="co">#&gt; │ ├─cli</span></span>
<span><span class="co">#&gt; │ ├─fansi</span></span>
<span><span class="co">#&gt; │ ├─glue</span></span>
<span><span class="co">#&gt; │ ├─lifecycle</span></span>
<span><span class="co">#&gt; │ ├─rlang</span></span>
<span><span class="co">#&gt; │ ├─utf8 1.2.2 ✨</span></span>
<span><span class="co">#&gt; │ └─vctrs 0.5.1 ✨ ⬇ (1.82 MB)</span></span>
<span><span class="co">#&gt; │   ├─cli</span></span>
<span><span class="co">#&gt; │   ├─glue</span></span>
<span><span class="co">#&gt; │   ├─lifecycle</span></span>
<span><span class="co">#&gt; │   └─rlang</span></span>
<span><span class="co">#&gt; ├─pkgconfig 2.0.3 ✨</span></span>
<span><span class="co">#&gt; ├─rlang</span></span>
<span><span class="co">#&gt; └─vctrs</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Key:  ✨ new |  ⬇ download</span></span>
<span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_deps_explain.html">pkg_deps_explain</a></span><span class="op">(</span><span class="st">"tibble"</span>, <span class="st">"rlang"</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble -&gt; lifecycle -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; pillar -&gt; lifecycle -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; pillar -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; pillar -&gt; vctrs -&gt; lifecycle -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; pillar -&gt; vctrs -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; vctrs -&gt; lifecycle -&gt; rlang</span></span>
<span><span class="co">#&gt; tibble -&gt; vctrs -&gt; rlang</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-dependencies-tidyverse" class="level3" data-number="10.1.3"><h3 data-number="10.1.3" class="anchored" data-anchor-id="sec-dependencies-tidyverse">
<span class="header-section-number">10.1.3</span> Dependency thoughts specific to the tidyverse</h3>
<p>The packages maintained by the tidyverse team play different roles in the ecosystem and are managed accordingly. For example, the tidyverse and devtools packages are essentially meta-packages that exist for the convenience of an end-user. Consequently, it is recommended that other packages <strong>should not depend</strong> on tidyverse<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> or devtools (<a href="setup.html#sec-setup-usage" class="quarto-xref"><span>Section 2.2</span></a>), i.e.&nbsp;these two packages should almost never appear in <code>Imports</code>. Instead, a package maintainer should identify and depend on the specific package that actually implements the desired functionality.</p>
<p>In the previous section, we talked about different ways to gauge the weight of a dependency. Both the tidyverse and devtools can be seen as heavy due to the very high number of recursive dependencies:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_hard_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pkg</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">deps</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/package_dependencies.html">package_dependencies</a></span><span class="op">(</span><span class="va">pkg</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">deps</span>, <span class="va">length</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">n_hard_deps</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"devtools"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tidyverse  devtools </span></span>
<span><span class="co">#&gt;       113       100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In contrast, several packages are specifically conceived as low-level packages that implement features that should work and feel the same across the whole ecosystem. At the time of writing, this includes:</p>
<ul>
<li>rlang, to support tidy eval and throw errors</li>
<li>cli and glue, for creating a rich user interface (which includes errors)</li>
<li>withr, for managing state responsibly</li>
<li>lifecycle, for managing the life cycle of functions and arguments</li>
</ul>
<p>These are basically regarded as free dependencies and can be added to <code>DESCRIPTION</code> via <code><a href="https://usethis.r-lib.org/reference/tidyverse.html">usethis::use_tidy_dependencies()</a></code> (which also does a few more things). It should come as no surprise that these packages have a very small dependency footprint.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/package_dependencies.html">package_dependencies</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"rlang"</span>, <span class="st">"cli"</span>, <span class="st">"glue"</span>, <span class="st">"withr"</span>, <span class="st">"lifecycle"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $rlang</span></span>
<span><span class="co">#&gt; [1] "utils"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cli</span></span>
<span><span class="co">#&gt; [1] "utils"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $glue</span></span>
<span><span class="co">#&gt; [1] "methods"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $withr</span></span>
<span><span class="co">#&gt; [1] "graphics"  "grDevices"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lifecycle</span></span>
<span><span class="co">#&gt; [1] "cli"   "glue"  "rlang"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Submitting to CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>Under certain configurations, including those used for incoming CRAN submissions, <code>R CMD check</code> issues a <code>NOTE</code> if there are 20 or more “non-default” packages in <code>Imports</code>:</p>
<pre><code>N  checking package dependencies (1.5s)
   Imports includes 29 non-default packages.
   Importing from so many packages makes the package vulnerable to any of
   them becoming unavailable.  Move as many as possible to Suggests and
   use conditionally.</code></pre>
<p>Our best advice is to try hard to comply, as it should be rather rare to need so many dependencies and it’s best to eliminate any <code>NOTE</code> that you can. Of course, there are exceptions to every rule, and perhaps your package is one of them. In that case, you may need to argue your case. It is certainly true that many CRAN packages violate this threshold.</p>
</div>
</div>
</section><section id="sec-dependencies-imports-vs-suggests" class="level3" data-number="10.1.4"><h3 data-number="10.1.4" class="anchored" data-anchor-id="sec-dependencies-imports-vs-suggests">
<span class="header-section-number">10.1.4</span> Whether to Import or Suggest</h3>
<p>The <a href="https://withr.r-lib.org">withr package</a> is a good case study for deciding whether to list a dependency in <code>Imports</code> or <code>Suggests</code>. Withr is very useful for writing tests that clean up after themselves. Such usage is compatible with listing withr in <code>Suggests</code>, since regular users don’t need to run the tests. But sometimes a package might also use withr in its own functions, perhaps to offer its own <code>with_*()</code> and <code>local_*()</code> functions. In that case, withr should be listed in <code>Imports</code>.</p>
<p><code>Imports</code> and <code>Suggests</code> differ in the strength and nature of dependency:</p>
<ul>
<li>
<p><code>Imports</code>: packages listed here <em>must</em> be present for your package to work. Any time your package is installed, those packages will also be installed, if not already present. <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> also checks that all packages in <code>Imports</code> are installed.</p>
<p>It’s worth pointing out that adding a package to <code>Imports</code> ensures it will be installed and <strong>that is all it does</strong>. It has nothing to do with actually importing functions from that package. See <a href="dependencies-in-practice.html#sec-dependencies-in-imports" class="quarto-xref"><span>Section 11.4</span></a> for more about how to use a package in <code>Imports</code>.</p>
</li>
<li>
<p><code>Suggests</code>: your package can use these packages, but doesn’t require them. You might use suggested packages for example datasets, to run tests, build vignettes, or maybe there’s only one function that needs the package.</p>
<p>Packages listed in <code>Suggests</code> are not automatically installed along with your package. This means that you can’t assume that your users have installed all the suggested packages, but you can assume that developers have. See <a href="dependencies-in-practice.html#sec-dependencies-in-suggests" class="quarto-xref"><span>Section 11.5</span></a> for how to check whether a suggested package is installed.</p>
</li>
</ul>
<p><code>Suggests</code> isn’t terribly relevant for packages where the user base is approximately equal to the development team or for packages that are used in a very predictable context. In that case, it’s reasonable to just use <code>Imports</code> for everything. Using <code>Suggests</code> is mostly a courtesy to external users or to accommodate very lean installations. It can free users from downloading rarely-needed packages (especially those that are tricky to install) and lets them get started with your package as quickly as possible.</p>
</section></section><section id="sec-dependencies-namespace" class="level2" data-number="10.2"><h2 data-number="10.2" class="anchored" data-anchor-id="sec-dependencies-namespace">
<span class="header-section-number">10.2</span> Namespace</h2>
<p>So far, we’ve explained the mechanics of declaring a dependency in <code>DESCRIPTION</code> (<a href="description.html#sec-description-imports-suggests" class="quarto-xref"><span>Section 9.6</span></a>) and how to analyze the costs and benefits of dependencies (<a href="#sec-dependencies-pros-cons" class="quarto-xref"><span>Section 10.1</span></a>). Before we explain how to use your dependencies in various parts of your package in <a href="dependencies-in-practice.html" class="quarto-xref"><span>Chapter 11</span></a>, we need to establish the concepts of a package namespace and the search path.</p>
<section id="sec-dependencies-namespace-motivation" class="level3" data-number="10.2.1"><h3 data-number="10.2.1" class="anchored" data-anchor-id="sec-dependencies-namespace-motivation">
<span class="header-section-number">10.2.1</span> Motivation</h3>
<p>As the name suggests, namespaces provide “spaces” for “names”. They provide a context for looking up the value of an object associated with a name.</p>
<p>Without knowing it, you’ve probably already used namespaces. Have you ever used the <code>::</code> operator? It disambiguates functions with the same name. For example, both the lubridate and here packages provide a <code>here()</code> function. If you attach lubridate, then here, <code>here()</code> will refer to the here version, because the last package attached wins. But if you attach the packages in the opposite order, <code>here()</code> will refer to the lubridate version.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>    <span class="op">|</span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>         <span class="op">|</span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">here</span><span class="op">(</span><span class="op">)</span> <span class="co"># here::here() |  here() # lubridate::here()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This can be confusing. Instead, you can qualify the function call with a specific namespace: <code>lubridate::here()</code> and <code>here::here()</code>. Then the order in which the packages are attached won’t matter<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="op">)</span> <span class="co"># always gets lubridate::here()</span></span>
<span><span class="fu">here</span><span class="fu">::</span><span class="fu">here</span><span class="op">(</span><span class="op">)</span>      <span class="co"># always gets here::here()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you will see in <a href="dependencies-in-practice.html#sec-dependencies-in-imports" class="quarto-xref"><span>Section 11.4</span></a>, the <code>package::function()</code> calling style is also our default recommendation for how to use your dependencies in the code below <code>R/</code>, because it eliminates all ambiguity.</p>
<p>But, in the context of package code, the use of <code>::</code> is not really our main line of defense against the confusion seen in the example above. In packages, we rely on namespaces to ensure that every package works the same way regardless of what packages are attached by the user.</p>
<p>Consider the <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> function from the stats package that is part of base R:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sd</span></span>
<span><span class="co">#&gt; function (x, na.rm = FALSE) </span></span>
<span><span class="co">#&gt; sqrt(var(if (is.vector(x) || is.factor(x)) x else as.double(x), </span></span>
<span><span class="co">#&gt;     na.rm = na.rm))</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55a8ee758ee0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:stats&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s defined in terms of another function, <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>, also from the stats package. So what happens if we override <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> with our own definition? Does it break <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>?</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span><span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -5</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.58</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Surprisingly, it does not! That’s because when <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> looks for an object called <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>, it looks first in the stats package namespace, so it finds <code><a href="https://rdrr.io/r/stats/cor.html">stats::var()</a></code>, not the <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> we created in the global environment. It would be chaos if functions like <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> could be broken by a user redefining <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> or by attaching a package that overrides <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>. The package namespace system is what saves us from this fate.</p>
</section><section id="sec-dependencies-NAMESPACE-file" class="level3" data-number="10.2.2"><h3 data-number="10.2.2" class="anchored" data-anchor-id="sec-dependencies-NAMESPACE-file">
<span class="header-section-number">10.2.2</span> The <code>NAMESPACE</code> file</h3>
<p>The <code>NAMESPACE</code> file plays a key role in defining your package’s namespace. Here are selected lines from the <code>NAMESPACE</code> file in the testthat package:</p>
<pre><code># Generated by roxygen2: do not edit by hand

S3method(compare,character)
S3method(print,testthat_results)
export(compare)
export(expect_equal)
import(rlang)
importFrom(brio,readLines)
useDynLib(testthat, .registration = TRUE)</code></pre>
<p>The first line announces that this file is not written by hand, but rather is generated by the roxygen2 package. We’ll return to this topic soon, after we discuss the remaining lines.</p>
<p>You can see that the <code>NAMESPACE</code> file looks a bit like R code (but it is not). Each line contains a <strong>directive</strong>: <code>S3method()</code>, <code>export()</code>, <code>importFrom()</code>, and so on. Each directive describes an R object, and says whether it’s exported from this package to be used by others, or it’s imported from another package to be used internally.</p>
<p>These directives are the most important in our development approach, in order of frequency:</p>
<ul>
<li>
<code>export()</code>: export a function (including S3 and S4 generics).</li>
<li>
<code>S3method()</code>: export an S3 method.</li>
<li>
<code>importFrom()</code>: import selected object from another namespace (including S4 generics).</li>
<li>
<code>import()</code>: import all objects from another package’s namespace.</li>
<li>
<code>useDynLib()</code>: registers routines from a DLL (this is specific to packages with compiled code).</li>
</ul>
<p>There are other directives that we won’t cover here, because they are explicitly discouraged or they just rarely come up in our development work.</p>
<ul>
<li>
<code>exportPattern()</code>: exports all functions that match a pattern. We feel it’s safer to always use explicit exports and we avoid the use of this directive.</li>
<li>
<code>exportClasses()</code>, <code>exportMethods()</code>, <code>importClassesFrom()</code>, <code>importMethodsFrom()</code>: export and import S4 classes and methods. We only work in the S4 system when necessary for compatibility with another package, i.e.&nbsp;we generally don’t implement methods or classes that we own with S4. Therefore the S4 coverage in this book is very minimal.</li>
</ul>
<p>In the devtools workflow, the <code>NAMESPACE</code> file is not written by hand! Instead, we prefer to generate <code>NAMESPACE</code> with the roxygen2 package, using specific tags located in a roxygen comment above each function’s definition in the <code>R/*.R</code> files (<a href="dependencies-in-practice.html#sec-dependencies-NAMESPACE-workflow" class="quarto-xref"><span>Section 11.3</span></a>). We will have much more to say about roxygen comments and the roxygen2 package when we discuss package documentation in <a href="man.html" class="quarto-xref"><span>Chapter 16</span></a>. For now, we just lay out the reasons we prefer this method of generating the <code>NAMESPACE</code> file:</p>
<ul>
<li><p>Namespace tags are integrated into the source code, so when you read the code it’s easier to see what’s being exported and imported and why.</p></li>
<li><p>Roxygen2 abstracts away some of the details of <code>NAMESPACE</code>. You only need to learn one tag, <code>@export</code>, and roxygen2 will figure out which specific directive to use, based on whether the associated object is a regular function, S3 method, S4 method, or S4 class.</p></li>
<li><p>Roxygen2 keeps <code>NAMESPACE</code> tidy. No matter how many times <code>@importFrom foo bar</code> appears in your roxygen comments, you’ll only get one <code>importFrom(foo, bar)</code> in your <code>NAMESPACE</code>. Roxygen2 also keeps NAMESPACE organised in a principled order, sorting first by the directive type and then alphabetically. Roxygen2 takes away the burden of writing NAMESPACE, while also trying to keep the file as readable as possible. This organization also makes Git diffs much more informative.</p></li>
</ul>
<p>Note that you can choose to use roxygen2 to generate just <code>NAMESPACE</code>, just <code>man/*.Rd</code> (<a href="man.html" class="quarto-xref"><span>Chapter 16</span></a>), or both (as is our practice). If you don’t use any namespace-related tags, roxygen2 won’t touch <code>NAMESPACE</code>. If you don’t use any documentation-related tags, roxygen2 won’t touch <code>man/</code>.</p>
</section></section><section id="sec-dependencies-search" class="level2" data-number="10.3"><h2 data-number="10.3" class="anchored" data-anchor-id="sec-dependencies-search">
<span class="header-section-number">10.3</span> Search path</h2>
<p>To understand why namespaces are important, you need a solid understanding of search paths. To call a function, R first has to find it. This search unfolds differently for user code than for package code and that is because of the namespace system.</p>
<section id="sec-dependencies-search-path-user" class="level3" data-number="10.3.1"><h3 data-number="10.3.1" class="anchored" data-anchor-id="sec-dependencies-search-path-user">
<span class="header-section-number">10.3.1</span> Function lookup for user code</h3>
<p>The first place R looks for an object is the global environment. If R doesn’t find it there, it looks in the search path, the list of all the packages you have <strong>attached</strong>. You can see this list by running <code><a href="https://rdrr.io/r/base/search.html">search()</a></code>. For example, here’s the search path for the code in this book:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ".GlobalEnv"        "package:stats"     "package:graphics" </span></span>
<span><span class="co">#&gt; [4] "package:grDevices" "package:utils"     "package:datasets" </span></span>
<span><span class="co">#&gt; [7] "package:methods"   "Autoloads"         "package:base"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This has a specific form (see <a href="#fig-search-path-baseline" class="quarto-xref">Figure&nbsp;<span>10.1</span></a>):</p>
<ol type="1">
<li>The global environment.</li>
<li>The packages that have been attached, e.g.&nbsp;via <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, from most-recently attached to least.</li>
<li>
<code>Autoloads</code>, a special environment that uses delayed bindings to save memory by only loading package objects (like big datasets) when needed.</li>
<li>The base environment, by which we mean the package environment of the base package.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-search-path-baseline" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A chain of labelled environments. Each environment has an arrow pointing to its parent environment.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-search-path-baseline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/search-path/search-path.png" class="img-fluid figure-img" style="width:50.0%" alt="A chain of labelled environments. Each environment has an arrow pointing to its parent environment.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-search-path-baseline-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.1: Typical state of the search path.
</figcaption></figure>
</div>
</div>
</div>
<p>Each element in the search path has the next element as its parent, i.e.&nbsp;this is a chain of environments that is searched in order. In the diagram, this relationship is shown as a small blue circle with an arrow that points to the parent. The first environment (the global environment) and the last two (<code>Autoloads</code> and the base environment) are special and maintain their position.</p>
<p>But the middle section of attached packages is more dynamic. When a new package is attached, it is inserted right after and becomes the parent of the global environment. When you attach another package with <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, it changes the search path, as shown in <a href="#fig-search-path-insertion" class="quarto-xref">Figure&nbsp;<span>10.2</span></a>:</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-search-path-insertion" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A chain of labelled environments, with a newly attached package being inserted as the parent of the global environment.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-search-path-insertion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/search-path/search-path-insertion.png" class="img-fluid figure-img" style="width:50.0%" alt="A chain of labelled environments, with a newly attached package being inserted as the parent of the global environment.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-search-path-insertion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.2: A newly attached package is inserted into the search path.
</figcaption></figure>
</div>
</div>
</div>
<p>The main gotcha around how the user’s search path works is the scenario we explored in <a href="#sec-dependencies-namespace-motivation" class="quarto-xref"><span>Section 10.2.1</span></a>, where two packages (lubridate and here) offer competing functions by the same name (<code>here()</code>). It should be very clear now why a user’s call to <code>here()</code> can produce a different result, depending on the order in which they attached the two packages.</p>
<p>This sort of confusion would be even more damaging if it applied to package code, but luckily it does not. Now we can explain how the namespace system designs this problem away.</p>
</section><section id="function-lookup-inside-a-package" class="level3" data-number="10.3.2"><h3 data-number="10.3.2" class="anchored" data-anchor-id="function-lookup-inside-a-package">
<span class="header-section-number">10.3.2</span> Function lookup inside a package</h3>
<p>In <a href="#sec-dependencies-namespace-motivation" class="quarto-xref"><span>Section 10.2.1</span></a>, we proved that a user’s definition of a function named <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code> does <em>not</em> break <code><a href="https://rdrr.io/r/stats/sd.html">stats::sd()</a></code>. Somehow, to our immense relief, <code><a href="https://rdrr.io/r/stats/sd.html">stats::sd()</a></code> finds <code><a href="https://rdrr.io/r/stats/cor.html">stats::var()</a></code> when it should. How does that work?</p>
<p>This section is somewhat technical and you can absolutely develop a package with a well-behaved namespace without fully understanding these details. Consider this optional reading that you can consult when and if you’re interested. You can learn even more in <a href="https://adv-r.hadley.nz">Advanced R</a>, especially in the chapter on environments, from which we have adapted some of this material.</p>
<p>Every function in a package is associated with a pair of environments: the package environment, which is what appears in the user’s search path, and the <strong>namespace</strong> environment.</p>
<ul>
<li><p>The package environment is the external interface to the package. It’s how a regular R user finds a function in an attached package or with <code>::</code>. Its parent is determined by the search path, i.e.&nbsp;the order in which packages have been attached. The package environment only exposes exported objects.</p></li>
<li><p>The namespace environment is the internal interface of the package. It includes all objects in the package, both exported and non-exported. This ensures that every function can find every other function in the package. Every binding in the package environment also exists in the namespace environment, but not <em>vice versa</em>.</p></li>
</ul>
<p><a href="#fig-function-environment" class="quarto-xref">Figure&nbsp;<span>10.3</span></a> depicts the <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> function as a rectangle with a rounded end. The arrows from <code>package:stats</code> and <code>namespace:stats</code> show that <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> is bound in both. But the relationship is not symmetric. The black circle with an arrow pointing back to <code>namespace:stats</code> indicates where <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> will look for objects that it needs: in the namespace environment, not the package environment.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-function-environment" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A function that is bound to the name `sd()` by two environments, the package environment and the namespace environment, indicated by two arrows. But the function itself only binds the namespace environment, indicated a single arrow.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-function-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/namespace/namespace-bind.png" class="img-fluid figure-img" style="width:60.0%" alt="A function that is bound to the name `sd()` by two environments, the package environment and the namespace environment, indicated by two arrows. But the function itself only binds the namespace environment, indicated a single arrow.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-function-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.3: An exported function is bound in the package environment and in the namespace, but only binds the namespace.
</figcaption></figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>The package environment controls how users find the function; the namespace controls how the function finds its variables.</p>
</blockquote>
<p>Every namespace environment has the same set of ancestors, as depicted in <a href="#fig-namespace-environment" class="quarto-xref">Figure&nbsp;<span>10.4</span></a>:</p>
<ul>
<li><p>Each namespace has an <strong>imports</strong> environment that can contain bindings to functions used by the package that are defined in another package. The imports environment is controlled by the package developer with the <code>NAMESPACE</code> file. Specifically, directives such as <code>importFrom()</code> and <code>imports()</code> populate this environment.</p></li>
<li><p>Explicitly importing every base function would be tiresome, so the parent of the imports environment is the base <strong>namespace</strong>. The base namespace contains the same bindings as the base environment, but it has a different parent.</p></li>
<li><p>The parent of the base namespace is the global environment. This means that if a binding isn’t defined in the imports environment the package will look for it in the usual way. This is usually a bad idea (because it makes code depend on other loaded packages), so <code>R CMD check</code> automatically warns about such code. It is needed primarily for historical reasons, particularly due to how S3 method dispatch works.</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-namespace-environment" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A chain of labelled environments. Each environment has an arrow pointing to its parent environment.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-namespace-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/namespace/namespace-env.png" class="img-fluid figure-img" style="width:100.0%" alt="A chain of labelled environments. Each environment has an arrow pointing to its parent environment.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-namespace-environment-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.4: The namespace environment has the imports environment as parent, which inherits from the namespace environment of the base package and, ultimately, the global environment.
</figcaption></figure>
</div>
</div>
</div>
<p>Finally, we can put it all together in this last diagram, <a href="#fig-search-path-and-namespace" class="quarto-xref">Figure&nbsp;<span>10.5</span></a>. This shows the user’s search path, along the bottom, and the internal stats search path, along the top.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-search-path-and-namespace" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Two chains of labelled environments, one is the user's search path and the other is the package namespace (and its parents).">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-search-path-and-namespace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/namespace/namespace.png" class="img-fluid figure-img" style="width:100.0%" alt="Two chains of labelled environments, one is the user's search path and the other is the package namespace (and its parents).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-search-path-and-namespace-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10.5: For user code, objects are found using the search path, whereas package code uses the namespace.
</figcaption></figure>
</div>
</div>
</div>
<p>A user (or some package they are using) is free to define a function named <code><a href="https://rdrr.io/r/stats/cor.html">var()</a></code>. But when that user calls <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>, it will always call <code><a href="https://rdrr.io/r/stats/cor.html">stats::var()</a></code> because <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code> searches in a sequence of environments determined by the stats package, not by the user. This is how the namespace system ensures that package code always works the same way, regardless of what’s been defined in the global environment or what’s been attached.</p>
</section></section><section id="sec-dependencies-attach-vs-load" class="level2" data-number="10.4"><h2 data-number="10.4" class="anchored" data-anchor-id="sec-dependencies-attach-vs-load">
<span class="header-section-number">10.4</span> Attaching versus loading</h2>
<p>It’s common to hear something like “we use <code><a href="https://rdrr.io/r/base/library.html">library(somepackage)</a></code> to load somepackage”. But technically <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> <em>attaches</em> a package to the search path. This casual abuse of terminology is often harmless and can even be beneficial in some settings. But sometimes it’s important to be precise and pedantic and this is one of those times. Package developers need to know the difference between attaching and loading a package and when to care about this difference.</p>
<p>If a package is installed,</p>
<ul>
<li><p><strong>Loading</strong> will load code, data, and any DLLs; register S3 and S4 methods; and run the <code>.onLoad()</code> function. After loading, the package is available in memory, but because it’s not in the search path, you won’t be able to access its components without using <code>::</code>. Confusingly, <code>::</code> will also load a package automatically if it isn’t already loaded.</p></li>
<li><p><strong>Attaching</strong> puts the package in the search path (<a href="#sec-dependencies-search-path-user" class="quarto-xref"><span>Section 10.3.1</span></a>). You can’t attach a package without first loading it, so both <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> (or <code><a href="https://rdrr.io/r/base/library.html">require()</a></code>) load then attach the package. This also runs the <code>.onAttach()</code> function.</p></li>
</ul>
<p>There are four functions that make a package available, shown in <a href="#tbl-load-vs-attach" class="quarto-xref">Table&nbsp;<span>10.1</span></a>. They differ based on whether they load or attach, and what happens if the package is not found (i.e., throws an error or returns <code>FALSE</code>).</p>
<div id="tbl-load-vs-attach" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-load-vs-attach-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10.1: Functions that load or attach a package.
</figcaption><div aria-describedby="tbl-load-vs-attach-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 30%">
<col style="width: 57%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Throws error</th>
<th>Returns <code>FALSE</code>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Load</td>
<td><code>loadNamespace("x")</code></td>
<td><code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("x", quietly = TRUE)</a></code></td>
</tr>
<tr class="even">
<td>Attach</td>
<td><code><a href="https://rdrr.io/r/base/library.html">library(x)</a></code></td>
<td><code><a href="https://rdrr.io/r/base/library.html">require(x, quietly = TRUE)</a></code></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Of the four, these two functions are by far the most useful:</p>
<ul>
<li><p>Use <code><a href="https://rdrr.io/r/base/library.html">library(x)</a></code> in, e.g., a data analysis script or a vignette. It will throw an error if the package is not installed, and will terminate the script. You want to attach the package to save typing. Never use <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> in package code below <code>R/</code> or <code>tests/</code>.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("x", quietly = TRUE)</a></code> inside a package if you want to specify different behaviour depending on whether or not a suggested package is installed. Note that this also loads the package. We give examples in <a href="dependencies-in-practice.html#sec-dependencies-in-suggests-r-code" class="quarto-xref"><span>Section 11.5.1</span></a>.</p></li>
</ul>
<p><code><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace()</a></code> is somewhat esoteric and is really only needed for internal R code.</p>
<p><code><a href="https://rdrr.io/r/base/library.html">require(pkg)</a></code> is almost never a good idea<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> and, we suspect, may come from people projecting certain hopes and dreams onto the function name. Ironically, <code><a href="https://rdrr.io/r/base/library.html">require(pkg)</a></code> does not actually require success in attaching pkg and your function or script will soldier on even in the case of failure. This, in turn, often leads to a very puzzling error much later. If you want to “attach or fail”, use <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>. If you want to check whether pkg is available and proceed accordingly, use <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("pkg", quietly = TRUE)</a></code>.</p>
<p>One reasonable use of <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> is in an example that uses a package your package <code>Suggests</code>, which is further discussed in <a href="dependencies-in-practice.html#sec-dependencies-in-suggests-in-examples-and-vignettes" class="quarto-xref"><span>Section 11.5.3</span></a>.</p>
<p>The <code>.onLoad()</code> and <code>.onAttach()</code> functions mentioned above are two of several hooks that allow you to run specific code when your package is loaded or attached (or, even, detached or unloaded). Most packages don’t need this, but these hooks are useful in certain situations. See <a href="code.html#sec-code-onLoad-onAttach" class="quarto-xref"><span>Section 6.5.4</span></a> for some use cases for <code>.onLoad()</code> and <code>.onAttach()</code>.</p>
<section id="sec-dependencies-imports-vs-depends" class="level3" data-number="10.4.1"><h3 data-number="10.4.1" class="anchored" data-anchor-id="sec-dependencies-imports-vs-depends">
<span class="header-section-number">10.4.1</span> Whether to Import or Depend</h3>
<p>We are now in a position to lay out the difference between <code>Depends</code> and <code>Imports</code> in the <code>DESCRIPTION</code>. Listing a package in either <code>Depends</code> or <code>Imports</code> ensures that it’s installed when needed. The main difference is that a package you list in <code>Imports</code> will just be <em>loaded</em> when you use it, whereas a package you list in <code>Depends</code>will be <em>attached</em> when your package is attached.</p>
<p>Unless there is a good reason otherwise, you should always list packages in <code>Imports</code> not <code>Depends</code>. That’s because a good package is self-contained, and minimises changes to the global landscape, including the search path.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>Users of devtools are actually regularly exposed to the fact that devtools <code>Depends</code> on usethis:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: usethis</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] ".GlobalEnv"        "package:devtools"  "package:usethis"  </span></span>
<span><span class="co">#&gt;  ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This choice is motivated by backwards compatibility. When devtools was split into several smaller packages (<a href="setup.html#sec-setup-usage" class="quarto-xref"><span>Section 2.2</span></a>), many of the user-facing functions moved to usethis. Putting usethis in Depends was a pragmatic choice to insulate users from keeping track of which function ended up where.</p>
<p>A more classic example of <code>Depends</code> is how the <a href="https://censored.tidymodels.org">censored package</a> depends on the <a href="https://parsnip.tidymodels.org">parsnip</a> and <a href="https://cran.r-project.org/package=survival">survival</a> packages. Parsnip provides a unified interface for fitting models, and censored is an extension package for survival analysis. Censored is not useful without parsnip and survival, so it makes sense to list them in <code>Depends</code>.</p>


</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>In programming, the Happy Path is the scenario where all the inputs make sense and are exactly how things “should be”. The Unhappy Path is everything else (objects of length or dimension zero, objects with missing data or dimensions or attributes, objects that don’t exist, etc.).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Before writing your own version of X, have a good look at the bug tracker and test suite for another package that implements X. This can be useful for appreciating what is actually involved.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>There is a blog post that warns people away from depending on the tidyverse package: <a href="https://www.tidyverse.org/blog/2018/06/tidyverse-not-for-packages/" class="uri">https://www.tidyverse.org/blog/2018/06/tidyverse-not-for-packages/</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>We’re going to stay focused on packages in this book, but there are other ways than using <code>::</code> to address conflicts in end-user code: the <a href="https://conflicted.r-lib.org">conflicted package</a> and the <a href="https://developer.r-project.org/Blog/public/2019/03/19/managing-search-path-conflicts/"><code>"conflicts.policy"</code> option</a> introduced in base R v3.6.0.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>The classic blog post <a href="https://yihui.org/en/2014/07/library-vs-require/">“<code>library()</code> vs <code>require()</code> in R”</a> by Yihui Xie is another good resource on this.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Thomas Leeper created several example packages to demonstrate the puzzling behaviour that can arise when packages use <code>Depends</code> and shared the work at <a href="https://github.com/leeper/Depends" class="uri">https://github.com/leeper/Depends</a>. This demo also underscores the importance of using <code>::</code> (or <code>importFrom()</code>) when using external functions in your package, as recommended in <a href="dependencies-in-practice.html" class="quarto-xref"><span>Chapter 11</span></a>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-pkgs\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./description.html" class="pagination-link" aria-label="`DESCRIPTION`">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dependencies-in-practice.html" class="pagination-link" aria-label="Dependencies: In Practice">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/dependencies-mindset-background.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
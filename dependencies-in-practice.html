<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to create a package, the fundamental unit of shareable, reusable, and reproducible R code.">
<title>11&nbsp; Dependencies: In Practice – R Packages (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./license.html" rel="next">
<link href="./dependencies-mindset-background.html" rel="prev">
<link href="./images/cover-2e-small.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8c563c05ac8c1d64e78fdaf2b4701079.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./description.html">Package metadata</a></li><li class="breadcrumb-item"><a href="./dependencies-in-practice.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Packages (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r-pkgs/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Package structure and state</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamental development workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The package within</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Package components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other components</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Package metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Testing basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Designing your test suite</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced testing techniques</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Function documentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Vignettes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other markdown files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Website</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Maintenance and distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Software development practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#confusion-about-imports" id="toc-confusion-about-imports" class="nav-link active" data-scroll-target="#confusion-about-imports"><span class="header-section-number">11.1</span> Confusion about <code>Imports</code></a></li>
  <li><a href="#conventions-for-this-chapter" id="toc-conventions-for-this-chapter" class="nav-link" data-scroll-target="#conventions-for-this-chapter"><span class="header-section-number">11.2</span> Conventions for this chapter</a></li>
  <li><a href="#sec-dependencies-NAMESPACE-workflow" id="toc-sec-dependencies-NAMESPACE-workflow" class="nav-link" data-scroll-target="#sec-dependencies-NAMESPACE-workflow"><span class="header-section-number">11.3</span> <code>NAMESPACE</code> Workflow</a></li>
  <li>
<a href="#sec-dependencies-in-imports" id="toc-sec-dependencies-in-imports" class="nav-link" data-scroll-target="#sec-dependencies-in-imports"><span class="header-section-number">11.4</span> Package is listed in <code>Imports</code></a>
  <ul class="collapse">
<li><a href="#sec-dependencies-in-imports-r-code" id="toc-sec-dependencies-in-imports-r-code" class="nav-link" data-scroll-target="#sec-dependencies-in-imports-r-code"><span class="header-section-number">11.4.1</span> In code below R/</a></li>
  <li><a href="#sec-dependencies-in-imports-in-tests" id="toc-sec-dependencies-in-imports-in-tests" class="nav-link" data-scroll-target="#sec-dependencies-in-imports-in-tests"><span class="header-section-number">11.4.2</span> In test code</a></li>
  <li><a href="#in-examples-and-vignettes" id="toc-in-examples-and-vignettes" class="nav-link" data-scroll-target="#in-examples-and-vignettes"><span class="header-section-number">11.4.3</span> In examples and vignettes</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-in-suggests" id="toc-sec-dependencies-in-suggests" class="nav-link" data-scroll-target="#sec-dependencies-in-suggests"><span class="header-section-number">11.5</span> Package is listed in <code>Suggests</code></a>
  <ul class="collapse">
<li><a href="#sec-dependencies-in-suggests-r-code" id="toc-sec-dependencies-in-suggests-r-code" class="nav-link" data-scroll-target="#sec-dependencies-in-suggests-r-code"><span class="header-section-number">11.5.1</span> In code below <code>R/</code></a></li>
  <li><a href="#sec-dependencies-in-suggests-in-tests" id="toc-sec-dependencies-in-suggests-in-tests" class="nav-link" data-scroll-target="#sec-dependencies-in-suggests-in-tests"><span class="header-section-number">11.5.2</span> In test code</a></li>
  <li><a href="#sec-dependencies-in-suggests-in-examples-and-vignettes" id="toc-sec-dependencies-in-suggests-in-examples-and-vignettes" class="nav-link" data-scroll-target="#sec-dependencies-in-suggests-in-examples-and-vignettes"><span class="header-section-number">11.5.3</span> In examples and vignettes</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-in-depends" id="toc-sec-dependencies-in-depends" class="nav-link" data-scroll-target="#sec-dependencies-in-depends"><span class="header-section-number">11.6</span> Package is listed in <code>Depends</code></a>
  <ul class="collapse">
<li><a href="#in-code-below-r-and-in-test-code" id="toc-in-code-below-r-and-in-test-code" class="nav-link" data-scroll-target="#in-code-below-r-and-in-test-code"><span class="header-section-number">11.6.1</span> In code below <code>R/</code> and in test code</a></li>
  <li><a href="#in-examples-and-vignettes-1" id="toc-in-examples-and-vignettes-1" class="nav-link" data-scroll-target="#in-examples-and-vignettes-1"><span class="header-section-number">11.6.2</span> In examples and vignettes</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-nonstandard" id="toc-sec-dependencies-nonstandard" class="nav-link" data-scroll-target="#sec-dependencies-nonstandard"><span class="header-section-number">11.7</span> Package is a nonstandard dependency</a>
  <ul class="collapse">
<li><a href="#depending-on-the-development-version-of-a-package" id="toc-depending-on-the-development-version-of-a-package" class="nav-link" data-scroll-target="#depending-on-the-development-version-of-a-package"><span class="header-section-number">11.7.1</span> Depending on the development version of a package</a></li>
  <li><a href="#sec-dependencies-nonstandard-config-needs" id="toc-sec-dependencies-nonstandard-config-needs" class="nav-link" data-scroll-target="#sec-dependencies-nonstandard-config-needs"><span class="header-section-number">11.7.2</span> <code>Config/Needs/*</code> field</a></li>
  </ul>
</li>
  <li>
<a href="#exports" id="toc-exports" class="nav-link" data-scroll-target="#exports"><span class="header-section-number">11.8</span> Exports</a>
  <ul class="collapse">
<li><a href="#what-to-export" id="toc-what-to-export" class="nav-link" data-scroll-target="#what-to-export"><span class="header-section-number">11.8.1</span> What to export</a></li>
  <li><a href="#re-exporting" id="toc-re-exporting" class="nav-link" data-scroll-target="#re-exporting"><span class="header-section-number">11.8.2</span> Re-exporting</a></li>
  </ul>
</li>
  <li><a href="#imports-and-exports-related-to-s3" id="toc-imports-and-exports-related-to-s3" class="nav-link" data-scroll-target="#imports-and-exports-related-to-s3"><span class="header-section-number">11.9</span> Imports and exports related to S3</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/dependencies-in-practice.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./description.html">Package metadata</a></li><li class="breadcrumb-item"><a href="./dependencies-in-practice.html"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-dependencies-in-practice" class="quarto-section-identifier"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This chapter presents the practical details of working with your dependencies inside your package. If you need a refresher on any of the background:</p>
<ul>
<li><p><a href="description.html" class="quarto-xref"><span>Chapter 9</span></a> covers the DESCRIPTION file. Listing a dependency in that file, such as in <code>Imports</code>, is a necessary first step when taking a dependency.</p></li>
<li><p><a href="dependencies-mindset-background.html#sec-dependencies-pros-cons" class="quarto-xref"><span>Section 10.1</span></a> provides a decision-making framework for dependencies.</p></li>
<li><p>The technical details of package namespaces, the search path, and attaching vs.&nbsp;loading are laid out in <a href="dependencies-mindset-background.html#sec-dependencies-namespace" class="quarto-xref"><span>Section 10.2</span></a>, <a href="dependencies-mindset-background.html#sec-dependencies-search" class="quarto-xref"><span>Section 10.3</span></a>, and <a href="dependencies-mindset-background.html#sec-dependencies-attach-vs-load" class="quarto-xref"><span>Section 10.4</span></a>.</p></li>
</ul>
<p>We’re finally ready to talk about how to use different types of dependencies within the different parts of your package:</p>
<ul>
<li>in your functions, below <code>R/</code>
</li>
<li>in your tests, below <code>tests/testthat/</code>
</li>
<li>in your examples, in the help topics, below <code>man/</code>
</li>
<li>in your vignettes and articles, below <code>vignettes/</code>
</li>
</ul>
<section id="confusion-about-imports" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="confusion-about-imports">
<span class="header-section-number">11.1</span> Confusion about <code>Imports</code>
</h2>
<p>Let’s make this crystal clear:</p>
<blockquote class="blockquote">
<p>Listing a package in <code>Imports</code> in <code>DESCRIPTION</code> does not “import” that package.</p>
</blockquote>
<p>It is natural to assume that listing a package in <code>Imports</code> actually “imports” the package, but this is just an unfortunate choice of name for the <code>Imports</code> field. The <code>Imports</code> field makes sure that the packages listed there are installed when your package is installed. It does not make those functions available to you, e.g.&nbsp;below <code>R/</code>, or to your user.</p>
<p>It is neither automatic nor necessarily advisable that a package listed in <code>Imports</code> also appears in <code>NAMESPACE</code> via <code>imports()</code> or <code>importFrom()</code>. It is common for a package to be listed in <code>Imports</code> in <code>DESCRIPTION</code>, but not in <code>NAMESPACE</code>. The converse is not true. Every package mentioned in <code>NAMESPACE</code> must also be present in the <code>Imports</code> or <code>Depends</code> fields.</p>
</section><section id="conventions-for-this-chapter" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="conventions-for-this-chapter">
<span class="header-section-number">11.2</span> Conventions for this chapter</h2>
<p>Sometimes our examples can feature real functions from real packages. But if we need to talk about a generic package or function, here are the conventions we use below:</p>
<ul>
<li><p>pkg: the name of your hypothetical package</p></li>
<li><p>aaapkg or bbbpkg: the name of a hypothetical package your package depends on</p></li>
<li><p><code>aaa_fun()</code>: the name of a function exported by aaapkg</p></li>
</ul></section><section id="sec-dependencies-NAMESPACE-workflow" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="sec-dependencies-NAMESPACE-workflow">
<span class="header-section-number">11.3</span> <code>NAMESPACE</code> Workflow</h2>
<p>In the sections below, we give practical instructions on how (and when) to import functions from another package into yours and how to export functions from your package. The file that keeps track of all this is the <code>NAMESPACE</code> file (more details in <a href="dependencies-mindset-background.html#sec-dependencies-NAMESPACE-file" class="quarto-xref"><span>Section 10.2.2</span></a>).</p>
<p>In the devtools workflow and this book, we generate the <code>NAMESPACE</code> file from special comments in the <code>R/*.R</code> files. Since the package that ultimately does this work is roxygen2, these are called “roxygen comments”. These roxygen comments are also the basis for your package’s help topics, which is covered in <a href="man.html#sec-man-workflow" class="quarto-xref"><span>Section 16.1.1</span></a>.</p>
<p>The <code>NAMESPACE</code> file starts out with a single commented-out line explaining the situation (and hopefully discouraging any manual edits):</p>
<pre><code># Generated by roxygen2: do not edit by hand</code></pre>
<p>As you incorporate roxygen tags to export and import functions, you need to re-generate the <code>NAMESPACE</code> file periodically. Here is the general workflow for regenerating <code>NAMESPACE</code> (and your documentation):</p>
<ol type="1">
<li>
<p>Add namespace-related tags to the roxygen comments in your <code>R/*.R</code> files. This is an artificial example, but it gives you the basic idea:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @importFrom aaapkg aaa_fun</span></span>
<span><span class="co">#' @import bbbpkg</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
<li>
<p>Run <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> (or press Ctrl/Cmd + Shift + D in RStudio) to “document” your package. By default, two things happen:</p>
<ul>
<li><p>The help topics in the <code>man/*.Rd</code> files are updated (covered in <a href="man.html" class="quarto-xref"><span>Chapter 16</span></a>).</p></li>
<li>
<p>The <code>NAMESPACE</code> file is re-generated. In our example, the <code>NAMESPACE</code> file would look like:</p>
<pre><code># Generated by roxygen2: do not edit by hand

export(foo)
import(bbbpkg)
importFrom(aaapkg,aaa_fun)</code></pre>
</li>
</ul>
</li>
</ol>
<p>Roxygen2 is quite smart and will insert the appropriate directive in <code>NAMESPACE</code>, i.e.&nbsp;it can usually determine whether to use <code>export()</code> or <code>S3method()</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RStudio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Press Ctrl/Cmd + Shift + D, to generate your package’s <code>NAMESPACE</code> (and <code>man/*.Rd</code> files). This is also available via <em>Document</em> in the <em>Build</em> menu and pane.</p>
</div>
</div>
</section><section id="sec-dependencies-in-imports" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="sec-dependencies-in-imports">
<span class="header-section-number">11.4</span> Package is listed in <code>Imports</code>
</h2>
<p>Consider a dependency that is listed in <code>DESCRIPTION</code> in <code>Imports</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">    aaapkg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The code inside your package can assume that aaapkg is installed whenever pkg is installed.</p>
<section id="sec-dependencies-in-imports-r-code" class="level3" data-number="11.4.1"><h3 data-number="11.4.1" class="anchored" data-anchor-id="sec-dependencies-in-imports-r-code">
<span class="header-section-number">11.4.1</span> In code below R/</h3>
<p>Our recommended default is to call external functions using the <code>package::function()</code> syntax:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">somefunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">aaapkg</span><span class="fu">::</span><span class="fu">aaa_fun</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Specifically, we recommend that you default to <em>not</em> importing anything from aaapkg into your namespace. This makes it very easy to identify which functions live outside of your package, which is especially useful when you read your code in the future. This also eliminates any concerns about name conflicts between aaapkg and your package.</p>
<p>Of course there are reasons to make exceptions to this rule and to import something from another package into yours:</p>
<ul>
<li><p>An operator: You can’t call an operator from another package via <code>::</code>, so you must import it. Examples: the null-coalescing operator <code>%||%</code> from rlang or the original pipe <code>%&gt;%</code> from magrittr.</p></li>
<li><p>A function that you use <em>a lot</em>: If importing a function makes your code much more readable, that’s a good enough reason to import it. This literally reduces the number of characters required to call the external function. This can be especially handy when generating user-facing messages, because it makes it more likely that lines in the source correspond to lines in the output.</p></li>
<li><p>A function that you call in a tight loop: There is a minor performance penalty associated with <code>::</code>. It’s on the order of 100ns, so it will only matter if you call the function millions of times.</p></li>
</ul>
<p>A handy function for your interactive workflow is <code><a href="https://usethis.r-lib.org/reference/use_import_from.html">usethis::use_import_from()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_import_from.html">use_import_from</a></span><span class="op">(</span><span class="st">"glue"</span>, <span class="st">"glue_collapse"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The call above writes this roxygen tag into the source code of your package:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @importFrom glue glue_collapse</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Where should this roxygen tag go? There are two reasonable locations:</p>
<ul>
<li><p>As close as possible to the usage of the external function. With this mindset, you would place <code>@importFrom</code> in the roxygen comment above the function in your package where you use the external function. If this is your style, you’ll have to do it by hand. We have found that this feels natural at first, but starts to break down as you use more external functions in more places.</p></li>
<li>
<p>In a central location. This approach keeps all <code>@importFrom</code> tags together, in a dedicated section of the package-level documentation file (which can be created with <code><a href="https://usethis.r-lib.org/reference/use_package_doc.html">usethis::use_package_doc()</a></code>, <a href="man.html#sec-man-package-doc" class="quarto-xref"><span>Section 16.7</span></a>). This is what <code>use_import_from()</code> implements. So, in <code>R/pkg-package.R</code>, you’ll end up with something like this:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># The following block is used by usethis to automatically manage</span></span>
<span><span class="co"># roxygen namespace tags. Modify with care!</span></span>
<span><span class="co">## usethis namespace: start</span></span>
<span><span class="co">#' @importFrom glue glue_collapse</span></span>
<span><span class="co">## usethis namespace: end</span></span>
<span><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ul>
<p>Recall that <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> processes your roxygen comments (<a href="#sec-dependencies-NAMESPACE-workflow" class="quarto-xref"><span>Section 11.3</span></a>), which writes help topics to <code>man/*.Rd</code> and, relevant to our current goal, generates the <code>NAMESPACE</code> file. If you use <code>use_import_from()</code>, it does this for you and also calls <code>load_all()</code>, making the newly imported function available in your current session.</p>
<p>The roxygen tag above causes this directive to appear in the <code>NAMESPACE</code> file:</p>
<pre><code>importFrom(glue, glue_collapse)</code></pre>
<p>Now you can use the imported function directly in your code:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">somefunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">glue_collapse</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Sometimes you make such heavy use of so many functions from another package that you want to import its entire namespace. This should be relatively rare. In the tidyverse, the package we most commonly treat this way is rlang, which functions almost like a base package for us.</p>
<p>Here is the roxygen tag that imports all of rlang. This should appear somewhere in <code>R/*.R</code>, such as the dedicated space described above for collecting all of your namespace import tags.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @import rlang</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After calling <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code>, this roxygen tag causes this directive to appear in the <code>NAMESPACE</code> file:</p>
<pre><code>import(rlang)</code></pre>
<p>This is the least recommended solution because it can make your code harder to read (you can’t tell where a function is coming from), and if you <code>@import</code> many packages, it increases the chance of function name conflicts. Save this for very special situations.</p>
<section id="how-to-not-use-a-package-in-imports" class="level4" data-number="11.4.1.1"><h4 data-number="11.4.1.1" class="anchored" data-anchor-id="how-to-not-use-a-package-in-imports">
<span class="header-section-number">11.4.1.1</span> How to <em>not</em> use a package in Imports</h4>
<p>Sometimes you have a package listed in <code>Imports</code>, but you don’t actually use it inside your package or, at least, R doesn’t think you use it. That leads to a <code>NOTE</code> from <code>R CMD check</code>:</p>
<pre><code>* checking dependencies in R code ... NOTE
Namespace in Imports field not imported from: ‘aaapkg’
  All declared Imports should be used.</code></pre>
<p>This can happen if you need to list an indirect dependency in <code>Imports</code>, perhaps to state a minimum version for it. The tidyverse meta-package has this problem on a large scale, since it exists mostly to install a bundle of packages at specific versions. Another scenario is when your package uses a dependency in such a way that requires another package that is only suggested by the direct dependency<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. There are various situations where it’s not obvious that your package truly needs every package listed in <code>Imports</code>, but in fact it does.</p>
<p>How can you get rid of this <code>NOTE</code>?</p>
<p>Our recommendation is to put a namespace-qualified reference (not a call) to an object in aaapkg in some file below <code>R/</code>, such as a <code>.R</code> file associated with package-wide setup:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ignore_unused_imports</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">aaapkg</span><span class="fu">::</span><span class="va">aaa_fun</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You don’t need to call <code>ignore_unused_imports()</code> anywhere. You shouldn’t export it. You don’t have to actually exercise <code>aaapkg::aaa_fun()</code>. What’s important is to access something in aaapkg’s namespace with <code>::</code>.</p>
<p>An alternative approach you might be tempted to use is to import <code>aaapkg::aaa_fun()</code> into your package’s namespace, probably with the roxygen tag <code>@importFrom aaapkg aaa_fun</code>. This does suppress the <code>NOTE</code>, but it also does more. This causes aaapkg to be loaded whenever your package is loaded. In contrast, if you use the approach we recommend, the aaapkg will only be loaded if your user does something that actually requires it. This rarely matters in practice, but it’s always nice to minimize or delay the loading of additional packages.</p>
</section></section><section id="sec-dependencies-in-imports-in-tests" class="level3" data-number="11.4.2"><h3 data-number="11.4.2" class="anchored" data-anchor-id="sec-dependencies-in-imports-in-tests">
<span class="header-section-number">11.4.2</span> In test code</h3>
<p>Refer to external functions in your tests just as you refer to them in the code below <code>R/</code>. Usually this means you should use <code>aaapkg::aaa_fun()</code>. But if you have imported a particular function, either specifically or as part of an entire namespace, you can just call it directly in your test code.</p>
<p>It’s generally a bad idea to use <code><a href="https://rdrr.io/r/base/library.html">library(aaapkg)</a></code> to attach one of your dependencies somewhere in your tests, because it makes the search path in your tests different from how your package actually works. This is covered in more detail in <a href="testing-design.html#sec-testing-design-tension" class="quarto-xref"><span>Section 14.2.5</span></a>.</p>
</section><section id="in-examples-and-vignettes" class="level3" data-number="11.4.3"><h3 data-number="11.4.3" class="anchored" data-anchor-id="in-examples-and-vignettes">
<span class="header-section-number">11.4.3</span> In examples and vignettes</h3>
<p>If you use a package that appears in <code>Imports</code> in one of your examples or vignettes, you’ll need to either attach the package with <code><a href="https://rdrr.io/r/base/library.html">library(aaapkg)</a></code> or use a <code>aaapkg::aaa_fun()</code>-style call. You can assume that aaapkg is available, because that’s what <code>Imports</code> guarantees. Read more in <a href="man.html#sec-man-examples-dependencies-conditional-execution" class="quarto-xref"><span>Section 16.5.4</span></a> and <a href="vignettes.html#sec-vignettes-eval-option" class="quarto-xref"><span>Section 17.4</span></a>.</p>
</section></section><section id="sec-dependencies-in-suggests" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="sec-dependencies-in-suggests">
<span class="header-section-number">11.5</span> Package is listed in <code>Suggests</code>
</h2>
<p>Consider a dependency that is listed in <code>DESCRIPTION</code> in <code>Suggests</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Suggests</span><span class="kw">:</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="at">    aaapkg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can NOT assume that every user has installed aaapkg (but you can assume that a developer has). Whether a user has aaapkg will depend on how they installed your package. Most of the functions that are used to install packages support a <code>dependencies</code> argument that controls whether to install just the hard dependencies or to take a more expansive approach, which includes suggested packages:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span>dependencies <span class="op">=</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span>dependencies <span class="op">=</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html">pkg_install</a></span><span class="op">(</span>dependencies <span class="op">=</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Broadly speaking, the default is to not install packages in <code>Suggests</code>.</p>
<section id="sec-dependencies-in-suggests-r-code" class="level3" data-number="11.5.1"><h3 data-number="11.5.1" class="anchored" data-anchor-id="sec-dependencies-in-suggests-r-code">
<span class="header-section-number">11.5.1</span> In code below <code>R/</code>
</h3>
<p>Inside a function in your own package, check for the availability of a suggested package with <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("aaapkg", quietly = TRUE)</a></code>. There are two basic scenarios: the dependency is absolutely required or your package offers some sort of fallback behaviour.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the suggested package is required </span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"aaapkg"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span></span>
<span>      <span class="st">"Package \"aaapkg\" must be installed to use this function."</span>,</span>
<span>      call. <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># code that includes calls such as aaapkg::aaa_fun()</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># the suggested package is optional; a fallback method is available</span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"aaapkg"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">aaapkg</span><span class="fu">::</span><span class="fu">aaa_fun</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">g</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The rlang package has some useful functions for checking package availability: <code><a href="https://rlang.r-lib.org/reference/is_installed.html">rlang::check_installed()</a></code> and <code><a href="https://rlang.r-lib.org/reference/is_installed.html">rlang::is_installed()</a></code>. Here’s how the checks around a suggested package could look if you use rlang:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the suggested package is required </span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html">check_installed</a></span><span class="op">(</span><span class="st">"aaapkg"</span>, reason <span class="op">=</span> <span class="st">"to use `aaa_fun()`"</span><span class="op">)</span></span>
<span>  <span class="co"># code that includes calls such as aaapkg::aaa_fun()</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># the suggested package is optional; a fallback method is available</span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html">is_installed</a></span><span class="op">(</span><span class="st">"aaapkg"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">aaapkg</span><span class="fu">::</span><span class="fu">aaa_fun</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">g</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These rlang functions have handy features for programming, such as vectorization over <code>pkg</code>, classed errors with a data payload, and, for <code>check_installed()</code>, an offer to install the needed package in an interactive session.</p>
</section><section id="sec-dependencies-in-suggests-in-tests" class="level3" data-number="11.5.2"><h3 data-number="11.5.2" class="anchored" data-anchor-id="sec-dependencies-in-suggests-in-tests">
<span class="header-section-number">11.5.2</span> In test code</h3>
<p>The tidyverse team generally writes tests as if all suggested packages are available. That is, we use them unconditionally in the tests.</p>
<p>The motivation for this posture is self-consistency and pragmatism. The key package needed to run tests is testthat and it appears in <code>Suggests</code>, not in <code>Imports</code> or <code>Depends</code>. Therefore, if the tests are actually executing, that implies that an expansive notion of package dependencies has been applied.</p>
<p>Also, empirically, in every important scenario of running <code>R CMD check</code>, the suggested packages are installed. This is generally true for CRAN and we ensure that it’s true in our own automated checks. However, it’s important to note that other package maintainers take a different stance and choose to protect all usage of suggested packages in their tests and vignettes.</p>
<p>Sometimes even we make an exception and guard the use of a suggested package in a test. Here’s a test from ggplot2, which uses <code><a href="https://testthat.r-lib.org/reference/skip.html">testthat::skip_if_not_installed()</a></code> to skip execution if the suggested sf package is not available.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"basic plot builds without error"</span>, <span class="op">{</span></span>
<span>  <span class="fu">skip_if_not_installed</span><span class="op">(</span><span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nc_tiny_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">81.473</span>, <span class="op">-</span><span class="fl">81.741</span>, <span class="op">-</span><span class="fl">81.67</span>, <span class="op">-</span><span class="fl">81.345</span>, <span class="op">-</span><span class="fl">81.266</span>, <span class="op">-</span><span class="fl">81.24</span>, <span class="op">-</span><span class="fl">81.473</span>,</span>
<span>      <span class="fl">36.234</span>, <span class="fl">36.392</span>, <span class="fl">36.59</span>, <span class="fl">36.573</span>, <span class="fl">36.437</span>, <span class="fl">36.365</span>, <span class="fl">36.234</span><span class="op">)</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span></span>
<span>    <span class="fu">data_frame</span><span class="op">(</span></span>
<span>      NAME <span class="op">=</span> <span class="st">"ashe"</span>,</span>
<span>      geometry <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_sfc</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_polygon</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">nc_tiny_coords</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">expect_doppelganger</span><span class="op">(</span><span class="st">"sf-polygons"</span>, <span class="fu">ggplot</span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What might justify the use of <code>skip_if_not_installed()</code>? In this case, the sf package can be nontrivial to install and it is conceivable that a contributor would want to run the remaining tests, even if sf is not available.</p>
<p>Finally, note that <code>testthat::skip_if_not_installed(pkg, minimum_version = "x.y.z")</code> can be used to conditionally skip a test based on the version of the other package.</p>
</section><section id="sec-dependencies-in-suggests-in-examples-and-vignettes" class="level3" data-number="11.5.3"><h3 data-number="11.5.3" class="anchored" data-anchor-id="sec-dependencies-in-suggests-in-examples-and-vignettes">
<span class="header-section-number">11.5.3</span> In examples and vignettes</h3>
<p>Another common place to use a suggested package is in an example and here we often guard with <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> or <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace()</a></code>. This example is from <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">ggplot2::coord_map()</a></code>. ggplot2 lists the maps package in <code>Suggests</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @examples</span></span>
<span><span class="co">#' if (require("maps")) {</span></span>
<span><span class="co">#'   nz &lt;- map_data("nz")</span></span>
<span><span class="co">#'   # Prepare a map of NZ</span></span>
<span><span class="co">#'   nzmap &lt;- ggplot(nz, aes(x = long, y = lat, group = group)) +</span></span>
<span><span class="co">#'     geom_polygon(fill = "white", colour = "black")</span></span>
<span><span class="co">#'  </span></span>
<span><span class="co">#'   # Plot it in cartesian coordinates</span></span>
<span><span class="co">#'   nzmap</span></span>
<span><span class="co">#' }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An example is basically the only place where we would use <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> inside a package. Read more in <a href="dependencies-mindset-background.html#sec-dependencies-attach-vs-load" class="quarto-xref"><span>Section 10.4</span></a>.</p>
<p>Our stance regarding the use of suggested packages in vignettes is similar to that for tests. The key packages needed to build vignettes (rmarkdown and knitr) are listed in <code>Suggests</code>. Therefore, if the vignettes are being built, it’s reasonable to assume that all of the suggested packages are available. We typically use suggested packages unconditionally inside vignettes.</p>
<p>But if you choose to use suggested packages conditionally in your vignettes, the knitr chunk option <code>eval</code> is very useful for achieving this. See <a href="vignettes.html#sec-vignettes-eval-option" class="quarto-xref"><span>Section 17.4</span></a> for more.</p>
</section></section><section id="sec-dependencies-in-depends" class="level2" data-number="11.6"><h2 data-number="11.6" class="anchored" data-anchor-id="sec-dependencies-in-depends">
<span class="header-section-number">11.6</span> Package is listed in <code>Depends</code>
</h2>
<p>Consider a dependency that is listed in <code>DESCRIPTION</code> in <code>Depends</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Depends</span><span class="kw">:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="at">    aaapkg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This situation has a lot in common with a package listed in <code>Imports</code>. The code inside your package can assume that aaapkg is installed on the system. The only difference is that aaapkg will be attached whenever your package is.</p>
<section id="in-code-below-r-and-in-test-code" class="level3" data-number="11.6.1"><h3 data-number="11.6.1" class="anchored" data-anchor-id="in-code-below-r-and-in-test-code">
<span class="header-section-number">11.6.1</span> In code below <code>R/</code> and in test code</h3>
<p>Your options are exactly the same as using functions from a package listed in <code>Imports</code>:</p>
<ul>
<li><p>Use the <code>aaapkg::aaa_fun()</code> syntax.</p></li>
<li><p>Import an individual function with the <code>@importFrom aaapkg aaa_fun</code> roxygen tag and call <code>aaa_fun()</code> directly.</p></li>
<li><p>Import the entire aaapkg namespace with the <code>@import aaapkg</code> roxygen tag and call any function directly.</p></li>
</ul>
<p>The main difference between this situation and a dependency listed in <code>Imports</code> is that it’s much more common to import the entire namespace of a package listed in <code>Depends</code>. This often makes sense, due to the special dependency relationship that motivated listing it in <code>Depends</code> in the first place.</p>
</section><section id="in-examples-and-vignettes-1" class="level3" data-number="11.6.2"><h3 data-number="11.6.2" class="anchored" data-anchor-id="in-examples-and-vignettes-1">
<span class="header-section-number">11.6.2</span> In examples and vignettes</h3>
<p>This is the most obvious difference with a dependency in <code>Depends</code> versus <code>Imports</code>. Since your package is attached when your examples are executed, so is the package listed in <code>Depends</code>. You don’t have to attach it explicitly with <code><a href="https://rdrr.io/r/base/library.html">library(aaapkg)</a></code>.</p>
<p>The ggforce package <code>Depends</code> on ggplot2 and the examples for <code>ggforce::geom_mark_rect()</code> use functions like <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2::ggplot()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">ggplot2::geom_point()</a></code> without any explicit call to <code><a href="https://ggplot2.tidyverse.org">library(ggplot2)</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">iris</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">Petal.Length</span>, <span class="va">Petal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_mark_rect</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Species</span>, filter <span class="op">=</span> <span class="va">Species</span> <span class="op">!=</span> <span class="st">'versicolor'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># example code continues ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line of code executed in one of your vignettes is probably <code><a href="https://rdrr.io/r/base/library.html">library(pkg)</a></code>, which attaches your package and, as a side effect, attaches any dependency listed in <code>Depends</code>. You do not need to explicitly attach the dependency before using it. The censored package <code>Depends</code> on the survival package and the code in <code>vignette("examples", package = "censored")</code> starts out like so:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/censored">censored</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span></span>
<span><span class="co"># vignette code continues ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-dependencies-nonstandard" class="level2" data-number="11.7"><h2 data-number="11.7" class="anchored" data-anchor-id="sec-dependencies-nonstandard">
<span class="header-section-number">11.7</span> Package is a nonstandard dependency</h2>
<p>In packages developed with devtools, you may see <code>DESCRIPTION</code> files that use a couple other nonstandard fields for package dependencies specific to development tasks.</p>
<section id="depending-on-the-development-version-of-a-package" class="level3" data-number="11.7.1"><h3 data-number="11.7.1" class="anchored" data-anchor-id="depending-on-the-development-version-of-a-package">
<span class="header-section-number">11.7.1</span> Depending on the development version of a package</h3>
<p>The <code>Remotes</code> field can be used when you need to install a dependency from a nonstandard place, i.e.&nbsp;from somewhere besides CRAN or Bioconductor. One common example of this is when you’re developing against a development version of one of your dependencies. During this time, you’ll want to install the dependency from its development repository, which is often GitHub. The way to specify various remote sources is described in a <a href="https://devtools.r-lib.org/articles/dependencies.html">devtools vignette</a> and in a <a href="https://pak.r-lib.org/reference/pak_package_sources.html">pak help topic</a>.</p>
<p>The dependency and any minimum version requirement still need to be declared in the normal way in, e.g., <code>Imports</code>. <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_dev_package()</a></code> helps to make the necessary changes in <code>DESCRIPTION</code>. If your package temporarily relies on a development version of aaapkg, the affected <code>DESCRIPTION</code> fields might evolve like this:</p>
<!-- This is unlovely, but I just wanted to get the content down "on paper". It's easier to convey with a concrete example. -->
<pre><code>Stable --&gt;               Dev --&gt;                       Stable again
----------------------   ---------------------------   ----------------------
Package: pkg             Package: pkg                  Package: pkg
Version: 1.0.0           Version: 1.0.0.9000           Version: 1.1.0
Imports:                 Imports:                      Imports: 
    aaapkg (&gt;= 2.1.3)       aaapkg (&gt;= 2.1.3.9000)       aaapkg (&gt;= 2.2.0)
                         Remotes:   
                             jane/aaapkg </code></pre>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s important to note that you should not submit your package to CRAN in the intermediate state, meaning with a <code>Remotes</code> field and with a dependency required at a version that’s not available from CRAN or Bioconductor. For CRAN packages, this can only be a temporary development state, eventually resolved when the dependency updates on CRAN and you can bump your minimum version accordingly.</p>
</div>
</div>
</section><section id="sec-dependencies-nonstandard-config-needs" class="level3" data-number="11.7.2"><h3 data-number="11.7.2" class="anchored" data-anchor-id="sec-dependencies-nonstandard-config-needs">
<span class="header-section-number">11.7.2</span> <code>Config/Needs/*</code> field</h3>
<p>You may also see devtools-developed packages with packages listed in <code>DESCRIPTION</code> fields in the form of <code>Config/Needs/*</code>, which we described in <a href="description.html#sec-description-custom-fields" class="quarto-xref"><span>Section 9.8</span></a>.</p>
<!--
https://github.com/wch/r-source/blob/de49776d9fe54cb4580fbbd04906b40fe2f6117e/src/library/tools/R/QC.R#L7133
https://github.com/wch/r-source/blob/efacf56dcf2f880b9db8eafa28d49a08d56e861e/src/library/tools/R/utils.R#L1316-L1389
-->
<p>The use of <code>Config/Needs/*</code> is not directly related to devtools. It’s more accurate to say that it’s associated with continuous integration workflows made available to the community at <a href="https://github.com/r-lib/actions/" class="uri">https://github.com/r-lib/actions/</a> and exposed via functions such as <code><a href="https://usethis.r-lib.org/reference/use_github_actions.html">usethis::use_github_actions()</a></code>. A <code>Config/Needs/*</code> field tells the <a href="https://github.com/r-lib/actions/tree/HEAD/setup-r-dependencies#readme"><code>setup-r-dependencies</code></a> GitHub Action about extra packages that need to be installed.</p>
<p><code>Config/Needs/website</code> is the most common and it provides a place to specify packages that aren’t a formal dependency, but that must be present in order to build the package’s website (<a href="website.html" class="quarto-xref"><span>Chapter 19</span></a>). The readxl package is a good example. It has a <a href="https://readxl.tidyverse.org/articles/readxl-workflows.html">non-vignette article on workflows</a> that shows readxl working in concert with other tidyverse packages, such as readr and purrr. But it doesn’t make sense for readxl to have a formal dependency on readr or purrr or (even worse) the tidyverse!</p>
<p>On the left is what readxl has in the <code>Config/Needs/website</code> field of <code>DESCRIPTION</code> to indicate that the tidyverse is needed in order to build the website, which is also formatted with styling that lives in the <code>tidyverse/template</code> GitHub repo. On the right is the corresponding excerpt from the configuration of the workflow that builds and deploys the website.</p>
<pre><code>in DESCRIPTION                  in .github/workflows/pkgdown.yaml
--------------------------      ---------------------------------
Config/Needs/website:           - uses: r-lib/actions/setup-r-dependencies@v2
    tidyverse,                    with:
    tidyverse/tidytemplate          extra-packages: pkgdown
                                    needs: website</code></pre>
<p>Package websites and continuous integration are discussed more in <a href="website.html" class="quarto-xref"><span>Chapter 19</span></a> and <a href="software-development-practices.html#sec-sw-dev-practices-ci" class="quarto-xref"><span>Section 20.2</span></a>, respectively.</p>
<p>The <code>Config/Needs/*</code> convention is handy because it allows a developer to use <code>DESCRIPTION</code> as their definitive record of package dependencies, while maintaining a clean distinction between true runtime dependencies versus those that are only needed for specialized development tasks.</p>
</section></section><section id="exports" class="level2" data-number="11.8"><h2 data-number="11.8" class="anchored" data-anchor-id="exports">
<span class="header-section-number">11.8</span> Exports</h2>
<p>For a function to be usable outside of your package, you must <strong>export</strong> it. When you create a new package with <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code>, nothing is exported at first, even once you add some functions. You can still experiment interactively with <code>load_all()</code>, since that loads all functions, not just those that are exported. But if you install and attach the package with <code><a href="https://rdrr.io/r/base/library.html">library(pkg)</a></code> in a fresh R session, you’ll notice that no functions are available.</p>
<section id="what-to-export" class="level3" data-number="11.8.1"><h3 data-number="11.8.1" class="anchored" data-anchor-id="what-to-export">
<span class="header-section-number">11.8.1</span> What to export</h3>
<p>Export functions that you want other people to use. Exported functions must be documented, and you must be cautious when changing their interface — other people are using them! Generally, it’s better to export too little than too much. It’s easy to start exporting something that you previously did not; it’s hard to stop exporting a function because it might break existing code. Always err on the side of caution, and simplicity. It’s easier to give people more functionality than it is to take away stuff they’re used to.</p>
<p>We believe that packages that have a wide audience should strive to do one thing and do it well. All functions in a package should be related to a single problem (or a set of closely related problems). Any functions not related to that purpose should not be exported. For example, most of our packages have a <code>utils.R</code> file (<a href="code.html#sec-code-organising" class="quarto-xref"><span>Section 6.1</span></a>) that contains small utility functions that are useful internally, but aren’t part of the core purpose of those packages. We don’t export such functions. There are at least two reasons for this:</p>
<ul>
<li><p>Freedom to be less robust and less general. A utility for internal use doesn’t have to be implemented in the same way as a function used by others. You just need to cover your own use case.</p></li>
<li><p>Regrettable reverse dependencies. You don’t want people depending on your package for functionality and functions that are unrelated to its core purpose.</p></li>
</ul>
<p>That said, if you’re creating a package for yourself, it’s far less important to be this disciplined. Because you know what’s in your package, it’s fine to have a local “miscellany” package that contains a hodgepodge of functions that you find useful. But it is probably not a good idea to release such a package for wider use.</p>
<p>Sometimes your package has a function that could be of interest to other developers extending your package, but not to typical users. In this case, you want to export the function, but also to give it a very low profile in terms of public documentation. This can be achieved by combining the roxygen tags <code>@export</code> and <code>@keywords internal</code>. The <code>internal</code> keyword keeps the function from appearing in the package index, but the associated help topic still exists and the function still appears among those exported in the <code>NAMESPACE</code> file.</p>
</section><section id="re-exporting" class="level3" data-number="11.8.2"><h3 data-number="11.8.2" class="anchored" data-anchor-id="re-exporting">
<span class="header-section-number">11.8.2</span> Re-exporting</h3>
<p>Sometimes you want to make something available to users of your package that is actually provided by one of your dependencies. When devtools was split into several smaller packages (<a href="setup.html#sec-setup-usage" class="quarto-xref"><span>Section 2.2</span></a>), many of the user-facing functions moved elsewhere. For usethis, the chosen solution was to list it in <code>Depends</code> (<a href="dependencies-mindset-background.html#sec-dependencies-imports-vs-depends" class="quarto-xref"><span>Section 10.4.1</span></a>), but that is not a good general solution. Instead, devtools now re-exports certain functions that actually live in a different package.</p>
<p>Here is a blueprint for re-exporting an object from another package, using the <code>session_info()</code> function as our example:</p>
<ol type="1">
<li>
<p>List the package that hosts the re-exported object in <code>Imports</code> in <code>DESCRIPTION</code>.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> In this case, the <code>session_info()</code> function is exported by the sessioninfo package.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="at">    sessioninfo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</li>
<li>
<p>In one of your <code>R/*.R</code> files, have a reference to the target function, preceded by roxygen tags for both importing and exporting.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="co">#' @importFrom sessioninfo session_info</span></span>
<span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="va"><a href="https://sessioninfo.r-lib.org/reference/session_info.html">session_info</a></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</li>
</ol>
<p>That’s it! Next time you re-generate NAMESPACE, these two lines will be there (typically interspersed with other exports and imports):</p>
<pre><code>...
export(session_info)
...
importFrom(sessioninfo,session_info)
...</code></pre>
<p>And this explains how <code><a href="https://devtools.r-lib.org/">library(devtools)</a></code> makes <code>session_info()</code> available in the current session. This will also lead to the creation of the <code>man/reexports.Rd</code> file, which finesses the requirement that your package must document all of its exported functions. This help topic lists all re-exported objects and links to their primary documentation.</p>
</section></section><section id="imports-and-exports-related-to-s3" class="level2" data-number="11.9"><h2 data-number="11.9" class="anchored" data-anchor-id="imports-and-exports-related-to-s3">
<span class="header-section-number">11.9</span> Imports and exports related to S3</h2>
<p>R has multiple object-oriented programming (OOP) systems:</p>
<ul>
<li><p>S3 is currently the most important for us and is what’s addressed in this book. The <a href="https://adv-r.hadley.nz/s3.html">S3 chapter of Advanced R</a> is a good place to learn more about S3 conceptually and the <a href="https://vctrs.r-lib.org">vctrs package</a> is worth studying for practical knowledge.</p></li>
<li><p>S4 is very important within certain R communities, most notably within the Bioconductor project. We only use S4 when it’s necessary for compatibility with other packages. If you want to learn more, the <a href="https://adv-r.hadley.nz/s4.html">S4 chapter of Advanced R</a> is a good starting point and has recommendations for additional resources.</p></li>
<li><p>R6 is used in many tidyverse packages (broadly defined), but is out of scope for this book. Good places to learn more include the <a href="https://r6.r-lib.org">R6 package website</a>, the <a href="https://adv-r.hadley.nz/r6.html">R6 chapter of Advanced R</a>, and the <a href="https://roxygen2.r-lib.org/articles/rd-other.html#r6">roxygen2 documentation related to R6</a>.</p></li>
</ul>
<p>In terms of namespace issues around S3 classes, the main things to consider are generic functions and their class-specific implementations known as methods. If your package “owns” an S3 class, it makes sense to export a user-friendly constructor function. This is often just a regular function and there is no special S3 angle.</p>
<p>If your package “owns” an S3 generic and you want others to be able to use it, you should export the generic. For example, the dplyr package exports the generic function <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code> and also implements and exports a specific method, <code>count.data.frame()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' ... all the usual documentation for count() ...</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">count</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">wt</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sort</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">name</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html">UseMethod</a></span><span class="op">(</span><span class="st">"count"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">count.data.frame</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  <span class="va">wt</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">sort</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">name</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">.drop</span> <span class="op">=</span> <span class="fu">group_by_drop_default</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="va">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The corresponding lines in dplyr’s <code>NAMESPACE</code> file look like this:</p>
<pre><code>...
S3method(count,data.frame)
...
export(count)
...</code></pre>
<p>Now imagine that your package implements a method for <code>count()</code> for a class you “own” (not <code>data.frame</code>). A good example is the dbplyr package, which implements dplyr’s <code>count()</code> generic for dbplyr’s <code>tbl_lazy</code> class.</p>
<p>In this case, <code>@export</code> will not work because it assumes the <code>count()</code> generic is included or imported in the dbplyr <code>NAMESPACE</code>, so instead we need to use <code>@exportS3Method</code>, providing the precise generic that we’re providing a method for.</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @exportS3Method dplyr::count</span></span>
<span><span class="va">count.tbl_lazy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">wt</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sort</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">name</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span> <span class="va">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>NAMESPACE</code>, we have:</p>
<pre><code>S3method(dplyr::count,tbl_lazy)</code></pre>
<p>This also works for generics from packages that are suggested dependencies, e.g.&nbsp;where the glue package implements a method for testthat’s <code>compare()</code> generic: glue lists testthat as only a suggested dependency, so (as of R 3.6.0) R will conditionally register the method <code>compare.glue()</code> when both the testthat and the glue packages are loaded.</p>
<p>dbplyr also provides methods for various generics provided by the base package, such as <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> and <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> - in this case, we can still use <code>@export</code> since the generics are available in the package <code>NAMESPACE</code>.</p>
<p>In <code>dbplyr/R/tbl_lazy.R</code>, we have:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">dim.tbl_lazy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu">op_vars</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">lazy_query</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">names.tbl_lazy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In <code>NAMESPACE</code>, this produces:</p>
<pre><code>S3method(dim,tbl_lazy)
...
S3method(names,tbl_lazy)</code></pre>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>For example, if your package needs to call <code><a href="https://ggplot2.tidyverse.org/reference/geom_hex.html">ggplot2::geom_hex()</a></code>, you might choose to list hexbin in <code>Imports</code>, since ggplot2 only lists it in <code>Suggests</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Remember <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_package()</a></code> is helpful for adding dependencies to <code>DESCRIPTION</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-pkgs\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./dependencies-mindset-background.html" class="pagination-link" aria-label="Dependencies: Mindset and Background">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./license.html" class="pagination-link" aria-label="Licensing">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/dependencies-in-practice.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
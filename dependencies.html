<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>R Packages (2e) - 11&nbsp; Dependencies: What does your package need?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./license.html" rel="next">
<link href="./metadata.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: What does your package need?</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Packages (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r-pkgs/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle sidebar-tool" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Welcome!</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Getting started</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Whole Game</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">System setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Package structure and state</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Fundamental development workflows</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">The package within</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Package components</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">R code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Other components</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Package metadata</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./metadata.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code> and <code>NAMESPACE</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: What does your package need?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">Testing</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Testing basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Designing your test suite</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced testing techniques</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">Documentation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Function documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Vignettes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other markdown files</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Website</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">Maintenance and distribution</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./check.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./continuous-integration.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Continuous integration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Lifecycle</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">11.1</span>  Introduction</a></li>
  <li>
<a href="#run-time-vs-develop-time-dependencies" id="toc-run-time-vs-develop-time-dependencies" class="nav-link" data-scroll-target="#run-time-vs-develop-time-dependencies"><span class="toc-section-number">11.2</span>  Run-time vs develop-time dependencies</a>
  <ul class="collapse">
<li><a href="#guarding-the-use-of-a-suggested-package" id="toc-guarding-the-use-of-a-suggested-package" class="nav-link" data-scroll-target="#guarding-the-use-of-a-suggested-package"><span class="toc-section-number">11.2.1</span>  Guarding the use of a suggested package</a></li>
  <li><a href="#minimum-versions" id="toc-minimum-versions" class="nav-link" data-scroll-target="#minimum-versions"><span class="toc-section-number">11.2.2</span>  Minimum versions</a></li>
  <li><a href="#other-dependencies" id="toc-other-dependencies" class="nav-link" data-scroll-target="#other-dependencies"><span class="toc-section-number">11.2.3</span>  Other dependencies</a></li>
  <li><a href="#nonstandard-dependencies" id="toc-nonstandard-dependencies" class="nav-link" data-scroll-target="#nonstandard-dependencies"><span class="toc-section-number">11.2.4</span>  Nonstandard dependencies</a></li>
  </ul>
</li>
  <li><a href="#exports" id="toc-exports" class="nav-link" data-scroll-target="#exports"><span class="toc-section-number">11.3</span>  Exports</a></li>
  <li>
<a href="#when-should-you-take-a-dependency" id="toc-when-should-you-take-a-dependency" class="nav-link" data-scroll-target="#when-should-you-take-a-dependency"><span class="toc-section-number">11.4</span>  When should you take a dependency?</a>
  <ul class="collapse">
<li><a href="#tidyverse-dependencies" id="toc-tidyverse-dependencies" class="nav-link" data-scroll-target="#tidyverse-dependencies"><span class="toc-section-number">11.4.1</span>  Tidyverse dependencies</a></li>
  </ul>
</li>
  <li>
<a href="#sec-dependencies-namespace" id="toc-sec-dependencies-namespace" class="nav-link" data-scroll-target="#sec-dependencies-namespace"><span class="toc-section-number">11.5</span>  Namespace</a>
  <ul class="collapse">
<li><a href="#sec-dependencies-namespace-motivation" id="toc-sec-dependencies-namespace-motivation" class="nav-link" data-scroll-target="#sec-dependencies-namespace-motivation"><span class="toc-section-number">11.5.1</span>  Motivation</a></li>
  <li><a href="#sec-search-path" id="toc-sec-search-path" class="nav-link" data-scroll-target="#sec-search-path"><span class="toc-section-number">11.5.2</span>  Search path</a></li>
  <li><a href="#namespace-workflow" id="toc-namespace-workflow" class="nav-link" data-scroll-target="#namespace-workflow"><span class="toc-section-number">11.5.3</span>  Workflow</a></li>
  <li><a href="#sec-imports" id="toc-sec-imports" class="nav-link" data-scroll-target="#sec-imports"><span class="toc-section-number">11.5.4</span>  Imports</a></li>
  <li><a href="#import-r" id="toc-import-r" class="nav-link" data-scroll-target="#import-r"><span class="toc-section-number">11.5.5</span>  R functions</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/hadley/r-pkgs/edit/main/dependencies.Rmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-dependencies" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: What does your package need?</span></span></h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header><div class="cell">
<div class="cell-output-display">
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Second edition
</div>
</div>
<div class="callout-body-container callout-body">
<p>You are reading the work-in-progress second edition of R Packages. This chapter is undergoing heavy restructuring and may be confusing or incomplete.</p>
</div>
</div>
</div>
</div>
<section id="introduction" class="level2" data-number="11.1"><h2 data-number="11.1" class="anchored" data-anchor-id="introduction">
<span class="header-section-number">11.1</span> Introduction</h2>
<p>A dependency is a code that your package needs to run. Dependencies are managed by two files. The <code>DESCRIPTION</code> manages dependencies at the package level; i.e.&nbsp;what packages needs to be installed for your package to work. R has a rich set of ways to describe different types of dependencies. A key point is whether a dependency is needed by regular users or is only needed for development tasks or optional functionality.</p>
<p>The flip-side is that your package will also be a dependency of other people’s scripts and packages. The job of the <code>NAMESPACE</code> is to define what functions you make available for others to use. The package namespace (as recorded in the <code>NAMESPACE</code> file) is one of the more confusing parts of building a package. It’s a fairly advanced topic, and by-and-large, not that important if you’re only developing packages for yourself. However, understanding namespaces is vital if you plan to submit your package to CRAN. This is because CRAN requires that your package plays nicely with other packages. When you first start using namespaces, it’ll seem like a lot of work for little gain. However, having a high quality namespace helps encapsulate your package and makes it self-contained. This ensures that other packages won’t interfere with your code, that your code won’t interfere with other packages, and that your package works regardless of the environment in which it’s run.</p>
</section><section id="run-time-vs-develop-time-dependencies" class="level2" data-number="11.2"><h2 data-number="11.2" class="anchored" data-anchor-id="run-time-vs-develop-time-dependencies">
<span class="header-section-number">11.2</span> Run-time vs develop-time dependencies</h2>
<p>Packages listed in <code>Imports</code> are needed by your users at runtime. The following lines indicate that your package absolutely needs both dplyr and tidyr to work.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">    dplyr,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">    tidyr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Packages listed in <code>Suggests</code> are either needed for development tasks or <em>might</em> unlock optional functionality for your users. The lines below indicate that, while your package can take advantage of ggplot2 and testthat, they’re not absolutely required:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Suggests</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">    ggplot2,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">    testthat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For example, the <a href="https://withr.r-lib.org">withr package</a> is very useful for writing tests that clean up after themselves. Such usage is compatible with listing withr in <code>Suggests</code>, since regular users don’t need to run the tests. But sometimes a package might also use withr in its own functions, perhaps to offer its own <code>with_*()</code> and <code>local_*()</code> functions. In that case, withr should be listed in <code>Imports</code>.</p>
<p>Both <code>Imports</code> and <code>Suggests</code> take a comma-separated list of package names. We recommend putting one package on each line, and keeping them in alphabetical order. A non-haphazard order makes it easier for humans to parse this field and appreciate changes. The easiest way to add a package to <code>Imports</code> or <code>Suggests</code> is with <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_package()</a></code>. If the dependencies are already in alphabetical order, <code>use_package()</code> will keep it that way. In general, it can be nice to run <code><a href="https://usethis.r-lib.org/reference/tidyverse.html">usethis::use_tidy_description()</a></code> regularly, which orders and formats <code>DESCRIPTION</code> fields according to a fixed standard.</p>
<p><code>Imports</code> and <code>Suggests</code> differ in the strength and nature of dependency:</p>
<ul>
<li>
<p><code>Imports</code>: packages listed here <em>must</em> be present for your package to work. Any time your package is installed, those packages will also be installed, if not already present. <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> also checks that all packages in <code>Imports</code> are installed.</p>
<p>Adding a package to <code>Imports</code> ensures it will be installed, but it does <em>not</em> mean that it will be attached along with your package, i.e.&nbsp;it does not do the equivalent of <code><a href="https://rdrr.io/r/base/library.html">library(otherpkg)</a></code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Inside your package, the best practice is to explicitly refer to external functions using the syntax <code>package::function()</code>. This makes it very easy to identify which functions live outside of your package. This is especially useful when you read your code in the future.</p>
<p>If you use a lot of functions from another package, this is rather verbose. There’s also a minor performance penalty associated with <code>::</code> (on the order of 5µs, so it will only matter if you call the function millions of times). You’ll learn about alternative ways to make functions in other packages available inside your package in <a href="#sec-imports"><span>Section&nbsp;11.5.4</span></a>.</p>
</li>
<li>
<p><code>Suggests</code>: your package can use these packages, but doesn’t require them. You might use suggested packages for example datasets, to run tests, build vignettes, or maybe there’s only one function that needs the package.</p>
<p>Packages listed in <code>Suggests</code> are not automatically installed along with your package. This means that you can’t assume the package is available unconditionally. Below we show various ways to handle these checks.</p>
</li>
</ul>
<p>If you add packages to <code>DESCRIPTION</code> with <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_package()</a></code>, it will also remind you of the recommended way to call them.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html">use_package</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span> <span class="co"># Default is "Imports"</span></span>
<span><span class="co">#&gt; ✔ Adding 'dplyr' to Imports field in DESCRIPTION</span></span>
<span><span class="co">#&gt; • Refer to functions with `dplyr::fun()`</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html">use_package</a></span><span class="op">(</span><span class="st">"ggplot2"</span>, <span class="st">"Suggests"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Adding 'ggplot2' to Suggests field in DESCRIPTION</span></span>
<span><span class="co">#&gt; • Use `requireNamespace("ggplot2", quietly = TRUE)` to test if package is installed</span></span>
<span><span class="co">#&gt; • Then directly refer to functions with `ggplot2::fun()`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="guarding-the-use-of-a-suggested-package" class="level3" data-number="11.2.1"><h3 data-number="11.2.1" class="anchored" data-anchor-id="guarding-the-use-of-a-suggested-package">
<span class="header-section-number">11.2.1</span> Guarding the use of a suggested package</h3>
<p>Inside a function in your own package, check for the availability of a suggested package with <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("pkg", quietly = TRUE)</a></code>. There are two basic scenarios:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the suggested package is required </span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"pkg"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span></span>
<span>      <span class="st">"Package \"pkg\" must be installed to use this function."</span>,</span>
<span>      call. <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># code that includes calls such as pkg::f()</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># the suggested package is optional; a fallback method is available</span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"pkg"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">pkg</span><span class="fu">::</span><span class="fu">f</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">g</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The rlang package has some useful functions for checking package availability. Here’s how the checks around a suggested package could look if you use rlang:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the suggested package is required </span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html">check_installed</a></span><span class="op">(</span><span class="st">"pkg"</span>, reason <span class="op">=</span> <span class="st">"to use `my_fun()`"</span><span class="op">)</span></span>
<span>  <span class="co"># code that includes calls such as pkg::f()</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># the suggested package is optional; a fallback method is available</span></span>
<span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html">is_installed</a></span><span class="op">(</span><span class="st">"pkg"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">pkg</span><span class="fu">::</span><span class="fu">f</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">g</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These rlang functions have handy features for programming, such as vectorization over <code>pkg</code>, classed errors with a data payload, and, for <code>check_installed()</code>, an offer to install the needed package in an interactive session.</p>
<p><code>Suggests</code> isn’t terribly relevant for packages where the user base is approximately equal to the development team or for packages that are used in a very predictable context. In that case, it’s reasonable to just use <code>Imports</code> for everything. Using <code>Suggests</code> is mostly a courtesy to external users or to accommodate very lean installations. It can free users from downloading rarely needed packages (especially those that are tricky to install) and lets them get started with your package as quickly as possible.</p>
<p>Another common place to use a suggested package is in an example and here we often guard with <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> (but you’ll also see <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace()</a></code> used for this). This example is from <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html">ggplot2::coord_map()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @examples</span></span>
<span><span class="co">#' if (require("maps")) {</span></span>
<span><span class="co">#'   nz &lt;- map_data("nz")</span></span>
<span><span class="co">#'   # Prepare a map of NZ</span></span>
<span><span class="co">#'   nzmap &lt;- ggplot(nz, aes(x = long, y = lat, group = group)) +</span></span>
<span><span class="co">#'     geom_polygon(fill = "white", colour = "black")</span></span>
<span><span class="co">#'  </span></span>
<span><span class="co">#'   # Plot it in cartesian coordinates</span></span>
<span><span class="co">#'   nzmap</span></span>
<span><span class="co">#' }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>An example is basically the only place where we would use <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> inside a package.</p>
<p>Another place you might use a suggested package is in a vignette. The tidyverse team generally writes vignettes as if all suggested packages are available. But if you choose to use suggested packages conditionally in your vignettes, the knitr chunk options <code>purl</code> and <code>eval</code> may be useful for achieving this. See <a href="vignettes.html"><span>Chapter&nbsp;17</span></a> for more discussion of vignettes.</p>
<section id="sec-suggested-packages-and-tests" class="level4" data-number="11.2.1.1"><h4 data-number="11.2.1.1" class="anchored" data-anchor-id="sec-suggested-packages-and-tests">
<span class="header-section-number">11.2.1.1</span> Whether and how to guard in a test</h4>
<p>As with vignettes, the tidyverse team does not usually guard the use of a suggested package in a test. In general, for vignettes and tests, we assume all suggested packages are available. The motivation for this posture is self-consistency and pragmatism. The key packages needed to run tests or build vignettes (e.g.&nbsp;testthat or knitr) appear in <code>Suggests</code>, not in <code>Imports</code> or <code>Depends</code>. Therefore, if the tests are actually executing or the vignettes are being built, that implies that an expansive notion of package dependencies has been applied. Also, empirically, in every important scenario of running <code>R CMD check</code>, the suggested packages are installed. This is generally true for CRAN and we ensure that it’s true in our own automated checks. However, it’s important to note that other package maintainers take a different stance and choose to protect all usage of suggested packages in their tests and vignettes.</p>
<p>Sometimes even the tidyverse team makes an exception and guards the use of a suggested package in a test. Here’s a test from ggplot2, which uses <code><a href="https://testthat.r-lib.org/reference/skip.html">testthat::skip_if_not_installed()</a></code> to skip execution if the suggested sf package is not available.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"basic plot builds without error"</span>, <span class="op">{</span></span>
<span>  <span class="fu">skip_if_not_installed</span><span class="op">(</span><span class="st">"sf"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">nc_tiny_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">81.473</span>, <span class="op">-</span><span class="fl">81.741</span>, <span class="op">-</span><span class="fl">81.67</span>, <span class="op">-</span><span class="fl">81.345</span>, <span class="op">-</span><span class="fl">81.266</span>, <span class="op">-</span><span class="fl">81.24</span>, <span class="op">-</span><span class="fl">81.473</span>,</span>
<span>      <span class="fl">36.234</span>, <span class="fl">36.392</span>, <span class="fl">36.59</span>, <span class="fl">36.573</span>, <span class="fl">36.437</span>, <span class="fl">36.365</span>, <span class="fl">36.234</span><span class="op">)</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_as_sf</span><span class="op">(</span></span>
<span>    <span class="fu">data_frame</span><span class="op">(</span></span>
<span>      NAME <span class="op">=</span> <span class="st">"ashe"</span>,</span>
<span>      geometry <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_sfc</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_polygon</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">nc_tiny_coords</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">expect_doppelganger</span><span class="op">(</span><span class="st">"sf-polygons"</span>, <span class="fu">ggplot</span><span class="op">(</span><span class="va">nc</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_sf</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_sf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What might justify the use of <code><a href="https://testthat.r-lib.org/reference/skip.html">skip_if_not_installed()</a></code>? In this case, the sf package can be nontrivial to install and it is conceivable that a contributor would want to run the remaining tests, even if sf is not available.</p>
<p>Finally, note that <code>testthat::skip_if_not_installed(pkg, minimum_version = "x.y.z")</code> can be used to conditionally skip a test based on the version of the other package.</p>
</section></section><section id="minimum-versions" class="level3" data-number="11.2.2"><h3 data-number="11.2.2" class="anchored" data-anchor-id="minimum-versions">
<span class="header-section-number">11.2.2</span> Minimum versions</h3>
<p>If you need a specific version of a package, specify it in parentheses after the package name:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">    dplyr (&gt;= 1.0.0),</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">    tidyr (&gt;= 1.1.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You always want to specify a minimum version (<code>dplyr (&gt;= 1.0.0)</code>) rather than an exact version (<code>dplyr (== 1.0.0)</code>). Since R can’t have multiple versions of the same package loaded at the same time, specifying an exact dependency dramatically increases the chance of conflicting versions<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Versioning is most important if you will release your package for use by others. Usually people don’t have exactly the same versions of packages installed that you do. If someone has an older package that doesn’t have a function your package needs, they’ll get an unhelpful error message if your package does not advertise the minimum version it needs. However, if you state a minimum version, they’ll learn about this problem clearly, probably at the time of installing your package.</p>
<p>Think carefully if you declare a minimum version for a dependency. In some sense, the safest thing to do is to require a version greater than or equal to the package’s current version. For public work, this is most naturally defined as the current CRAN version of a package; private or personal projects may adopt some other convention. But it’s important to appreciate the implications for people who try to install your package: if their local installation doesn’t fulfill all of your requirements around versions, installation will either fail or force upgrades of these dependencies. This is desirable if your minimum version requirements are genuine, i.e.&nbsp;your package would be broken otherwise. But if your stated requirements have a less solid rationale, this may be unnecessarily conservative and inconvenient.</p>
<p>In the absence of clear, hard requirements, you should set minimum versions (or not) based on your expected user base, the package versions they are likely to have, and a cost-benefit analysis of being too lax versus too conservative. The <em>de facto</em> policy of the tidyverse team is to specify a minimum version when using a known new feature or when someone encounters a version problem in authentic use. This isn’t perfect, but we don’t currently have the tooling to do better, and it seems to work fairly well in practice.</p>
</section><section id="other-dependencies" class="level3" data-number="11.2.3"><h3 data-number="11.2.3" class="anchored" data-anchor-id="other-dependencies">
<span class="header-section-number">11.2.3</span> Other dependencies</h3>
<p>There are three other fields that allow you to express more specialised dependencies:</p>
<ul>
<li>
<p><code>Depends</code>: Prior to the roll-out of namespaces in R 2.14.0 in 2011, <code>Depends</code> was the only way to “depend” on another package. Now, despite the name, you should almost always use <code>Imports</code>, not <code>Depends</code>. You’ll learn why, and when you should still use <code>Depends</code>, in <a href="#sec-dependencies"><span>Chapter&nbsp;11</span></a>.</p>
<p>You can also use <code>Depends</code> to state a minimum version for R itself, e.g. <code>Depends: R (&gt;= 4.0.0)</code>. Again, think carefully if you do this. This raises the same issues as setting a minimum version for a package you depend on, except the stakes are much higher when it comes to R itself. Users can’t simply consent to the necessary upgrade, so, if other packages depend on yours, your minimum version requirement for R can cause a cascade of package installation failures.</p>
<ul>
<li>The <a href="https://cran.r-project.org/package=backports">backports package</a> is useful if you want to use a function like <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code>, which was introduced in 4.0.0 in 2020, while still supporting older R versions.</li>
<li>The tidyverse packages officially support the current R version, the devel version, and four previous versions. We proactively test this support in the standard build matrix we use for continuous integration.</li>
<li>Packages with a lower level of use may not need this level of rigour. The main takeaway is: if you state a minimum of R, you should have a reason and you should take reasonable measures to test your claim regularly.</li>
</ul>
</li>
<li><p><code>LinkingTo</code>: if your package uses C or C++ code from another package, you need to list it here.</p></li>
<li><p><code>Enhances</code>: packages listed here are “enhanced” by your package. Typically, this means you provide methods for classes defined in another package (a sort of reverse <code>Suggests</code>). But it’s hard to define what that means, so we don’t recommend using <code>Enhances</code>.</p></li>
</ul>
<p>You can also list things that your package needs outside of R in the <code>SystemRequirements</code> field. But this is just a plain text field and is not automatically checked. Think of it as a quick reference; you’ll also need to include detailed system requirements (and how to install them) in your README.</p>
<!-- This description of SystemRequirements seems a bit too dismissive or wishy-washy now, given the importance of this field to RSPM, ubuntu-based CI, etc. But at the moment, we think more discussion fits best in the compiled code chapter. -->
<section id="an-r-version-gotcha" class="level4" data-number="11.2.3.1"><h4 data-number="11.2.3.1" class="anchored" data-anchor-id="an-r-version-gotcha">
<span class="header-section-number">11.2.3.1</span> An R version gotcha</h4>
<p>Before we leave this topic, we give a concrete example of how easily an R version dependency can creep in and have a broader impact than you might expect. The <code><a href="https://rdrr.io/r/base/readRDS.html">saveRDS()</a></code> function writes a single R object as an <code>.rds</code> file, an R-specific format. For almost 20 years, <code>.rds</code> files used the “version 2” serialization format. “Version 3” became the new default in R 3.6.0 (released April 2019) and cannot be read by R versions prior to 3.5.0 (released April 2018).</p>
<p>Many R packages have at least one <code>.rds</code> file lurking within and, if that gets re-generated with a modern R version, by default, the new <code>.rds</code> file will have the “version 3” format. When that R package is next built, such as for a CRAN submission, the required R version is automatically bumped to 3.5.0, signaled by this message:</p>
<pre class="console"><code>NB: this package now depends on R (&gt;= 3.5.0)
  WARNING: Added dependency on R &gt;= 3.5.0 because serialized objects in
  serialize/load version 3 cannot be read in older versions of R.
  File(s) containing such objects:
    'path/to/some_file.rds'</code></pre>
<p>Literally, the <code>DESCRIPTION</code> file in the bundled package says <code>Depends: R (&gt;= 3.5.0)</code>, even if <code>DESCRIPTION</code> in the source package says differently<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>.</p>
<p>When such a package is released on CRAN, the new minimum R version is viral, in the sense that all packages listing the original package in <code>Imports</code> or even <code>Suggests</code> have, to varying degrees, inherited the new dependency on R &gt;= 3.5.0.</p>
<p>The immediate take-away is to be very deliberate about the <code>version</code> of <code>.rds</code> files until R versions prior to 3.5.0 have fallen off the edge of what you intend to support. This particular <code>.rds</code> issue won’t be with us forever, but similar issues crop up elsewhere, such as in the standards implicit in compiled C or C++ source code. The broader message is that the more reverse dependencies your package has, the more thought you need to give to your package’s stated minimum versions, especially for R itself.</p>
<!-- TODO: I could probably get the blessing to include a concrete example of this happening, as there are many. For example, the tidymodels team has direct experience. Does that seem necessary / beneficial? -->
</section></section><section id="nonstandard-dependencies" class="level3" data-number="11.2.4"><h3 data-number="11.2.4" class="anchored" data-anchor-id="nonstandard-dependencies">
<span class="header-section-number">11.2.4</span> Nonstandard dependencies</h3>
<p>In packages developed with devtools, you may see <code>DESCRIPTION</code> files that use a couple other nonstandard fields for package dependencies specific to development tasks.</p>
<p>The <code>Remotes</code> field can be used when you need to install a dependency from a nonstandard place, i.e.&nbsp;from somewhere besides CRAN or Bioconductor. One common example of this is when you’re developing against a development version of one of your dependencies. During this time, you’ll want to install the dependency from its development repository, which is often GitHub. The way to specify various remote sources is described in a <a href="https://devtools.r-lib.org/articles/dependencies.html">devtools vignette</a>.</p>
<!-- TODO: long-term, a better link will presumably be https://pak.r-lib.org/reference/pak_package_sources.html, once the pivot from remotes to pak is further along. -->
<p>The dependency and any minimum version requirement still need to be declared in the normal way in, e.g., <code>Imports</code>. <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_dev_package()</a></code> helps to make the necessary changes in <code>DESCRIPTION</code>. If your package temporarily relies on a development version of usethis, the affected <code>DESCRIPTION</code> fields might evolve like this:</p>
<!-- This is unlovely, but I just wanted to get the content down "on paper". It's easier to convey with a concrete example. -->
<pre><code>Stable --&gt;               Dev --&gt;                       Stable again
----------------------   ---------------------------   ----------------------
Package: yourpkg         Package: yourpkg              Package: yourpkg
Version: 1.0.0           Version: 1.0.0.9000           Version: 1.1.0
Imports:                 Imports:                      Imports: 
    usethis (&gt;= 2.1.3)       usethis (&gt;= 2.1.3.9000)       usethis (&gt;= 2.2.0)
                         Remotes:   
                             r-lib/usethis </code></pre>
<p>It’s important to note that you should not submit your package to CRAN in the intermediate state, meaning with a <code>Remotes</code> field and with a dependency required at a version that’s not available from CRAN or Bioconductor. For CRAN packages, this can only be a temporary development state, eventually resolved when the dependency updates on CRAN and you can bump your minimum version accordingly.</p>
<p>You may also see devtools-developed packages with packages listed in <code>DESCRIPTION</code> fields in the form of <code>Config/Needs/*</code>. This pattern takes advantage of the fact that fields prefixed with <code>Config/</code> are ignored by CRAN and also do not trigger a NOTE about “Unknown, possibly mis-spelled, fields in <code>DESCRIPTION</code>”.</p>
<!--
https://github.com/wch/r-source/blob/de49776d9fe54cb4580fbbd04906b40fe2f6117e/src/library/tools/R/QC.R#L7133
https://github.com/wch/r-source/blob/efacf56dcf2f880b9db8eafa28d49a08d56e861e/src/library/tools/R/utils.R#L1316-L1389
-->
<p>The use of <code>Config/Needs/*</code> is not directly related to devtools. It’s more accurate to say that it’s associated with continuous integration workflows made available to the community at <a href="https://github.com/r-lib/actions/" class="uri">https://github.com/r-lib/actions/</a> and exposed via functions such as <code><a href="https://usethis.r-lib.org/reference/github_actions.html">usethis::use_github_actions()</a></code>. A <code>Config/Needs/*</code> field tells the <a href="https://github.com/r-lib/actions/tree/master/setup-r-dependencies#readme"><code>setup-r-dependencies</code></a> GitHub Action about extra packages that need to be installed.</p>
<p><code>Config/Needs/website</code> is the most common and it provides a place to specify packages that aren’t a formal dependency, but that must be present in order to build the package’s website. On the left is an example of what might appear in <code>DESCRIPTION</code> for a package that uses various tidyverse packages in the non-vignette articles on its website, which is also formatted with styling that lives in the <code>tidyverse/template</code> GitHub repo. On the right is the corresponding excerpt from the configuration of the workflow that builds and deploys the website.</p>
<pre><code>in DESCRIPTION                  in .github/workflows/pkgdown.yaml
--------------------------      ---------------------------------
Config/Needs/website:           - uses: r-lib/actions/setup-r-dependencies@v1
    tidyverse,                    with:
    tidyverse/tidytemplate          extra-packages: pkgdown
                                    needs: website</code></pre>
<p>Continuous integration and package websites are discussed more in ?? and ??, respectively. <em>These chapters are a yet-to-be-(re)written task for the 2nd edition.</em></p>
<!-- TODO: Link to CI and pkgdown material when it has been written and/or revised. -->
<p>The <code>Config/Needs/*</code> convention is handy because it allows a developer to use <code>DESCRIPTION</code> as their definitive record of package dependencies, while maintaining a clean distinction between true runtime dependencies versus those that are only needed for specialized development tasks.</p>
<!-- re: describing different types of dependencies, another term you see for "runtime" dependency is "production" -->
</section></section><section id="exports" class="level2" data-number="11.3"><h2 data-number="11.3" class="anchored" data-anchor-id="exports">
<span class="header-section-number">11.3</span> Exports</h2>
<p>For a function to be usable outside of your package, you must <strong>export</strong> it. When you create a new package with <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code>, nothing is exported at first. You can still experiment interactively with <code>load_all()</code> (since that loads all functions, not just those that are exported). But if you install and reload the package, you’ll notice that no functions are available.</p>
<p>To export an object, put <code>@export</code> in its roxygen block. For example:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @export</span></span>
<span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will then generate <code>export()</code>, <code>exportMethods()</code>, <code>exportClass()</code> or <code>S3method()</code> depending on the type of the object.</p>
<p>You export functions that you want other people to use. Exported functions must be documented, and you must be cautious when changing their interface — other people are using them! Generally, it’s better to export too little than too much. It’s easy to export things that you didn’t before; it’s hard to stop exporting a function because it might break existing code. Always err on the side of caution, and simplicity. It’s easier to give people more functionality than it is to take away stuff they’re used to.</p>
<p>I believe that packages that have a wide audience should strive to do one thing and do it well. All functions in a package should be related to a single problem (or a set of closely related problems). Any functions not related to that purpose should not be exported. For example, most of my packages have a <code>utils.R</code> file that contains many small functions that are useful for me, but aren’t part of the core purpose of those packages. I never export these functions.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Defaults for NULL values</span></span>
<span><span class="va">`%||%`</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="va">b</span> <span class="kw">else</span> <span class="va">a</span></span>
<span></span>
<span><span class="co"># Remove NULLs from a list</span></span>
<span><span class="va">compact</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">is.null</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That said, if you’re creating a package for yourself, it’s far less important to be so disciplined. Because you know what’s in your package, it’s fine to have a local “misc” package that contains a passel of functions that you find useful. But I don’t think you should release such a package.</p>
<p>The following sections describe what you should export if you’re using S3, S4 or RC.</p>
</section><section id="when-should-you-take-a-dependency" class="level2" data-number="11.4"><h2 data-number="11.4" class="anchored" data-anchor-id="when-should-you-take-a-dependency">
<span class="header-section-number">11.4</span> When should you take a dependency?</h2>
<p><a href="https://www.tidyverse.org/blog/2019/05/itdepends/" class="uri">https://www.tidyverse.org/blog/2019/05/itdepends/</a></p>
<section id="tidyverse-dependencies" class="level3" data-number="11.4.1"><h3 data-number="11.4.1" class="anchored" data-anchor-id="tidyverse-dependencies">
<span class="header-section-number">11.4.1</span> Tidyverse dependencies</h3>
<p>Here’s our policies about the role of different packages. <code>use_tidy_dependencies()</code>. “Free” dependencies.</p>
</section></section><section id="sec-dependencies-namespace" class="level2" data-number="11.5"><h2 data-number="11.5" class="anchored" data-anchor-id="sec-dependencies-namespace">
<span class="header-section-number">11.5</span> Namespace</h2>
<section id="sec-dependencies-namespace-motivation" class="level3" data-number="11.5.1"><h3 data-number="11.5.1" class="anchored" data-anchor-id="sec-dependencies-namespace-motivation">
<span class="header-section-number">11.5.1</span> Motivation</h3>
<p>As the name suggests, namespaces provide “spaces” for “names”. They provide a context for looking up the value of an object associated with a name.</p>
<p>Without knowing it, you’ve probably already used namespaces. For example, have you ever used the <code>::</code> operator? It disambiguates functions with the same name. For example, both plyr and Hmisc provide a <code>summarize()</code> function. If you load plyr, then Hmisc, <code>summarize()</code> will refer to the Hmisc version. But if you load the packages in the opposite order, <code>summarize()</code> will refer to the plyr version. This can be confusing. Instead, you can explicitly refer to specific functions: <code>Hmisc::summarize()</code> and <code>plyr::summarize()</code>. Then the order in which the packages are loaded won’t matter.</p>
<p>Namespaces make your packages self-contained in two ways: the <strong>imports</strong> and the <strong>exports</strong>. The <strong>imports</strong> defines how a function in one package finds a function in another. To illustrate, consider what happens when someone changes the definition of a function that you rely on: for example, the simple <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> function in base R:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">nrow</span></span>
<span><span class="co">#&gt; function (x) </span></span>
<span><span class="co">#&gt; dim(x)[1L]</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x55ed7c1e96e0&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s defined in terms of <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code>. So what will happen if we override <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> with our own definition? Does <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> break?</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 32</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Surprisingly, it does not! That’s because when <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> looks for an object called <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code>, it uses the package namespace, so it finds <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> in the base environment, not the <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> we created in the global environment.</p>
<p>The <strong>exports</strong> helps you avoid conflicts with other packages by specifying which functions are available outside of your package (internal functions are available only within your package and can’t easily be used by another package). Generally, you want to export a minimal set of functions; the fewer you export, the smaller the chance of a conflict. While conflicts aren’t the end of the world because you can always use <code>::</code> to disambiguate, they’re best avoided where possible because it makes the lives of your users easier.</p>
</section><section id="sec-search-path" class="level3" data-number="11.5.2"><h3 data-number="11.5.2" class="anchored" data-anchor-id="sec-search-path">
<span class="header-section-number">11.5.2</span> Search path</h3>
<p>To understand why namespaces are important, you need a solid understanding of search paths. To call a function, R first has to find it. R does this by first looking in the global environment. If R doesn’t find it there, it looks in the search path, the list of all the packages you have <strong>attached</strong>. You can see this list by running <code><a href="https://rdrr.io/r/base/search.html">search()</a></code>. For example, here’s the search path for the code in this book:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] ".GlobalEnv"        "tools:quarto"      "package:stats"    </span></span>
<span><span class="co">#&gt;  [4] "package:graphics"  "package:grDevices" "package:utils"    </span></span>
<span><span class="co">#&gt;  [7] "package:datasets"  "package:methods"   "Autoloads"        </span></span>
<span><span class="co">#&gt; [10] "package:base"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s an important difference between loading and attaching a package. Normally when you talk about loading a package you think of <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, but that actually attaches the package.</p>
<p>If a package is installed,</p>
<ul>
<li><p><strong>Loading</strong> will load code, data and any DLLs; register S3 and S4 methods; and run the <code>.onLoad()</code> function. After loading, the package is available in memory, but because it’s not in the search path, you won’t be able to access its components without using <code>::</code>. Confusingly, <code>::</code> will also load a package automatically if it isn’t already loaded. It’s rare to load a package explicitly, but you can do so with <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace()</a></code> or <code><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace()</a></code>.</p></li>
<li><p><strong>Attaching</strong> puts the package in the search path. You can’t attach a package without first loading it, so both <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> or <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> load then attach the package. You can see the currently attached packages with <code><a href="https://rdrr.io/r/base/search.html">search()</a></code>.</p></li>
</ul>
<p>If a package isn’t installed, loading (and hence attaching) will fail with an error.</p>
<p>To see the differences more clearly, consider two ways of running <code><a href="https://testthat.r-lib.org/reference/expect_that.html">expect_that()</a></code> from the testthat package. If we use <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, testthat is attached to the search path. If we use <code>::</code>, it’s not.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">old</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">old</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in expect_true(TRUE): could not find function "expect_true"</span></span>
<span>    </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org">testthat</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">old</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "package:testthat"</span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/logical-expectations.html">expect_true</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are four functions that make a package available. They differ based on whether they load or attach, and what happens if the package is not found (i.e., throws an error or returns FALSE).</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 30%">
<col style="width: 57%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>Throws error</th>
<th>Returns <code>FALSE</code>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Load</td>
<td><code>loadNamespace("x")</code></td>
<td><code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("x", quietly = TRUE)</a></code></td>
</tr>
<tr class="even">
<td>Attach</td>
<td><code><a href="https://rdrr.io/r/base/library.html">library(x)</a></code></td>
<td><code><a href="https://rdrr.io/r/base/library.html">require(x, quietly = TRUE)</a></code></td>
</tr>
</tbody>
</table>
<p>Of the four, you should only ever use two:</p>
<ul>
<li><p>Use <code><a href="https://rdrr.io/r/base/library.html">library(x)</a></code> in data analysis scripts. It will throw an error if the package is not installed, and will terminate the script. You want to attach the package to save typing. Never use <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> in a package.</p></li>
<li><p>Use <code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace("x", quietly = TRUE)</a></code> inside a package if you want a specific action (e.g.&nbsp;throw an error) depending on whether or not a suggested package is installed.</p></li>
</ul>
<p>You never need to use <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> (<code><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace()</a></code> is almost always better), or <code><a href="https://rdrr.io/r/base/ns-load.html">loadNamespace()</a></code> (which is only needed for internal R code). You should never use <code><a href="https://rdrr.io/r/base/library.html">require()</a></code> or <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> in a package: instead, use the <code>Depends</code> or <code>Imports</code> fields in the <code>DESCRIPTION</code>.</p>
<p>Now’s a good time to come back to an important issue which we glossed over earlier. What’s the difference between <code>Depends</code> and <code>Imports</code> in the <code>DESCRIPTION</code>? When should you use one or the other?</p>
<p>Listing a package in either <code>Depends</code> or <code>Imports</code> ensures that it’s installed when needed. The main difference is that where <code>Imports</code> just <em>loads</em> the package, <code>Depends</code> <em>attaches</em> it. There are no other differences. The rest of the advice in this chapter applies whether or not the package is in <code>Depends</code> or <code>Imports</code>.</p>
<p>Unless there is a good reason otherwise, you should always list packages in <code>Imports</code> not <code>Depends</code>. That’s because a good package is self-contained, and minimises changes to the global environment (including the search path). The only exception is if your package is designed to be used in conjunction with another package. For example, the <a href="https://github.com/gavinsimpson/analogue">analogue</a> package builds on top of <a href="https://github.com/vegandevs/vegan">vegan</a>. It’s not useful without vegan, so it has vegan in <code>Depends</code> instead of <code>Imports</code>. Similarly, ggplot2 should really <code>Depend</code> on scales, rather than <code>Import</code>ing it.</p>
<p>Now that you understand the importance of the namespace, let’s dive into the nitty gritty details. The two sides of the package namespace, imports and exports, are both described by the <code>NAMESPACE</code>. You’ll learn what this file looks like in the next section. In the section after that, you’ll learn the details of exporting and importing functions and other objects.</p>
</section><section id="namespace-workflow" class="level3" data-number="11.5.3"><h3 data-number="11.5.3" class="anchored" data-anchor-id="namespace-workflow">
<span class="header-section-number">11.5.3</span> Workflow</h3>
<p>Generating the namespace with roxygen2 is just like generating function documentation with roxygen2. You use roxygen2 blocks (starting with <code>#'</code>) and tags (starting with <code>@</code>). The workflow is the same:</p>
<ol type="1">
<li><p>Add roxygen comments to your <code>.R</code> files.</p></li>
<li><p>Run <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> (or press Ctrl/Cmd + Shift + D in RStudio) to convert roxygen comments to <code>.Rd</code> files.</p></li>
<li><p>Look at <code>NAMESPACE</code> and run tests to check that the specification is correct.</p></li>
<li><p>Rinse and repeat until the correct functions are exported.</p></li>
</ol></section><section id="sec-imports" class="level3" data-number="11.5.4"><h3 data-number="11.5.4" class="anchored" data-anchor-id="sec-imports">
<span class="header-section-number">11.5.4</span> Imports</h3>
<p><code>NAMESPACE</code> also controls which external functions can be used by your package without having to use <code>::</code>.</p>
<p>It’s confusing that both <code>DESCRIPTION</code> (through the <code>Imports</code> field) and <code>NAMESPACE</code> (through import directives) seem to be involved in imports. This is just an unfortunate choice of names. The <code>Imports</code> field really has nothing to do with functions imported into the namespace: it just makes sure the package is installed when your package is. It doesn’t make functions available. You need to import functions in exactly the same way regardless of whether or not the package is attached.</p>
<p><code>Depends</code> is just a convenience for the user: if your package is attached, it also attaches all packages listed in <code>Depends</code>. If your package is loaded, packages in <code>Depends</code> are loaded, but not attached, so you need to qualify function names with <code>::</code> or specifically import them.</p>
<p>It’s common for packages to be listed in <code>Imports</code> in <code>DESCRIPTION</code>, but not in <code>NAMESPACE</code>. The converse is not true. Every package mentioned in <code>NAMESPACE</code> must also be present in the <code>Imports</code> or <code>Depends</code> fields.</p>
</section><section id="import-r" class="level3" data-number="11.5.5"><h3 data-number="11.5.5" class="anchored" data-anchor-id="import-r">
<span class="header-section-number">11.5.5</span> R functions</h3>
<p>If you are using just a few functions from another package, my recommendation is to note the package name in the <code>Imports:</code> field of the <code>DESCRIPTION</code> file and call the function(s) explicitly using <code>::</code>, e.g., <code>pkg::fun()</code>.</p>
<p>If you are using functions repeatedly, you can avoid <code>::</code> by importing the function with <code>@importFrom pkg fun</code>. Operators can also be imported in a similar manner, e.g., <code>@importFrom magrittr %&gt;%</code>.</p>
<p>Alternatively, if you are repeatedly using many functions from another package, you can import all of them using <code>@import package</code>. This is the least recommended solution because it makes your code harder to read (you can’t tell where a function is coming from), and if you <code>@import</code> many packages, it increases the chance of conflicting function names.</p>


</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>The difference between loading and attaching a package is covered in more detail in <a href="#sec-search-path"><span>Section&nbsp;11.5.2</span></a>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The need to specify the exact versions of packages, rather than minimum versions, comes up more often in the development of non-package projects. The <a href="https://rstudio.github.io/renv/">renv package</a> provides a way to do this, by implementing project-specific environments (package libraries). renv is a reboot of an earlier package called packrat. If you want to freeze the dependencies of a project at exact versions, use renv instead of (or possibly in addition to) a <code>DESCRIPTION</code> file.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The different package states, such as source vs.&nbsp;bundled, are explained in <a href="structure.html#sec-package-states"><span>Section&nbsp;4.2</span></a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./metadata.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code> and <code>NAMESPACE</code></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./license.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to create a package, the fundamental unit of shareable, reusable, and reproducible R code.">
<title>7&nbsp; Data – R Packages (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./misc.html" rel="next">
<link href="./code.html" rel="prev">
<link href="./images/cover-2e-small.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8c563c05ac8c1d64e78fdaf2b4701079.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Package components</a></li><li class="breadcrumb-item"><a href="./data.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Packages (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r-pkgs/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Package structure and state</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamental development workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The package within</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Package components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other components</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Package metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Testing basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Designing your test suite</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced testing techniques</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Function documentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Vignettes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other markdown files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Website</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Maintenance and distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Software development practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-data-data" id="toc-sec-data-data" class="nav-link active" data-scroll-target="#sec-data-data"><span class="header-section-number">7.1</span> Exported data</a>
  <ul class="collapse">
<li><a href="#sec-data-data-raw" id="toc-sec-data-data-raw" class="nav-link" data-scroll-target="#sec-data-data-raw"><span class="header-section-number">7.1.1</span> Preserve the origin story of package data</a></li>
  <li><a href="#sec-documenting-data" id="toc-sec-documenting-data" class="nav-link" data-scroll-target="#sec-documenting-data"><span class="header-section-number">7.1.2</span> Documenting datasets</a></li>
  <li><a href="#sec-data-non-ascii" id="toc-sec-data-non-ascii" class="nav-link" data-scroll-target="#sec-data-non-ascii"><span class="header-section-number">7.1.3</span> Non-ASCII characters in data</a></li>
  </ul>
</li>
  <li><a href="#sec-data-sysdata" id="toc-sec-data-sysdata" class="nav-link" data-scroll-target="#sec-data-sysdata"><span class="header-section-number">7.2</span> Internal data</a></li>
  <li>
<a href="#sec-data-extdata" id="toc-sec-data-extdata" class="nav-link" data-scroll-target="#sec-data-extdata"><span class="header-section-number">7.3</span> Raw data file</a>
  <ul class="collapse">
<li><a href="#sec-data-system-file" id="toc-sec-data-system-file" class="nav-link" data-scroll-target="#sec-data-system-file"><span class="header-section-number">7.3.1</span> Filepaths</a></li>
  <li><a href="#sec-data-example-path-helper" id="toc-sec-data-example-path-helper" class="nav-link" data-scroll-target="#sec-data-example-path-helper"><span class="header-section-number">7.3.2</span> <code>pkg_example()</code> path helpers</a></li>
  </ul>
</li>
  <li><a href="#sec-data-state" id="toc-sec-data-state" class="nav-link" data-scroll-target="#sec-data-state"><span class="header-section-number">7.4</span> Internal state</a></li>
  <li><a href="#sec-data-persistent" id="toc-sec-data-persistent" class="nav-link" data-scroll-target="#sec-data-persistent"><span class="header-section-number">7.5</span> Persistent user data</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/data.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./code.html">Package components</a></li><li class="breadcrumb-item"><a href="./data.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-data" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>It’s often useful to include data in a package. If the primary purpose of a package is to distribute useful functions, example datasets make it easier to write excellent documentation. These datasets can be hand-crafted to provide compelling use cases for the functions in the package. Here are some examples of this type of package data:</p>
<ul>
<li>
<a href="https://tidyr.tidyverse.org/reference/index.html#data">tidyr</a>: <code>billboard</code> (song rankings), <code>who</code> (tuberculosis data from the World Health Organization)</li>
<li>
<a href="https://dplyr.tidyverse.org/reference/index.html#data">dplyr</a>: <code>starwars</code> (Star Wars characters), <code>storms</code> (storm tracks)</li>
</ul>
<p>At the other extreme, some packages exist solely for the purpose of distributing data, along with its documentation. These are sometimes called “data packages”. A data package can be a nice way to share example data across multiple packages. It is also a useful technique for getting relatively large, static files out of a more function-oriented package, which might require more frequent updates. Here are some examples of data packages:</p>
<ul>
<li><a href="https://nycflights13.tidyverse.org">nycflights13</a></li>
<li>
<a href="http://hadley.github.io/babynames/">babyname</a><a href="https://github.com/hadley/babynames">s</a>
</li>
</ul>
<p>Finally, many packages benefit from having internal data that is used for internal purposes, but that is not directly exposed to the users of the package.</p>
<p>In this chapter we describe useful mechanisms for including data in your package. The practical details differ depending on who needs access to the data, how often it changes, and what they will do with it:</p>
<ul>
<li><p>If you want to store R objects and make them available to the user, put them in <code>data/</code>. This is the best place to put example datasets. All the concrete examples above for data in a package and data as a package use this mechanism. See <a href="#sec-data-data" class="quarto-xref"><span>Section 7.1</span></a>.</p></li>
<li><p>If you want to store R objects for your own use as a developer, put them in <code>R/sysdata.rda</code>. This is the best place to put internal data that your functions need. See <a href="#sec-data-sysdata" class="quarto-xref"><span>Section 7.2</span></a>.</p></li>
<li><p>If you want to store data in some raw, non-R-specific form and make it available to the user, put it in <code>inst/extdata/</code>. For example, readr and readxl each use this mechanism to provide a collection of delimited files and Excel workbooks, respectively. See <a href="#sec-data-extdata" class="quarto-xref"><span>Section 7.3</span></a>.</p></li>
<li><p>If you want to store dynamic data that reflects the internal state of your package within a single R session, use an environment. This technique is not as common or well-known as those above, but can be very useful in specific situations. See <a href="#sec-data-state" class="quarto-xref"><span>Section 7.4</span></a>.</p></li>
<li><p>If you want to store data persistently across R sessions, such as configuration or user-specific data, use one of the officially sanctioned locations. See <a href="#sec-data-persistent" class="quarto-xref"><span>Section 7.5</span></a>.</p></li>
</ul>
<section id="sec-data-data" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="sec-data-data">
<span class="header-section-number">7.1</span> Exported data</h2>
<p>The most common location for package data is (surprise!) <code>data/</code>. We recommend that each file in this directory be an <code>.rda</code> file created by <code><a href="https://rdrr.io/r/base/save.html">save()</a></code> containing a single R object, with the same name as the file. The easiest way to achieve this is to use <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_pkg_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">my_pkg_data</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s imagine we are working on a package named “pkg”. The snippet above creates <code>data/my_pkg_data.rda</code> inside the source of the pkg package and adds <code>LazyData: true</code> in your <code>DESCRIPTION</code>. This makes the <code>my_pkg_data</code> R object available to users of pkg via <code>pkg::my_pkg_data</code> or, after attaching pkg with <code><a href="https://rdrr.io/r/base/library.html">library(pkg)</a></code>, as <code>my_pkg_data</code>.</p>
<p>The snippet above is something the maintainer executes once (or every time they need to update <code>my_pkg_data</code>). This is workflow code and should <strong>not</strong> appear in the <code>R/</code> directory of the source package. (We’ll talk about a suitable place to keep this code below.) For larger datasets, you may want to experiment with the compression setting, which is under the control of the <code>compress</code> argument. The default is “bzip2”, but sometimes “gzip” or “xz” can create smaller files.</p>
<p>It’s possible to use other types of files below <code>data/</code>, but we don’t recommend it because <code>.rda</code> files are already fast, small, and explicit. The other possibilities are described in the documentation for <code><a href="https://rdrr.io/r/utils/data.html">utils::data()</a></code> and in the <a href="https://rstudio.github.io/r-manuals/r-exts/Creating-R-packages.html#data-in-packages">Data in packages</a> section of Writing R Extensions. In terms of advice to package authors, the help topic for <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> seems to implicitly make the same recommendations as we do above:</p>
<ul>
<li>Store one R object in each <code>data/*.rda</code> file</li>
<li>Use the same name for that object and its <code>.rda</code> file</li>
<li>Use lazy-loading, by default</li>
</ul>
<p>If the <code>DESCRIPTION</code> contains <code>LazyData: true</code>, then datasets will be lazily loaded. This means that they won’t occupy any memory until you use them. The following example shows memory usage before and after loading the nycflights13 package. You can see that memory usage doesn’t change significantly until you inspect the <code>flights</code> dataset stored inside the package.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 58.17 MB</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/nycflights13">nycflights13</a></span><span class="op">)</span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 59.92 MB</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/mem_used.html">mem_used</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; 100.63 MB</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We recommend that you include <code>LazyData: true</code> in your <code>DESCRIPTION</code> if you are shipping <code>.rda</code> files below <code>data/</code>. If you use <code>use_data()</code> to create such datasets, it will automatically make this modification to <code>DESCRIPTION</code> for you.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is important to note that lazily-loaded datasets do <strong>not</strong> need to be pre-loaded with <code><a href="https://rdrr.io/r/utils/data.html">utils::data()</a></code> and, in fact, it’s usually best to avoid doing so. Above, once we did <code><a href="https://github.com/hadley/nycflights13">library(nycflights13)</a></code>, we could immediately access <code>flights</code>. There is no call to <code>data(flights)</code>, because it is not necessary.</p>
<p>There are specific downsides to <code>data(some_pkg_data)</code> calls that support a policy of only using <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> when it is actually necessary, i.e.&nbsp;for datasets that would not be available otherwise:</p>
<ul>
<li>By default, <code>data(some_pkg_data)</code>, creates one or more objects in the user’s global workspace. There is the potential to silently overwrite pre-existing objects with new values.</li>
<li>There is also no guarantee that <code>data(foo)</code> will create exactly one object named “foo”. It could create more than one object and/or objects with totally different names.</li>
</ul>
<p>One argument in favor of calls like <code>data(some_pkg_data, package = "pkg")</code> that are not strictly necessary is that it clarifies which package provides <code>some_pkg_data</code>. We prefer alternatives that don’t modify the global workspace, such as a code comment or access via <code>pkg::some_pkg_data</code>.</p>
<p>This excerpt from the documentation of <code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> conveys that it is largely of historical importance:</p>
<blockquote class="blockquote">
<p><code><a href="https://rdrr.io/r/utils/data.html">data()</a></code> was originally intended to allow users to load datasets from packages for use in their examples, and as such it loaded the datasets into the workspace <code>.GlobalEnv</code>. This avoided having large datasets in memory when not in use: that need has been almost entirely superseded by lazy-loading of datasets.</p>
</blockquote>
</div>
</div>
<section id="sec-data-data-raw" class="level3" data-number="7.1.1"><h3 data-number="7.1.1" class="anchored" data-anchor-id="sec-data-data-raw">
<span class="header-section-number">7.1.1</span> Preserve the origin story of package data</h3>
<p>Often, the data you include in <code>data/</code> is a cleaned up version of raw data you’ve gathered from elsewhere. We highly recommend taking the time to include the code used to do this in the source version of your package. This makes it easy for you to update or reproduce your version of the data. This data-creating script is also a natural place to leave comments about important properties of the data, i.e.&nbsp;which features are important for downstream usage in package documentation.</p>
<p>We suggest that you keep this code in one or more <code>.R</code> files below <code>data-raw/</code>. You don’t want it in the bundled version of your package, so this folder should be listed in <code>.Rbuildignore</code>. usethis has a convenience function that can be called when you first adopt the <code>data-raw/</code> practice or when you add an additional <code>.R</code> file to the folder:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data_raw</a></span><span class="op">(</span><span class="st">"my_pkg_data"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>use_data_raw()</code> creates the <code>data-raw/</code> folder and lists it in <code>.Rbuildignore</code>. A typical script in <code>data-raw/</code> includes code to prepare a dataset and ends with a call to <code>use_data()</code>.</p>
<p>These data packages all use the approach recommended here for <code>data-raw/</code>:</p>
<ul>
<li><a href="https://github.com/hadley/babynames">babynames</a></li>
<li><a href="https://github.com/hadley/nycflights13">nycflights13</a></li>
<li><a href="https://github.com/jennybc/gapminder">gapminder</a></li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
ggplot2: A cautionary tale
</div>
</div>
<div class="callout-body-container callout-body">
<p>We have a confession to make: the origins of many of ggplot2’s example datasets have been lost in the sands of time. In the grand scheme of things, this is not a huge problem, but maintenance is certainly more pleasant when a package’s assets can be reconstructed <em>de novo</em> and easily updated as necessary.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Submitting to CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generally, package data should be smaller than a megabyte - if it’s larger you’ll need to argue for an exemption. This is usually easier to do if the data is in its own package and won’t be updated frequently, i.e.&nbsp;if you approach this as a dedicated “data package”. For reference, the babynames and nycflights packages have had a release once every one to two years, since they first appeared on CRAN.</p>
<p>If you are bumping up against size issues, you should be intentional with regards to the method of data compression. The default for <code>usethis::use_data(compress =)</code> is “bzip2”, whereas the default for <code>save(compress =)</code> is (effectively) “gzip”, and “xz” is yet another valid option.</p>
<p>You’ll have to experiment with different compression methods and make this decision empirically. <code>tools::resaveRdaFiles("data/")</code> automates this process, but doesn’t inform you of which compression method was chosen. You can learn this after the fact with <code><a href="https://rdrr.io/r/tools/checkRdaFiles.html">tools::checkRdaFiles()</a></code>. Assuming you are keeping track of the code to generate your data, it would be wise to update the corresponding <code>use_data(compress =)</code> call below <code>data-raw/</code> and re-generate the <code>.rda</code> cleanly.</p>
</div>
</div>
</section><section id="sec-documenting-data" class="level3" data-number="7.1.2"><h3 data-number="7.1.2" class="anchored" data-anchor-id="sec-documenting-data">
<span class="header-section-number">7.1.2</span> Documenting datasets</h3>
<p>Objects in <code>data/</code> are always effectively exported (they use a slightly different mechanism than <code>NAMESPACE</code> but the details are not important). This means that they must be documented. Documenting data is like documenting a function with a few minor differences. Instead of documenting the data directly, you document the name of the dataset and save it in <code>R/</code>. For example, the roxygen2 block used to document the <code>who</code> data in tidyr is saved in <code>R/data.R</code> and looks something like this:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' World Health Organization TB data</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' A subset of data from the World Health Organization Global Tuberculosis</span></span>
<span><span class="co">#' Report ...</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @format ## `who`</span></span>
<span><span class="co">#' A data frame with 7,240 rows and 60 columns:</span></span>
<span><span class="co">#' \describe{</span></span>
<span><span class="co">#'   \item{country}{Country name}</span></span>
<span><span class="co">#'   \item{iso2, iso3}{2 &amp; 3 letter ISO country codes}</span></span>
<span><span class="co">#'   \item{year}{Year}</span></span>
<span><span class="co">#'   ...</span></span>
<span><span class="co">#' }</span></span>
<span><span class="co">#' @source &lt;https://www.who.int/teams/global-tuberculosis-programme/data&gt;</span></span>
<span><span class="st">"who"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are two roxygen tags that are especially important for documenting datasets:</p>
<ul>
<li><p><code>@format</code> gives an overview of the dataset. For data frames, you should include a definition list that describes each variable. It’s usually a good idea to describe variables’ units here.</p></li>
<li><p><code>@source</code> provides details of where you got the data, often a URL.</p></li>
</ul>
<p>Never <code>@export</code> a data set.</p>
</section><section id="sec-data-non-ascii" class="level3" data-number="7.1.3"><h3 data-number="7.1.3" class="anchored" data-anchor-id="sec-data-non-ascii">
<span class="header-section-number">7.1.3</span> Non-ASCII characters in data</h3>
<p>The R objects you store in <code>data/*.rda</code> often contain strings, with the most common example being character columns in a data frame. If you can constrain these strings to only use ASCII characters, it certainly makes things simpler. But of course, there are plenty of legitimate reasons why package data might include non-ASCII characters.</p>
<p>In that case, we recommend that you embrace the <a href="http://utf8everywhere.org">UTF-8 Everywhere manifesto</a> and use the UTF-8 encoding. The <code>DESCRIPTION</code> file placed by <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code> always includes <code>Encoding: UTF-8</code>, so by default a devtools-produced package already advertises that it will use UTF-8.</p>
<p>Making sure that the strings embedded in your package data have the intended encoding is something you accomplish in your data preparation code, i.e.&nbsp;in the R scripts below <code>data-raw/</code>. You can use <code><a href="https://rdrr.io/r/base/Encoding.html">Encoding()</a></code> to learn the current encoding of the elements in a character vector and functions such as <code><a href="https://rdrr.io/r/base/Encoding.html">enc2utf8()</a></code> or <code><a href="https://rdrr.io/r/base/iconv.html">iconv()</a></code> to convert between encodings.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Submitting to CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you have UTF-8-encoded strings in your package data, you may see this from <code>R CMD check</code>:</p>
<pre><code>-   checking data for non-ASCII characters ... NOTE
    Note: found 352 marked UTF-8 strings</code></pre>
<p>This <code>NOTE</code> is truly informational. It requires no action from you. As long as you actually intend to have UTF-8 strings in your package data, all is well.</p>
<p>Ironically, this <code>NOTE</code> is actually suppressed by <code>R CMD check --as-cran</code>, despite the fact that this note does appear in the check results once a package is on CRAN (which implies that CRAN does not necessarily check with <code>--as-cran</code>). By default, <code><a href="https://devtools.r-lib.org/reference/check.html">devtools::check()</a></code> sets the <code>--as-cran</code> flag and therefore does not transmit this <code>NOTE</code>. But you can surface it with <code>check(cran = FALSE, env_vars = c("_R_CHECK_PACKAGE_DATASETS_SUPPRESS_NOTES_" = "false"))</code>.</p>
</div>
</div>
<!-- TODO: Offer some advice for those who have non-ASCII strings in their package and it is a surprise (so, it's not intentional). The best resource I have found so far for this is `tools:::.check_package_datasets()`. Perhaps devtools should get a function that does a ground-up implementation of such a search for non-ASCII strings. -->
<!-- https://github.com/wch/r-source/blob/f6737799b169710006b040f72f9abc5e09180229/src/library/tools/R/QC.R#L4672 -->
</section></section><section id="sec-data-sysdata" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-data-sysdata">
<span class="header-section-number">7.2</span> Internal data</h2>
<p>Sometimes your package functions need access to pre-computed data. If you put these objects in <code>data/</code>, they’ll also be available to package users, which is not appropriate. Sometimes the objects you need are small and simple enough that you can define them with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> or <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> in the code below <code>R/</code>, perhaps in <code>R/data.R</code>. Larger or more complicated objects should be stored in your package’s internal data in <code>R/sysdata.rda</code>, so they are lazy-loaded on demand.</p>
<p>Here are some examples of internal package data:</p>
<ul>
<li>Two colour-related packages, <a href="https://github.com/cwickham/munsell">munsell</a> and <a href="https://cran.r-project.org/web/packages/dichromat/index.html">dichromat</a>, use <code>R/sysdata.rda</code> to store large tables of colour data.</li>
<li>
<a href="https://github.com/tidyverse/googledrive">googledrive</a> and <a href="https://github.com/tidyverse/googlesheets4">googlesheets4</a> wrap the Google Drive and Google Sheets APIs, respectively. Both use <code>R/sysdata.rda</code> to store data derived from a so-called <a href="https://developers.google.com/discovery/v1/reference/apis">Discovery Document</a> which “describes the surface of the API, how to access the API and how API requests and responses are structured”.</li>
</ul>
<!-- Another example I noted: readr + data-raw/date-symbols.R + date_symbols --><p>The easiest way to create <code>R/sysdata.rda</code> is to use <code>usethis::use_data(internal = TRUE)</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">internal_this</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span><span class="va">internal_that</span> <span class="op">&lt;-</span> <span class="va">...</span></span>
<span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">internal_this</span>, <span class="va">internal_that</span>, internal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unlike <code>data/</code>, where you use one <code>.rda</code> file per exported data object, you store all of your internal data objects together in the single file <code>R/sysdata.rda</code>.</p>
<p>Let’s imagine we are working on a package named “pkg”. The snippet above creates <code>R/sysdata.rda</code> inside the source of the pkg package. This makes the objects <code>internal_this</code> and <code>internal_that</code> available for use inside of the functions defined below <code>R/</code> and in the tests. During interactive development, <code>internal_this</code> and <code>internal_that</code> are available after a call to <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code>, just like an internal function.</p>
<p>Much of the advice given for external data holds for internal data as well:</p>
<ul>
<li>It’s a good idea to store the code that generates your individual internal data objects, as well as the <code>use_data()</code> call that writes all of them into <code>R/sysdata.rda</code>. This is workflow code that belongs below <code>data-raw/</code>, not below <code>R/</code>.</li>
<li>
<code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data_raw()</a></code> can be used to initiate the use of <code>data-raw/</code> or to initiate a new <code>.R</code> script there.</li>
<li>If your package is uncomfortably large, experiment with different values of <code>compress</code> in <code>use_data(internal = TRUE)</code>.</li>
</ul>
<p>There are also key distinctions, where the handling of internal and external data differs:</p>
<ul>
<li>Objects in <code>R/sysdata.rda</code> are not exported (they shouldn’t be), so they don’t need to be documented.</li>
<li>The <code>LazyData</code> field in the package <code>DESCRIPTION</code> has no impact on <code>R/sysdata.rda</code> but is strictly about the exported data below <code>data/</code>. Internal data is always lazy-loaded.</li>
</ul></section><section id="sec-data-extdata" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-data-extdata">
<span class="header-section-number">7.3</span> Raw data file</h2>
<p>If you want to show examples of loading/parsing raw data, put the original files in <code>inst/extdata/</code>. When the package is installed, all files (and folders) in <code>inst/</code> are moved up one level to the top-level directory, which is why they can’t have names that conflict with standard parts of an R package, like <code>R/</code> or <code>DESCRIPTION</code> . The files below <code>inst/extdata/</code> in the source package will be located below <code>extdata/</code> in the corresponding installed package. You may want to revisit <a href="structure.html#fig-package-files" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> to review the file structure for different package states.</p>
<p>The main reason to include such files is when a key part of a package’s functionality is to act on an external file. Examples of such packages include:</p>
<ul>
<li>readr, which reads rectangular data out of delimited files</li>
<li>readxl, which reads rectangular data out of Excel spreadsheets</li>
<li>xml2, which can read XML and HTML from file</li>
<li>archive, which can read archive files, such as tar or ZIP</li>
</ul>
<p>All of these packages have one or more example files below <code>inst/extdata/</code>, which are useful for writing documentation and tests.</p>
<p>It is also common for data packages to provide, e.g., a csv version of the package data that is also provided as an R object. Examples of such packages include:</p>
<ul>
<li>palmerpenguins: <code>penguins</code> and <code>penguins_raw</code> are also represented as <code>extdata/penguins.csv</code> and <code>extdata/penguins_raw.csv</code>
</li>
<li>gapminder: <code>gapminder</code>, <code>continent_colors</code>, and <code>country_colors</code> are also represented as <code>extdata/gapminder.tsv</code>, <code>extdata/continent-colors.tsv</code>, and <code>extdata/country-colors.tsv</code>
</li>
</ul>
<p>This has two payoffs: First, it gives teachers and other expositors more to work with once they decide to use a specific dataset. If you’ve started teaching R with <code>palmerpenguins::penguins</code> or <code>gapminder::gapminder</code> and you want to introduce data import, it can be helpful to students if their first use of a new command, like <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_csv()</a></code> or <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code>, is applied to a familiar dataset. They have pre-existing intuition about the expected result. Finally, if package data evolves over time, having a csv or other plain text representation in the source package can make it easier to see what’s changed.</p>
<section id="sec-data-system-file" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="sec-data-system-file">
<span class="header-section-number">7.3.1</span> Filepaths</h3>
<p>The path to a package file found below <code>extdata/</code> clearly depends on the local environment, i.e.&nbsp;it depends on where installed packages live on that machine. The base function <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> can report the full path to files distributed with an R package. It can also be useful to <em>list</em> the files distributed with an R package.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"</span></span>
<span><span class="co">#&gt;  [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"</span></span>
<span><span class="co">#&gt;  [9] "type-me.xls"   "type-me.xlsx"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"clippy.xlsx"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/readxl/extdata/clippy.xlsx"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These filepaths present yet another workflow dilemma: When you’re developing your package, you engage with it in its source form, but your users engage with it as an installed package. Happily, devtools provides a shim for <code><a href="https://rdrr.io/r/base/system.file.html">base::system.file()</a></code> that is activated by <code>load_all()</code>. This makes interactive calls to <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> from the global environment and calls from within the package namespace “just work”.</p>
<p>Be aware that, by default, <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> returns the empty string, not an error, for a file that does not exist.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] ""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you want to force a failure in this case, specify <code>mustWork = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in system.file("extdata", "I_do_not_exist.csv", package = "readr", : no file found</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <a href="https://fs.r-lib.org">fs package</a> offers <code><a href="https://fs.r-lib.org/reference/path_package.html">fs::path_package()</a></code>. This is essentially <code><a href="https://rdrr.io/r/base/system.file.html">base::system.file()</a></code> with a few added features that we find advantageous, whenever it’s reasonable to take a dependency on fs:</p>
<ul>
<li>It errors if the filepath does not exist.</li>
<li>It throws distinct errors when the package does not exist vs.&nbsp;when the file does not exist within the package.</li>
<li>During development, it works for interactive calls, calls from within the loaded package’s namespace, and even for calls originating in dependencies.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"idonotexist"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: Can't find package `idonotexist` in library locations:</span></span>
<span><span class="co">#&gt;   - '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt;   - '/opt/R/4.4.3/lib/R/site-library'</span></span>
<span><span class="co">#&gt;   - '/opt/R/4.4.3/lib/R/library'</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"I_do_not_exist.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: File(s) '/home/runner/work/_temp/Library/readr/extdata/I_do_not_exist.csv' do not exist</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"chickens.csv"</span>, package <span class="op">=</span> <span class="st">"readr"</span><span class="op">)</span></span>
<span><span class="co">#&gt; /home/runner/work/_temp/Library/readr/extdata/chickens.csv</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!--

```
during development               after installation                             

/path/to/local/package           /path/to/some/installed/package
├── DESCRIPTION                  ├── DESCRIPTION
├── ...                          ├── ...
├── inst                         └── some-installed-file.txt
│   └── some-installed-file.txt  
└── ...
```

`fs::path_package("some-installed_file.txt")` builds the correct path in both cases.

A common theme you've now encountered in multiple places is that devtools and related packages try to eliminate hard choices between having a smooth interactive development experience and arranging things correctly in your package.
-->
</section><section id="sec-data-example-path-helper" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="sec-data-example-path-helper">
<span class="header-section-number">7.3.2</span> <code>pkg_example()</code> path helpers</h3>
<p>We like to offer convenience functions that make example files easy to access. These are just user-friendly wrappers around <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> or <code><a href="https://fs.r-lib.org/reference/path_package.html">fs::path_package()</a></code>, but can have added features, such as the ability to list the example files. Here’s the definition and some usage of <code><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl::readxl_example()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">readxl_example</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"readxl"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">path</span>, package <span class="op">=</span> <span class="st">"readxl"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"</span></span>
<span><span class="co">#&gt;  [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"</span></span>
<span><span class="co">#&gt;  [9] "type-me.xls"   "type-me.xlsx"</span></span>
<span></span>
<span><span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/readxl_example.html">readxl_example</a></span><span class="op">(</span><span class="st">"clippy.xlsx"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/_temp/Library/readxl/extdata/clippy.xlsx"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="sec-data-state" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="sec-data-state">
<span class="header-section-number">7.4</span> Internal state</h2>
<p>Sometimes there’s information that multiple functions from your package need to access that:</p>
<ul>
<li>Must be determined at load time (or even later), not at build time. It might even be dynamic.</li>
<li>Doesn’t make sense to pass in via a function argument. Often it’s some obscure detail that a user shouldn’t even know about.</li>
</ul>
<p>A great way to manage such data is to use an <em>environment</em>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> This environment must be created at build time, but you can populate it with values after the package has been loaded and update those values over the course of an R session. This works because environments have reference semantics (whereas more pedestrian R objects, such as atomic vectors, lists, or data frames have value semantics).</p>
<p>Consider a package that can store the user’s favorite letters or numbers. You might start out with code like this in a file below <code>R/</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#' Report my favorite letters</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">mfl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">favorite_letters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Change my favorite letters</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">set_mfl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">24</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="va">favorite_letters</span></span>
<span>  <span class="va">favorite_letters</span> <span class="op">&lt;&lt;-</span> <span class="va">l</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>favorite_letters</code> is initialized to (“a”, “b”, “c”) when the package is built. The user can then inspect <code>favorite_letters</code> with <code>mfl()</code>, at which point they’ll probably want to register <em>their</em> favorite letters with <code>set_mfl()</code>. Note that we’ve used the super assignment operator <code>&lt;&lt;-</code> in <code>set_mfl()</code> in the hope that this will reach up into the package environment and modify the internal data object <code>favorite_letters</code>. But a call to <code>set_mfl()</code> fails like so:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mfl</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c"</span></span>
<span></span>
<span><span class="fu">set_mfl</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"j"</span>, <span class="st">"f"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in set_mfl() : </span></span>
<span><span class="co">#&gt;   cannot change value of locked binding for 'favorite_letters'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because <code>favorite_letters</code> is a regular character vector, modification requires making a copy and rebinding the name <code>favorite_letters</code> to this new value. And that is what’s disallowed: you can’t change the binding for objects in the package namespace (well, at least not without trying harder than this). Defining <code>favorite_letters</code> this way only works if you will never need to modify it.</p>
<p>However, if we maintain state within an internal package environment, we <strong>can</strong> modify objects contained in the environment (and even add completely new objects). Here’s an alternative implementation that uses an internal environment named “the”.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">the</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span>parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">emptyenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co">#' Report my favorite letters</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">mfl2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Change my favorite letters</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="va">set_mfl2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span> <span class="op">=</span> <span class="va">letters</span><span class="op">[</span><span class="fl">24</span><span class="op">:</span><span class="fl">26</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old</span> <span class="op">&lt;-</span> <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span></span>
<span>  <span class="va">the</span><span class="op">$</span><span class="va">favorite_letters</span> <span class="op">&lt;-</span> <span class="va">l</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="va">old</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now a user <em>can</em> register their favorite letters:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">mfl2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a" "b" "c"</span></span>
<span></span>
<span><span class="fu">set_mfl2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"j"</span>, <span class="st">"f"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">mfl2</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "j" "f" "b"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that this new value for <code>the$favorite_letters</code> persists only for the remainder of the current R session (or until the user calls <code>set_mfl2()</code> again). More precisely, the altered state persists only until the next time the package is loaded (including via <code>load_all()</code>). At load time, the environment <code>the</code> is reset to an environment containing exactly one object, named <code>favorite_letters</code>, with value (“a”, “b”, “c”). It’s like the movie Groundhog Day. (We’ll discuss more persistent package- and user-specific data in the next section.)</p>
<p>Jim Hester introduced our group to the nifty idea of using “the” as the name of an internal package environment. This lets you refer to the objects inside in a very natural way, such as <code>the$token</code>, meaning “<em>the</em> token”. It is also important to specify <code>parent = emptyenv()</code> when defining an internal environment, as you generally don’t want the environment to inherit from any other (nonempty) environment.</p>
<p>As seen in the example above, the definition of the environment should happen as a top-level assignment in a file below <code>R/</code>. (In particular, this is a legitimate reason to define a non-function at the top-level of a package; see <a href="code.html#sec-code-when-executed" class="quarto-xref"><span>Section 6.4</span></a> for why this should be rare.) As for where to place this definition, there are two considerations:</p>
<ul>
<li><p>Define it before you use it. If other top-level calls refer to the environment, the definition must come first when the package code is being executed at build time. This is why <code>R/aaa.R</code> is a common and safe choice.</p></li>
<li><p>Make it easy to find later when you’re working on related functionality. If an environment is only used by one family of functions, define it there. If environment usage is sprinkled around the package, define it in a file with package-wide connotations.</p></li>
</ul>
<!-- Examples where we name such an environment "the": rcmdcheck, itdepends, cpp11, gmailr, rlang, covr --><p>Here are some examples of how packages use an internal environment:</p>
<ul>
<li>googledrive: Various functions need to know the file ID for the current user’s home directory on Google Drive. This requires an API call (a relatively expensive and error-prone operation) which yields an eye-watering string of ~40 seemingly random characters that only a computer can love. It would be inhumane to expect a user to know this or to pass it into every function. It would also be inefficient to rediscover the ID repeatedly. Instead, googledrive determines the ID upon first need, then caches it for later use.</li>
<li>usethis: Most functions need to know the active project, i.e.&nbsp;which directory to target for file modification. This is often the current working directory, but that is not an invariant usethis can rely upon. One potential design is to make it possible to specify the target project as an argument of every function in usethis. But this would create significant clutter in the user interface, as well as internal fussiness. Instead, we determine the active project upon first need, cache it, and provide methods for (re)setting it.</li>
</ul>
<p>The blog post <a href="https://trestletech.com/2013/04/package-wide-variablescache-in-r-package/">Package-Wide Variables/Cache in R Packages</a> gives a more detailed development of this technique.</p>
<!-- I've always felt like Hermione's beaded bag / Bag of Holding is a great analogy for this environment technique. As long as you've got this bag, you can keep whatever you like in it. Should I try to develop this? -->
</section><section id="sec-data-persistent" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="sec-data-persistent">
<span class="header-section-number">7.5</span> Persistent user data</h2>
<p>Sometimes there is data that your package obtains, on behalf of itself or the user, that should persist <em>even across R sessions</em>. This is our last and probably least common form of storing package data. For the data to persist this way, it has to be stored on disk and the big question is where to write such a file.</p>
<p>This problem is hardly unique to R. Many applications need to leave notes to themselves. It is best to comply with external conventions, which in this case means the <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">XDG Base Directory Specification</a>. You need to use the official locations for persistent file storage, because it’s the responsible and courteous thing to do and also to comply with CRAN policies.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Submitting to CRAN
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can’t just write persistent data into the user’s home directory. Here’s a relevant excerpt from the CRAN policy at the time of writing:</p>
<blockquote class="blockquote">
<p>Packages should not write in the user’s home filespace (including clipboards), nor anywhere else on the file system apart from the R session’s temporary directory ….</p>
<p>For R version 4.0 or later (hence a version dependency is required or only conditional use is possible), packages may store user-specific data, configuration and cache files in their respective user directories obtained from <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code>, provided that by [sic] default sizes are kept as small as possible and the contents are actively managed (including removing outdated material).</p>
</blockquote>
</div>
</div>
<p>The primary function you should use to derive acceptable locations for user data is <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Here are some examples of the generated filepaths:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.local/share/R/pkg"</span></span>
<span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"config"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.config/R/pkg"</span></span>
<span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/userdir.html">R_user_dir</a></span><span class="op">(</span><span class="st">"pkg"</span>, which <span class="op">=</span> <span class="st">"cache"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/.cache/R/pkg"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One last thing you should consider with respect to persistent data is: does this data <em>really</em> need to persist? Do you <em>really</em> need to be the one responsible for storing it?</p>
<p>If the data is potentially sensitive, such as user credentials, it is recommended to obtain the user’s consent to store it, i.e.&nbsp;to require interactive consent when initiating the cache. Also consider that the user’s operating system or command line tools might provide a means of secure storage that is superior to any DIY solution that you might implement. The packages <a href="https://cran.r-project.org/package=keyring">keyring</a>, <a href="https://gitcreds.r-lib.org">gitcreds</a>, and <a href="https://docs.ropensci.org/credentials/">credentials</a> are examples of packages that tap into externally-provided tooling. Before embarking on any creative solution for storing secrets, consider that your effort is probably better spent integrating with an established tool.</p>


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>If you don’t know much about R environments and what makes them special, a great resource is the <a href="https://adv-r.hadley.nz/environments.html">Environments chapter</a> of Advanced R.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>This example will execute without error if you define <code>favorite_letters</code>, <code>mfl()</code>, and <code>set_mfl()</code> in the global workspace and call <code>set_mfl()</code> in the console. But this code will fail once <code>favorite_letters</code>, <code>mfl()</code>, and <code>set_mfl()</code> are defined <em>inside a package</em>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note that <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code> first appeared in R 4.0. If you need to support older versions of R, then you should use the <a href="https://rappdirs.r-lib.org">rappdirs package</a>, which is a port of the Python appdirs module, and which follows the <a href="https://www.tidyverse.org/blog/2019/04/r-version-support/">tidyverse policy regarding R version support</a>, meaning the minimum supported R version is advancing and will eventually slide past R 4.0. rappdirs produces different filepaths than <code><a href="https://rdrr.io/r/tools/userdir.html">tools::R_user_dir()</a></code>. However, both tools implement something that is consistent with the XDG spec, just with different opinions about how to create filepaths beyond what the spec dictates.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-pkgs\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./code.html" class="pagination-link" aria-label="R code">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R code</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./misc.html" class="pagination-link" aria-label="Other components">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other components</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/data.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>
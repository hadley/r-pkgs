<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 3 R code | R packages</title>
  <meta name="description" content="This is the book site for “R packages”.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 3 R code | R packages" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://r-pkgs.xiaosongz.com" />
  <meta property="og:image" content="https://r-pkgs.xiaosongz.comimages/cover.png" />
  <meta property="og:description" content="This is the book site for “R packages”." />
  <meta name="github-repo" content="hadley/r-pkgs" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 R code | R packages" />
  
  <meta name="twitter:description" content="This is the book site for “R packages”." />
  <meta name="twitter:image" content="https://r-pkgs.xiaosongz.comimages/cover.png" />

<meta name="author" content="Hadley Wickham">


<meta name="date" content="2019-01-29">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="package-structure.html">
<link rel="next" href="description.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R packages by Hadley Wickham</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>R packages</a></li>
<li class="chapter" data-level="1" data-path="intro-why.html"><a href="intro-why.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro-why.html"><a href="intro-why.html#intro-phil"><i class="fa fa-check"></i><b>1.1</b> Philosophy</a></li>
<li class="chapter" data-level="1.2" data-path="intro-why.html"><a href="intro-why.html#intro-outline"><i class="fa fa-check"></i><b>1.2</b> In this book</a></li>
<li class="chapter" data-level="1.3" data-path="intro-why.html"><a href="intro-why.html#intro-get"><i class="fa fa-check"></i><b>1.3</b> Getting started</a></li>
<li class="chapter" data-level="1.4" data-path="intro-why.html"><a href="intro-why.html#intro-ack"><i class="fa fa-check"></i><b>1.4</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.5" data-path="intro-why.html"><a href="intro-why.html#intro-conventions"><i class="fa fa-check"></i><b>1.5</b> Conventions</a></li>
<li class="chapter" data-level="1.6" data-path="intro-why.html"><a href="intro-why.html#intro-colophon"><i class="fa fa-check"></i><b>1.6</b> Colophon</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="package-structure.html"><a href="package-structure.html"><i class="fa fa-check"></i><b>2</b> Package structure</a><ul>
<li class="chapter" data-level="2.1" data-path="package-structure.html"><a href="package-structure.html#naming"><i class="fa fa-check"></i><b>2.1</b> Naming your package</a><ul>
<li class="chapter" data-level="2.1.1" data-path="package-structure.html"><a href="package-structure.html#requirements-for-a-name"><i class="fa fa-check"></i><b>2.1.1</b> Requirements for a name</a></li>
<li class="chapter" data-level="2.1.2" data-path="package-structure.html"><a href="package-structure.html#strategies-for-creating-a-name"><i class="fa fa-check"></i><b>2.1.2</b> Strategies for creating a name</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="package-structure.html"><a href="package-structure.html#getting-started"><i class="fa fa-check"></i><b>2.2</b> Creating a package</a></li>
<li class="chapter" data-level="2.3" data-path="package-structure.html"><a href="package-structure.html#projects"><i class="fa fa-check"></i><b>2.3</b> RStudio projects</a><ul>
<li class="chapter" data-level="2.3.1" data-path="package-structure.html"><a href="package-structure.html#what-is-an-rstudio-project-file"><i class="fa fa-check"></i><b>2.3.1</b> What is an RStudio project file?</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="package-structure.html"><a href="package-structure.html#package"><i class="fa fa-check"></i><b>2.4</b> What is a package?</a><ul>
<li class="chapter" data-level="2.4.1" data-path="package-structure.html"><a href="package-structure.html#source-packages"><i class="fa fa-check"></i><b>2.4.1</b> Source packages</a></li>
<li class="chapter" data-level="2.4.2" data-path="package-structure.html"><a href="package-structure.html#bundled-packages"><i class="fa fa-check"></i><b>2.4.2</b> Bundled packages</a></li>
<li class="chapter" data-level="2.4.3" data-path="package-structure.html"><a href="package-structure.html#binary-packages"><i class="fa fa-check"></i><b>2.4.3</b> Binary packages</a></li>
<li class="chapter" data-level="2.4.4" data-path="package-structure.html"><a href="package-structure.html#install"><i class="fa fa-check"></i><b>2.4.4</b> Installed packages</a></li>
<li class="chapter" data-level="2.4.5" data-path="package-structure.html"><a href="package-structure.html#in-memory-packages"><i class="fa fa-check"></i><b>2.4.5</b> In memory packages</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="package-structure.html"><a href="package-structure.html#library"><i class="fa fa-check"></i><b>2.5</b> What is a library?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="r.html"><a href="r.html"><i class="fa fa-check"></i><b>3</b> R code</a><ul>
<li class="chapter" data-level="3.1" data-path="r.html"><a href="r.html#r-workflow"><i class="fa fa-check"></i><b>3.1</b> R code workflow</a></li>
<li class="chapter" data-level="3.2" data-path="r.html"><a href="r.html#r-organising"><i class="fa fa-check"></i><b>3.2</b> Organising your functions</a></li>
<li class="chapter" data-level="3.3" data-path="r.html"><a href="r.html#style"><i class="fa fa-check"></i><b>3.3</b> Code style</a><ul>
<li class="chapter" data-level="3.3.1" data-path="r.html"><a href="r.html#object-names"><i class="fa fa-check"></i><b>3.3.1</b> Object names</a></li>
<li class="chapter" data-level="3.3.2" data-path="r.html"><a href="r.html#spacing"><i class="fa fa-check"></i><b>3.3.2</b> Spacing</a></li>
<li class="chapter" data-level="3.3.3" data-path="r.html"><a href="r.html#curly-braces"><i class="fa fa-check"></i><b>3.3.3</b> Curly braces</a></li>
<li class="chapter" data-level="3.3.4" data-path="r.html"><a href="r.html#line-length"><i class="fa fa-check"></i><b>3.3.4</b> Line length</a></li>
<li class="chapter" data-level="3.3.5" data-path="r.html"><a href="r.html#indentation"><i class="fa fa-check"></i><b>3.3.5</b> Indentation</a></li>
<li class="chapter" data-level="3.3.6" data-path="r.html"><a href="r.html#assignment"><i class="fa fa-check"></i><b>3.3.6</b> Assignment</a></li>
<li class="chapter" data-level="3.3.7" data-path="r.html"><a href="r.html#commenting-guidelines"><i class="fa fa-check"></i><b>3.3.7</b> Commenting guidelines</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="r.html"><a href="r.html#r-differences"><i class="fa fa-check"></i><b>3.4</b> Top-level code</a><ul>
<li class="chapter" data-level="3.4.1" data-path="r.html"><a href="r.html#loading-code"><i class="fa fa-check"></i><b>3.4.1</b> Loading code</a></li>
<li class="chapter" data-level="3.4.2" data-path="r.html"><a href="r.html#the-r-landscape"><i class="fa fa-check"></i><b>3.4.2</b> The R landscape</a></li>
<li class="chapter" data-level="3.4.3" data-path="r.html"><a href="r.html#when-you-do-need-side-effects"><i class="fa fa-check"></i><b>3.4.3</b> When you <strong>do</strong> need side-effects</a></li>
<li class="chapter" data-level="3.4.4" data-path="r.html"><a href="r.html#s4-classes-generics-and-methods"><i class="fa fa-check"></i><b>3.4.4</b> S4 classes, generics and methods</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="r.html"><a href="r.html#r-cran"><i class="fa fa-check"></i><b>3.5</b> CRAN notes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="description.html"><a href="description.html"><i class="fa fa-check"></i><b>4</b> Package metadata</a><ul>
<li class="chapter" data-level="4.1" data-path="description.html"><a href="description.html#dependencies"><i class="fa fa-check"></i><b>4.1</b> Dependencies: What does your package need?</a><ul>
<li class="chapter" data-level="4.1.1" data-path="description.html"><a href="description.html#versioning"><i class="fa fa-check"></i><b>4.1.1</b> Versioning</a></li>
<li class="chapter" data-level="4.1.2" data-path="description.html"><a href="description.html#other-dependencies"><i class="fa fa-check"></i><b>4.1.2</b> Other dependencies</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="description.html"><a href="description.html#pkg-description"><i class="fa fa-check"></i><b>4.2</b> Title and description: What does your package do?</a></li>
<li class="chapter" data-level="4.3" data-path="description.html"><a href="description.html#author"><i class="fa fa-check"></i><b>4.3</b> Author: who are you?</a><ul>
<li class="chapter" data-level="4.3.1" data-path="description.html"><a href="description.html#on-cran"><i class="fa fa-check"></i><b>4.3.1</b> On CRAN</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="description.html"><a href="description.html#license"><i class="fa fa-check"></i><b>4.4</b> License: Who can use your package?</a><ul>
<li class="chapter" data-level="4.4.1" data-path="description.html"><a href="description.html#on-cran-1"><i class="fa fa-check"></i><b>4.4.1</b> On CRAN</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="description.html"><a href="description.html#version"><i class="fa fa-check"></i><b>4.5</b> Version</a></li>
<li class="chapter" data-level="4.6" data-path="description.html"><a href="description.html#description-misc"><i class="fa fa-check"></i><b>4.6</b> Other components</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="man.html"><a href="man.html"><i class="fa fa-check"></i><b>5</b> Object documentation</a><ul>
<li class="chapter" data-level="5.1" data-path="man.html"><a href="man.html#man-workflow"><i class="fa fa-check"></i><b>5.1</b> The documentation workflow</a></li>
<li class="chapter" data-level="5.2" data-path="man.html"><a href="man.html#man-workflow-2"><i class="fa fa-check"></i><b>5.2</b> Alternative documentation workflow</a></li>
<li class="chapter" data-level="5.3" data-path="man.html"><a href="man.html#roxygen-comments"><i class="fa fa-check"></i><b>5.3</b> Roxygen comments</a></li>
<li class="chapter" data-level="5.4" data-path="man.html"><a href="man.html#man-functions"><i class="fa fa-check"></i><b>5.4</b> Documenting functions</a></li>
<li class="chapter" data-level="5.5" data-path="man.html"><a href="man.html#man-data"><i class="fa fa-check"></i><b>5.5</b> Documenting datasets</a></li>
<li class="chapter" data-level="5.6" data-path="man.html"><a href="man.html#man-packages"><i class="fa fa-check"></i><b>5.6</b> Documenting packages</a></li>
<li class="chapter" data-level="5.7" data-path="man.html"><a href="man.html#man-classes"><i class="fa fa-check"></i><b>5.7</b> Documenting classes, generics and methods</a><ul>
<li class="chapter" data-level="5.7.1" data-path="man.html"><a href="man.html#man-s3"><i class="fa fa-check"></i><b>5.7.1</b> S3</a></li>
<li class="chapter" data-level="5.7.2" data-path="man.html"><a href="man.html#man-s4"><i class="fa fa-check"></i><b>5.7.2</b> S4</a></li>
<li class="chapter" data-level="5.7.3" data-path="man.html"><a href="man.html#man-rc"><i class="fa fa-check"></i><b>5.7.3</b> RC</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="man.html"><a href="man.html#man-special"><i class="fa fa-check"></i><b>5.8</b> Special characters</a></li>
<li class="chapter" data-level="5.9" data-path="man.html"><a href="man.html#dry2"><i class="fa fa-check"></i><b>5.9</b> Do repeat yourself</a><ul>
<li class="chapter" data-level="5.9.1" data-path="man.html"><a href="man.html#inheriting-parameters-from-other-functions"><i class="fa fa-check"></i><b>5.9.1</b> Inheriting parameters from other functions</a></li>
<li class="chapter" data-level="5.9.2" data-path="man.html"><a href="man.html#multiple-man"><i class="fa fa-check"></i><b>5.9.2</b> Documenting multiple functions in the same file</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="man.html"><a href="man.html#text-formatting"><i class="fa fa-check"></i><b>5.10</b> Text formatting reference sheet</a><ul>
<li class="chapter" data-level="5.10.1" data-path="man.html"><a href="man.html#character-formatting"><i class="fa fa-check"></i><b>5.10.1</b> Character formatting</a></li>
<li class="chapter" data-level="5.10.2" data-path="man.html"><a href="man.html#links"><i class="fa fa-check"></i><b>5.10.2</b> Links</a></li>
<li class="chapter" data-level="5.10.3" data-path="man.html"><a href="man.html#lists"><i class="fa fa-check"></i><b>5.10.3</b> Lists</a></li>
<li class="chapter" data-level="5.10.4" data-path="man.html"><a href="man.html#mathematics"><i class="fa fa-check"></i><b>5.10.4</b> Mathematics</a></li>
<li class="chapter" data-level="5.10.5" data-path="man.html"><a href="man.html#tables"><i class="fa fa-check"></i><b>5.10.5</b> Tables</a></li>
<li class="chapter" data-level="5.10.6" data-path="man.html"><a href="man.html#notes"><i class="fa fa-check"></i><b>5.10.6</b> Notes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="vignettes.html"><a href="vignettes.html"><i class="fa fa-check"></i><b>6</b> Vignettes: long-form documentation</a><ul>
<li class="chapter" data-level="6.1" data-path="vignettes.html"><a href="vignettes.html#vignette-workflow"><i class="fa fa-check"></i><b>6.1</b> Vignette workflow</a></li>
<li class="chapter" data-level="6.2" data-path="vignettes.html"><a href="vignettes.html#vignette-metadata"><i class="fa fa-check"></i><b>6.2</b> Metadata</a></li>
<li class="chapter" data-level="6.3" data-path="vignettes.html"><a href="vignettes.html#markdown"><i class="fa fa-check"></i><b>6.3</b> Markdown</a><ul>
<li class="chapter" data-level="6.3.1" data-path="vignettes.html"><a href="vignettes.html#sections"><i class="fa fa-check"></i><b>6.3.1</b> Sections</a></li>
<li class="chapter" data-level="6.3.2" data-path="vignettes.html"><a href="vignettes.html#lists-1"><i class="fa fa-check"></i><b>6.3.2</b> Lists</a></li>
<li class="chapter" data-level="6.3.3" data-path="vignettes.html"><a href="vignettes.html#inline-formatting"><i class="fa fa-check"></i><b>6.3.3</b> Inline formatting</a></li>
<li class="chapter" data-level="6.3.4" data-path="vignettes.html"><a href="vignettes.html#tables-1"><i class="fa fa-check"></i><b>6.3.4</b> Tables</a></li>
<li class="chapter" data-level="6.3.5" data-path="vignettes.html"><a href="vignettes.html#code"><i class="fa fa-check"></i><b>6.3.5</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="vignettes.html"><a href="vignettes.html#knitr"><i class="fa fa-check"></i><b>6.4</b> Knitr</a><ul>
<li class="chapter" data-level="6.4.1" data-path="vignettes.html"><a href="vignettes.html#options"><i class="fa fa-check"></i><b>6.4.1</b> Options</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="vignettes.html"><a href="vignettes.html#vignette-workflow-2"><i class="fa fa-check"></i><b>6.5</b> Development cycle</a></li>
<li class="chapter" data-level="6.6" data-path="vignettes.html"><a href="vignettes.html#vignette-advice"><i class="fa fa-check"></i><b>6.6</b> Advice for writing vignettes</a><ul>
<li class="chapter" data-level="6.6.1" data-path="vignettes.html"><a href="vignettes.html#organisation"><i class="fa fa-check"></i><b>6.6.1</b> Organisation</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="vignettes.html"><a href="vignettes.html#vignette-cran"><i class="fa fa-check"></i><b>6.7</b> CRAN notes</a></li>
<li class="chapter" data-level="6.8" data-path="vignettes.html"><a href="vignettes.html#where-next"><i class="fa fa-check"></i><b>6.8</b> Where next</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tests.html"><a href="tests.html"><i class="fa fa-check"></i><b>7</b> Testing</a><ul>
<li class="chapter" data-level="7.1" data-path="tests.html"><a href="tests.html#test-workflow"><i class="fa fa-check"></i><b>7.1</b> Test workflow</a></li>
<li class="chapter" data-level="7.2" data-path="tests.html"><a href="tests.html#test-structure"><i class="fa fa-check"></i><b>7.2</b> Test structure</a><ul>
<li class="chapter" data-level="7.2.1" data-path="tests.html"><a href="tests.html#expectations"><i class="fa fa-check"></i><b>7.2.1</b> Expectations</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="tests.html"><a href="tests.html#test-tests"><i class="fa fa-check"></i><b>7.3</b> Writing tests</a><ul>
<li class="chapter" data-level="7.3.1" data-path="tests.html"><a href="tests.html#what-to-test"><i class="fa fa-check"></i><b>7.3.1</b> What to test</a></li>
<li class="chapter" data-level="7.3.2" data-path="tests.html"><a href="tests.html#skipping-a-test"><i class="fa fa-check"></i><b>7.3.2</b> Skipping a test</a></li>
<li class="chapter" data-level="7.3.3" data-path="tests.html"><a href="tests.html#building-your-own-testing-tools"><i class="fa fa-check"></i><b>7.3.3</b> Building your own testing tools</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="tests.html"><a href="tests.html#test-files"><i class="fa fa-check"></i><b>7.4</b> Test files</a></li>
<li class="chapter" data-level="7.5" data-path="tests.html"><a href="tests.html#test-cran"><i class="fa fa-check"></i><b>7.5</b> CRAN notes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="namespace.html"><a href="namespace.html"><i class="fa fa-check"></i><b>8</b> Namespace</a><ul>
<li class="chapter" data-level="8.1" data-path="namespace.html"><a href="namespace.html#namespace-motivation"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="namespace.html"><a href="namespace.html#search-path"><i class="fa fa-check"></i><b>8.2</b> Search path</a></li>
<li class="chapter" data-level="8.3" data-path="namespace.html"><a href="namespace.html#namespace-NAMESPACE"><i class="fa fa-check"></i><b>8.3</b> The <code>NAMESPACE</code></a></li>
<li class="chapter" data-level="8.4" data-path="namespace.html"><a href="namespace.html#namespace-workflow"><i class="fa fa-check"></i><b>8.4</b> Workflow</a></li>
<li class="chapter" data-level="8.5" data-path="namespace.html"><a href="namespace.html#exports"><i class="fa fa-check"></i><b>8.5</b> Exports</a><ul>
<li class="chapter" data-level="8.5.1" data-path="namespace.html"><a href="namespace.html#export-s3"><i class="fa fa-check"></i><b>8.5.1</b> S3</a></li>
<li class="chapter" data-level="8.5.2" data-path="namespace.html"><a href="namespace.html#export-s4"><i class="fa fa-check"></i><b>8.5.2</b> S4</a></li>
<li class="chapter" data-level="8.5.3" data-path="namespace.html"><a href="namespace.html#export-rc"><i class="fa fa-check"></i><b>8.5.3</b> RC</a></li>
<li class="chapter" data-level="8.5.4" data-path="namespace.html"><a href="namespace.html#export-data"><i class="fa fa-check"></i><b>8.5.4</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="namespace.html"><a href="namespace.html#imports"><i class="fa fa-check"></i><b>8.6</b> Imports</a><ul>
<li class="chapter" data-level="8.6.1" data-path="namespace.html"><a href="namespace.html#import-r"><i class="fa fa-check"></i><b>8.6.1</b> R functions</a></li>
<li class="chapter" data-level="8.6.2" data-path="namespace.html"><a href="namespace.html#import-s3"><i class="fa fa-check"></i><b>8.6.2</b> S3</a></li>
<li class="chapter" data-level="8.6.3" data-path="namespace.html"><a href="namespace.html#import-s4"><i class="fa fa-check"></i><b>8.6.3</b> S4</a></li>
<li class="chapter" data-level="8.6.4" data-path="namespace.html"><a href="namespace.html#import-src"><i class="fa fa-check"></i><b>8.6.4</b> Compiled functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>9</b> External data</a><ul>
<li class="chapter" data-level="9.1" data-path="data.html"><a href="data.html#data-data"><i class="fa fa-check"></i><b>9.1</b> Exported data</a><ul>
<li class="chapter" data-level="9.1.1" data-path="data.html"><a href="data.html#documenting-data"><i class="fa fa-check"></i><b>9.1.1</b> Documenting datasets</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="data.html"><a href="data.html#data-sysdata"><i class="fa fa-check"></i><b>9.2</b> Internal data</a></li>
<li class="chapter" data-level="9.3" data-path="data.html"><a href="data.html#data-extdata"><i class="fa fa-check"></i><b>9.3</b> Raw data</a></li>
<li class="chapter" data-level="9.4" data-path="data.html"><a href="data.html#other-data"><i class="fa fa-check"></i><b>9.4</b> Other data</a></li>
<li class="chapter" data-level="9.5" data-path="data.html"><a href="data.html#data-cran"><i class="fa fa-check"></i><b>9.5</b> CRAN notes</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="src.html"><a href="src.html"><i class="fa fa-check"></i><b>10</b> Compiled code</a><ul>
<li class="chapter" data-level="10.1" data-path="src.html"><a href="src.html#cpp"><i class="fa fa-check"></i><b>10.1</b> C++</a><ul>
<li class="chapter" data-level="10.1.1" data-path="src.html"><a href="src.html#cpp-workflow"><i class="fa fa-check"></i><b>10.1.1</b> Workflow</a></li>
<li class="chapter" data-level="10.1.2" data-path="src.html"><a href="src.html#cpp-man"><i class="fa fa-check"></i><b>10.1.2</b> Documentation</a></li>
<li class="chapter" data-level="10.1.3" data-path="src.html"><a href="src.html#cpp-export"><i class="fa fa-check"></i><b>10.1.3</b> Exporting C++ code</a></li>
<li class="chapter" data-level="10.1.4" data-path="src.html"><a href="src.html#cpp-import"><i class="fa fa-check"></i><b>10.1.4</b> Importing C++ code</a></li>
<li class="chapter" data-level="10.1.5" data-path="src.html"><a href="src.html#cpp-best-practices"><i class="fa fa-check"></i><b>10.1.5</b> Best practices</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="src.html"><a href="src.html#clang"><i class="fa fa-check"></i><b>10.2</b> C</a><ul>
<li class="chapter" data-level="10.2.1" data-path="src.html"><a href="src.html#getting-started-with-.call"><i class="fa fa-check"></i><b>10.2.1</b> Getting started with <code>.Call()</code></a></li>
<li class="chapter" data-level="10.2.2" data-path="src.html"><a href="src.html#getting-started-with-.c"><i class="fa fa-check"></i><b>10.2.2</b> Getting started with <code>.C()</code></a></li>
<li class="chapter" data-level="10.2.3" data-path="src.html"><a href="src.html#c-workflow"><i class="fa fa-check"></i><b>10.2.3</b> Workflow</a></li>
<li class="chapter" data-level="10.2.4" data-path="src.html"><a href="src.html#c-export"><i class="fa fa-check"></i><b>10.2.4</b> Exporting C code</a></li>
<li class="chapter" data-level="10.2.5" data-path="src.html"><a href="src.html#c-import"><i class="fa fa-check"></i><b>10.2.5</b> Importing C code</a></li>
<li class="chapter" data-level="10.2.6" data-path="src.html"><a href="src.html#c-best-practices"><i class="fa fa-check"></i><b>10.2.6</b> Best practices</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="src.html"><a href="src.html#src-debugging"><i class="fa fa-check"></i><b>10.3</b> Debugging compiled code</a></li>
<li class="chapter" data-level="10.4" data-path="src.html"><a href="src.html#make"><i class="fa fa-check"></i><b>10.4</b> Makefiles</a></li>
<li class="chapter" data-level="10.5" data-path="src.html"><a href="src.html#src-other"><i class="fa fa-check"></i><b>10.5</b> Other languages</a></li>
<li class="chapter" data-level="10.6" data-path="src.html"><a href="src.html#src-licensing"><i class="fa fa-check"></i><b>10.6</b> Licensing</a></li>
<li class="chapter" data-level="10.7" data-path="src.html"><a href="src.html#src-workflow"><i class="fa fa-check"></i><b>10.7</b> Development workflow</a></li>
<li class="chapter" data-level="10.8" data-path="src.html"><a href="src.html#src-cran"><i class="fa fa-check"></i><b>10.8</b> CRAN issues</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="inst.html"><a href="inst.html"><i class="fa fa-check"></i><b>11</b> Installed files</a><ul>
<li class="chapter" data-level="11.1" data-path="inst.html"><a href="inst.html#inst-citation"><i class="fa fa-check"></i><b>11.1</b> Package citation</a></li>
<li class="chapter" data-level="11.2" data-path="inst.html"><a href="inst.html#inst-other-langs"><i class="fa fa-check"></i><b>11.2</b> Other languages</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="misc.html"><a href="misc.html"><i class="fa fa-check"></i><b>12</b> Other components</a><ul>
<li class="chapter" data-level="12.1" data-path="misc.html"><a href="misc.html#demo"><i class="fa fa-check"></i><b>12.1</b> Demos</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>13</b> Git and GitHub</a><ul>
<li class="chapter" data-level="13.1" data-path="git.html"><a href="git.html#git-rstudio"><i class="fa fa-check"></i><b>13.1</b> RStudio, Git and GitHub</a></li>
<li class="chapter" data-level="13.2" data-path="git.html"><a href="git.html#git-setup"><i class="fa fa-check"></i><b>13.2</b> Initial set up</a></li>
<li class="chapter" data-level="13.3" data-path="git.html"><a href="git.html#git-init"><i class="fa fa-check"></i><b>13.3</b> Create a local Git repository</a></li>
<li class="chapter" data-level="13.4" data-path="git.html"><a href="git.html#git-status"><i class="fa fa-check"></i><b>13.4</b> See what’s changed</a></li>
<li class="chapter" data-level="13.5" data-path="git.html"><a href="git.html#git-commit"><i class="fa fa-check"></i><b>13.5</b> Record changes</a></li>
<li class="chapter" data-level="13.6" data-path="git.html"><a href="git.html#commit-best-practices"><i class="fa fa-check"></i><b>13.6</b> Commit best practices</a></li>
<li class="chapter" data-level="13.7" data-path="git.html"><a href="git.html#git-ignore"><i class="fa fa-check"></i><b>13.7</b> Ignoring files</a></li>
<li class="chapter" data-level="13.8" data-path="git.html"><a href="git.html#git-undo"><i class="fa fa-check"></i><b>13.8</b> Undo a mistake</a></li>
<li class="chapter" data-level="13.9" data-path="git.html"><a href="git.html#github-init"><i class="fa fa-check"></i><b>13.9</b> Synchronising with GitHub</a></li>
<li class="chapter" data-level="13.10" data-path="git.html"><a href="git.html#github-benefit"><i class="fa fa-check"></i><b>13.10</b> Benefits of using GitHub</a></li>
<li class="chapter" data-level="13.11" data-path="git.html"><a href="git.html#git-pull"><i class="fa fa-check"></i><b>13.11</b> Working with others</a></li>
<li class="chapter" data-level="13.12" data-path="git.html"><a href="git.html#github-issues"><i class="fa fa-check"></i><b>13.12</b> Issues</a></li>
<li class="chapter" data-level="13.13" data-path="git.html"><a href="git.html#git-branch"><i class="fa fa-check"></i><b>13.13</b> Branches</a></li>
<li class="chapter" data-level="13.14" data-path="git.html"><a href="git.html#git-pullreq"><i class="fa fa-check"></i><b>13.14</b> Making a pull request</a></li>
<li class="chapter" data-level="13.15" data-path="git.html"><a href="git.html#pr-make"><i class="fa fa-check"></i><b>13.15</b> Submitting a pull request to another repo</a></li>
<li class="chapter" data-level="13.16" data-path="git.html"><a href="git.html#pr-accept"><i class="fa fa-check"></i><b>13.16</b> Reviewing and accepting pull requests</a></li>
<li class="chapter" data-level="13.17" data-path="git.html"><a href="git.html#git-learning"><i class="fa fa-check"></i><b>13.17</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="check.html"><a href="check.html"><i class="fa fa-check"></i><b>14</b> Automated checking</a><ul>
<li class="chapter" data-level="14.1" data-path="check.html"><a href="check.html#check-workflow"><i class="fa fa-check"></i><b>14.1</b> Workflow</a></li>
<li class="chapter" data-level="14.2" data-path="check.html"><a href="check.html#check-checks"><i class="fa fa-check"></i><b>14.2</b> Checks</a><ul>
<li class="chapter" data-level="14.2.1" data-path="check.html"><a href="check.html#check-metadata"><i class="fa fa-check"></i><b>14.2.1</b> Check metadata</a></li>
<li class="chapter" data-level="14.2.2" data-path="check.html"><a href="check.html#package-structure-1"><i class="fa fa-check"></i><b>14.2.2</b> Package structure</a></li>
<li class="chapter" data-level="14.2.3" data-path="check.html"><a href="check.html#description-1"><i class="fa fa-check"></i><b>14.2.3</b> Description</a></li>
<li class="chapter" data-level="14.2.4" data-path="check.html"><a href="check.html#namespace-1"><i class="fa fa-check"></i><b>14.2.4</b> Namespace</a></li>
<li class="chapter" data-level="14.2.5" data-path="check.html"><a href="check.html#r-code"><i class="fa fa-check"></i><b>14.2.5</b> R code</a></li>
<li class="chapter" data-level="14.2.6" data-path="check.html"><a href="check.html#data-1"><i class="fa fa-check"></i><b>14.2.6</b> Data</a></li>
<li class="chapter" data-level="14.2.7" data-path="check.html"><a href="check.html#documentation"><i class="fa fa-check"></i><b>14.2.7</b> Documentation</a></li>
<li class="chapter" data-level="14.2.8" data-path="check.html"><a href="check.html#demos"><i class="fa fa-check"></i><b>14.2.8</b> Demos</a></li>
<li class="chapter" data-level="14.2.9" data-path="check.html"><a href="check.html#compiled-code"><i class="fa fa-check"></i><b>14.2.9</b> Compiled code</a></li>
<li class="chapter" data-level="14.2.10" data-path="check.html"><a href="check.html#tests-1"><i class="fa fa-check"></i><b>14.2.10</b> Tests</a></li>
<li class="chapter" data-level="14.2.11" data-path="check.html"><a href="check.html#vignettes-1"><i class="fa fa-check"></i><b>14.2.11</b> Vignettes</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="check.html"><a href="check.html#travis"><i class="fa fa-check"></i><b>14.3</b> Checking after every commit with Travis</a><ul>
<li class="chapter" data-level="14.3.1" data-path="check.html"><a href="check.html#basic-config"><i class="fa fa-check"></i><b>14.3.1</b> Basic config</a></li>
<li class="chapter" data-level="14.3.2" data-path="check.html"><a href="check.html#other-uses"><i class="fa fa-check"></i><b>14.3.2</b> Other uses</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="release.html"><a href="release.html"><i class="fa fa-check"></i><b>15</b> Releasing a package</a><ul>
<li class="chapter" data-level="15.1" data-path="release.html"><a href="release.html#release-version"><i class="fa fa-check"></i><b>15.1</b> Version number</a></li>
<li class="chapter" data-level="15.2" data-path="release.html"><a href="release.html#compatibility"><i class="fa fa-check"></i><b>15.2</b> Backward compatibility</a></li>
<li class="chapter" data-level="15.3" data-path="release.html"><a href="release.html#release-check"><i class="fa fa-check"></i><b>15.3</b> The submission process</a><ul>
<li class="chapter" data-level="15.3.1" data-path="release.html"><a href="release.html#release-test-env"><i class="fa fa-check"></i><b>15.3.1</b> Test environments</a></li>
<li class="chapter" data-level="15.3.2" data-path="release.html"><a href="release.html#release-check"><i class="fa fa-check"></i><b>15.3.2</b> Check results</a></li>
<li class="chapter" data-level="15.3.3" data-path="release.html"><a href="release.html#release-deps"><i class="fa fa-check"></i><b>15.3.3</b> Reverse dependencies</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="release.html"><a href="release.html#cran-policies"><i class="fa fa-check"></i><b>15.4</b> CRAN policies</a></li>
<li class="chapter" data-level="15.5" data-path="release.html"><a href="release.html#important-files"><i class="fa fa-check"></i><b>15.5</b> Important files</a><ul>
<li class="chapter" data-level="15.5.1" data-path="release.html"><a href="release.html#readme"><i class="fa fa-check"></i><b>15.5.1</b> README.md</a></li>
<li class="chapter" data-level="15.5.2" data-path="release.html"><a href="release.html#readme-rmd"><i class="fa fa-check"></i><b>15.5.2</b> README.Rmd</a></li>
<li class="chapter" data-level="15.5.3" data-path="release.html"><a href="release.html#news"><i class="fa fa-check"></i><b>15.5.3</b> NEWS.md</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="release.html"><a href="release.html#release-submission"><i class="fa fa-check"></i><b>15.6</b> Release</a><ul>
<li class="chapter" data-level="15.6.1" data-path="release.html"><a href="release.html#on-failure"><i class="fa fa-check"></i><b>15.6.1</b> On failure</a></li>
<li class="chapter" data-level="15.6.2" data-path="release.html"><a href="release.html#binary-builds"><i class="fa fa-check"></i><b>15.6.2</b> Binary builds</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="release.html"><a href="release.html#post-release"><i class="fa fa-check"></i><b>15.7</b> Prepare for next version</a></li>
<li class="chapter" data-level="15.8" data-path="release.html"><a href="release.html#promotion"><i class="fa fa-check"></i><b>15.8</b> Publicising your package</a></li>
<li class="chapter" data-level="15.9" data-path="release.html"><a href="release.html#congratulations"><i class="fa fa-check"></i><b>15.9</b> Congratulations!</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/hadley/r-pkgs/" target="blank">PBuilding R package - Hadley Wickham</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> R code</h1>
<p>The first principle of using a package is that all R code goes in <code>R/</code>. In this chapter, you’ll learn about the <code>R/</code> directory, my recommendations for organising your functions into files, and some general tips on good style. You’ll also learn about some important differences between functions in scripts and functions in packages.</p>
<div id="r-workflow" class="section level2">
<h2><span class="header-section-number">3.1</span> R code workflow</h2>
<p>The first practical advantage to using a package is that it’s easy to re-load your code. You can either run <code>devtools::load_all()</code>, or in RStudio press <strong>Ctrl/Cmd + Shift + L</strong>, which also saves all open files, saving you a keystroke.</p>
<p>This keyboard shortcut leads to a fluid development workflow:</p>
<ol style="list-style-type: decimal">
<li><p>Edit an R file.</p></li>
<li><p>Press Ctrl/Cmd + Shift + L.</p></li>
<li><p>Explore the code in the console.</p></li>
<li><p>Rinse and repeat.</p></li>
</ol>
<p>Congratulations! You’ve learned your first package development workflow. Even if you learn nothing else from this book, you’ll have gained a useful workflow for editing and reloading R code.</p>
</div>
<div id="r-organising" class="section level2">
<h2><span class="header-section-number">3.2</span> Organising your functions</h2>
<p>While you’re free to arrange functions into files as you wish, the two extremes are bad: don’t put all functions into one file and don’t put each function into its own separate file. (It’s OK if some files only contain one function, particularly if the function is large or has a lot of documentation.). File names should be meaningful and end in <code>.R</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
fit_models.R
utility_functions.R

<span class="co"># Bad</span>
foo.r
stuff.r</code></pre>
<p>Pay attention to capitalization, since you, or some of your collaborators, might be using an operating system with a case-insensitive file system (e.g., Microsoft Windows or OS X). Avoid problems by never using filenames that differ only in capitalisation.</p>
<p>My rule of thumb is that if I can’t remember the name of the file where a function lives, I need to either separate the functions into more files or give the file a better name. (Unfortunately you can’t use subdirectories inside <code>R/</code>. The next best thing is to use a common prefix, e.g., <code>abc-*.R</code>.).</p>
<p>The arrangement of functions within files is less important if you master two important RStudio keyboard shortcuts that let you jump to the definition of a function:</p>
<ul>
<li><p>Click a function name in code and press <strong>F2</strong>.</p></li>
<li><p>Press <strong>Ctrl + .</strong> then start typing the name: <img width = "20%" src = "images/file-finder.png"/></p></li>
</ul>
<p>After navigating to a function using one of these tools, you can go back to where you were by clicking the back arrow at the top-left of the editor <img width = "7%" src = "images/arrows.png"/> , or by pressing Ctrl/Cmd-F9.</p>
</div>
<div id="style" class="section level2">
<h2><span class="header-section-number">3.3</span> Code style</h2>
<p>Good coding style is like using correct punctuation. You can manage without it, but it sure makes things easier to read. As with styles of punctuation, there are many possible variations. The following guide describes the style that I use (in this book and elsewhere). It is based on Google’s <a href="https://google.github.io/styleguide/Rguide.xml">R style guide</a>, with a few tweaks.</p>
<p>You don’t have to use my style, but I strongly recommend that you use a consistent style and you document it. If you’re working on someone else’s code, don’t impose your own style. Instead, read their style documentation and follow it as closely as possible.</p>
<p>Good style is important because while your code only has one author, it will usually have multiple readers. This is especially true when you’re writing code with others. In that case, it’s a good idea to agree on a common style up-front. Since no style is strictly better than another, working with others may mean that you’ll need to sacrifice some preferred aspects of your style.</p>
<p>The formatR package, by Yihui Xie, makes it easier to clean up poorly formatted code. It can’t do everything, but it can quickly get your code from terrible to pretty good. Make sure to read <a href="http://yihui.name/formatR/">the notes on the website</a> before using it. It’s as easy as:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;formatR&quot;</span>)
formatR<span class="op">::</span><span class="kw">tidy_dir</span>(<span class="st">&quot;R&quot;</span>)</code></pre>
<p>A complementary approach is to use a code <strong>linter</strong>. Rather than automatically fixing problems, a linter just warns you about them. The lintr package by Jim Hester checks for compliance with this style guide and lets you know where you’ve missed something. Compared to formatR, it picks up more potential problems (because it doesn’t need to also fix them), but you will still see false positives.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;lintr&quot;</span>)
lintr<span class="op">::</span><span class="kw">lint_package</span>()</code></pre>
<div id="object-names" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Object names</h3>
<p>Variable and function names should be lowercase. Use an underscore (<code>_</code>) to separate words within a name (reserve <code>.</code> for S3 methods). Camel case is a legitimate alternative, but be consistent! Generally, variable names should be nouns and function names should be verbs. Strive for names that are concise and meaningful (this is not easy!).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
day_one
day_<span class="dv">1</span>

<span class="co"># Bad</span>
first_day_of_the_month
DayOne
dayone
djm1</code></pre>
<p>Where possible, avoid using names of existing functions and variables. This will cause confusion for the readers of your code.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bad</span>
T &lt;-<span class="st"> </span><span class="ot">FALSE</span>
c &lt;-<span class="st"> </span><span class="dv">10</span>
mean &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sum</span>(x)</code></pre>
</div>
<div id="spacing" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Spacing</h3>
<p>Place spaces around all infix operators (<code>=</code>, <code>+</code>, <code>-</code>, <code>&lt;-</code>, etc.). The same rule applies when using <code>=</code> in function calls. Always put a space after a comma, and never before (just like in regular English).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
average &lt;-<span class="st"> </span><span class="kw">mean</span>(feet <span class="op">/</span><span class="st"> </span><span class="dv">12</span> <span class="op">+</span><span class="st"> </span>inches, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># Bad</span>
average&lt;-<span class="kw">mean</span>(feet<span class="op">/</span><span class="dv">12</span><span class="op">+</span>inches,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre>
<p>There’s a small exception to this rule: <code>:</code>, <code>::</code> and <code>:::</code> don’t need spaces around them. (If you haven’t seen <code>::</code> or <code>:::</code> before, don’t worry - you’ll learn all about them in <a href="namespace.html#namespace">namespaces</a>.)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
base<span class="op">::</span>get

<span class="co"># Bad</span>
x &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="dv">10</span>
base <span class="op">::</span><span class="st"> </span>get</code></pre>
<p>Place a space before left parentheses, except in a function call.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
<span class="cf">if</span> (debug) <span class="kw">do</span>(x)
<span class="kw">plot</span>(x, y)

<span class="co"># Bad</span>
<span class="cf">if</span>(debug)<span class="kw">do</span>(x)
<span class="kw">plot</span> (x, y)</code></pre>
<p>Extra spacing (i.e., more than one space in a row) is ok if it improves alignment of equal signs or assignments (<code>&lt;-</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">list</span>(
  <span class="dt">total =</span> a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c, 
  <span class="dt">mean  =</span> (a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c) <span class="op">/</span><span class="st"> </span>n
)</code></pre>
<p>Do not place spaces around code in parentheses or square brackets (unless there’s a comma, in which case see above).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
<span class="cf">if</span> (debug) <span class="kw">do</span>(x)
diamonds[<span class="dv">5</span>, ]

<span class="co"># Bad</span>
<span class="cf">if</span> ( debug ) <span class="kw">do</span>(x)  <span class="co"># No spaces around debug</span>
x[<span class="dv">1</span>,]   <span class="co"># Needs a space after the comma</span>
x[<span class="dv">1</span> ,]  <span class="co"># Space goes after comma not before</span></code></pre>
</div>
<div id="curly-braces" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Curly braces</h3>
<p>An opening curly brace should never go on its own line and should always be followed by a new line. A closing curly brace should always go on its own line, unless it’s followed by <code>else</code>.</p>
<p>Always indent the code inside curly braces.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>

<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) {
  <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)
}

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} <span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}

<span class="co"># Bad</span>

<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug)
<span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} 
<span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}</code></pre>
<p>It’s ok to leave very short statements on the same line:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)</code></pre>
</div>
<div id="line-length" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Line length</h3>
<p>Strive to limit your code to 80 characters per line. This fits comfortably on a printed page with a reasonably sized font. If you find yourself running out of room, this is a good indication that you should encapsulate some of the work in a separate function.</p>
</div>
<div id="indentation" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Indentation</h3>
<p>When indenting your code, use two spaces. Never use tabs or mix tabs and spaces. Change these options in the code preferences pane:</p>
<p><img src="images/style-options.png" /><!-- --></p>
<p>The only exception is if a function definition runs over multiple lines. In that case, indent the second line to where the definition starts:</p>
<pre class="sourceCode r"><code class="sourceCode r">long_function_name &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">a =</span> <span class="st">&quot;a long argument&quot;</span>, 
                               <span class="dt">b =</span> <span class="st">&quot;another argument&quot;</span>,
                               <span class="dt">c =</span> <span class="st">&quot;another long argument&quot;</span>) {
  <span class="co"># As usual code is indented by two spaces.</span>
}</code></pre>
</div>
<div id="assignment" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Assignment</h3>
<p>Use <code>&lt;-</code>, not <code>=</code>, for assignment.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
x &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="co"># Bad</span>
x =<span class="st"> </span><span class="dv">5</span></code></pre>
</div>
<div id="commenting-guidelines" class="section level3">
<h3><span class="header-section-number">3.3.7</span> Commenting guidelines</h3>
<p>Comment your code. Each line of a comment should begin with the comment symbol and a single space: <code>#</code>. Comments should explain the why, not the what. </p>
<p>Use commented lines of <code>-</code> and <code>=</code> to break up your file into easily readable chunks.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load data ---------------------------</span>

<span class="co"># Plot data ---------------------------</span></code></pre>
</div>
</div>
<div id="r-differences" class="section level2">
<h2><span class="header-section-number">3.4</span> Top-level code</h2>
<p>Up until now, you’ve probably been writing <strong>scripts</strong>, R code saved in a file that you load with <code>source()</code>. There are two main differences between code in scripts and packages:</p>
<ul>
<li><p>In a script, code is run when it is loaded. In a package, code is run when it
is built. This means your package code should only create objects, the
vast majority of which will be functions.</p></li>
<li><p>Functions in your package will be used in situations that you didn’t imagine.
This means your functions need to be thoughtful in the way that they
interact with the outside world.</p></li>
</ul>
<p>The next two sections expand on these important differences.</p>
<div id="loading-code" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Loading code</h3>
<p>When you load a script with <code>source()</code>, every line of code is executed and the results are immediately made available. Things are different in a package, because it is loaded in two steps. When the package is built (e.g. by CRAN) all the code in <code>R/</code> is executed and the results are saved. When you load a package, with <code>library()</code> or <code>require()</code>, the cached results are made available to you. If you loaded scripts in the same way as packages, your code would look like this:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load a script into a new environment and save it</span>
env &lt;-<span class="st"> </span><span class="kw">new.env</span>(<span class="dt">parent =</span> <span class="kw">emptyenv</span>())
<span class="kw">source</span>(<span class="st">&quot;my-script.R&quot;</span>, <span class="dt">local =</span> env)
<span class="kw">save</span>(<span class="dt">envir =</span> env, <span class="st">&quot;my-script.Rdata&quot;</span>)

<span class="co"># Later, in another R session</span>
<span class="kw">load</span>(<span class="st">&quot;my-script.Rdata&quot;</span>)</code></pre>
<p>For example, take <code>x &lt;- Sys.time()</code>. If you put this in a script, <code>x</code> would tell you when the script was <code>source()</code>d. But if you put that same code in a package, <code>x</code> would tell you when the package was <em>built</em>.</p>
<p>This means that you should never run code at the top-level of a package: package code should only create objects, mostly functions. For example, imagine your foo package contains this code:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

show_mtcars &lt;-<span class="st"> </span><span class="cf">function</span>() {
  <span class="kw">qplot</span>(mpg, wt, <span class="dt">data =</span> mtcars)
}</code></pre>
<p>If someone tries to use it:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foo)
<span class="kw">show_mtcars</span>()</code></pre>
<p>The code won’t work because ggplot2’s <code>qplot()</code> function won’t be available: <code>library(foo)</code> doesn’t re-execute <code>library(ggplot2)</code>. The top-level R code in a package is only executed when the package is built, not when it’s loaded.</p>
<p>To get around this problem you might be tempted to do:</p>
<pre class="sourceCode r"><code class="sourceCode r">show_mtcars &lt;-<span class="st"> </span><span class="cf">function</span>() {
  <span class="kw">library</span>(ggplot2)
  <span class="kw">qplot</span>(mpg, wt, <span class="dt">data =</span> mtcars)
}</code></pre>
<p>That’s also problematic, as you’ll see below. Instead, describe the packages your code needs in the <code>DESCRIPTION</code> file, as you’ll learn in <a href="description.html#dependencies">package dependencies</a>.</p>
</div>
<div id="the-r-landscape" class="section level3">
<h3><span class="header-section-number">3.4.2</span> The R landscape</h3>
<p>Another big difference between a script and a package is that other people are going to use your package, and they’re going to use it in situations that you never imagined. This means you need to pay attention to the R landscape, which includes not just the available functions and objects, but all the global settings. You have changed the R landscape if you’ve loaded a package with <code>library()</code>, or changed a global option with <code>options()</code>, or modified the working directory with <code>setwd()</code>. If the behaviour of <em>other</em> functions differs before and after running your function, you’ve modified the landscape. Changing the landscape is bad because it makes code much harder to understand.</p>
<p>There are some functions that modify global settings that you should never use because there are better alternatives:</p>
<ul>
<li><p><strong>Don’t use <code>library()</code> or <code>require()</code></strong>. These modify the search path,
affecting what functions are available from the global environment.
It’s better to use the <code>DESCRIPTION</code> to specify your package’s requirements,
as described in the next chapter. This also makes sure those packages are
installed when your package is installed.</p></li>
<li><p><strong>Never use <code>source()</code></strong> to load code from a file. <code>source()</code> modifies the
current environment, inserting the results of executing the code. Instead, rely
on <code>devtools::load_all()</code> which automatically sources all files in <code>R/</code>.
If you’re using <code>source()</code> to create a dataset, instead switch to <code>data/</code>
as described in <a href="data.html#data">datasets</a>.</p></li>
</ul>
<p>Other functions need to be used with caution. If you use them, make sure to clean up after yourself with <code>on.exit()</code>:</p>
<ul>
<li><p>If you modify global <code>options()</code> or graphics <code>par()</code>, save the old values
and reset when you’re done:</p>
<pre class="sourceCode r"><code class="sourceCode r">old &lt;-<span class="st"> </span><span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="kw">on.exit</span>(<span class="kw">options</span>(old), <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></li>
<li><p>Avoid modifying the working directory. If you do have to change it, make sure
to change it back when you’re done:</p>
<pre class="sourceCode r"><code class="sourceCode r">old &lt;-<span class="st"> </span><span class="kw">setwd</span>(<span class="kw">tempdir</span>())
<span class="kw">on.exit</span>(<span class="kw">setwd</span>(old), <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></li>
<li><p>Creating plots and printing output to the console are two other ways of
affecting the global R environment. Often you can’t avoid these (because
they’re important!) but it’s good practice to isolate them in functions that
<strong>only</strong> produce output. This also makes it easier for other people to
repurpose your work for new uses. For example, if you separate data preparation
and plotting into two functions, others can use your data prep work (which
is often the hardest part!) to create new visualisations.</p></li>
</ul>
<p>The flip side of the coin is that you should avoid relying on the user’s landscape, which might be different to yours. For example, functions like <code>read.csv()</code> are dangerous because the value of <code>stringsAsFactors</code> argument comes from the global option <code>stringsAsFactors</code>. If you expect it to be <code>TRUE</code> (the default), and the user has set it to be <code>FALSE</code>, your code might fail.</p>
</div>
<div id="when-you-do-need-side-effects" class="section level3">
<h3><span class="header-section-number">3.4.3</span> When you <strong>do</strong> need side-effects</h3>
<p>Occasionally, packages do need side-effects. This is most common if your package talks to an external system — you might need to do some initial setup when the package loads. To do that, you can use two special functions: <code>.onLoad()</code> and <code>.onAttach()</code>. These are called when the package is loaded and attached. You’ll learn about the distinction between the two in <a href="namespace.html#namespace">Namespaces</a>. For now, you should always use <code>.onLoad()</code> unless explicitly directed otherwise.</p>
<p>Some common uses of <code>.onLoad()</code> and <code>.onAttach()</code> are:</p>
<ul>
<li><p>To display an informative message when the package loads. This might make
usage conditions clear, or display useful tips. Startup messages is one
place where you should use <code>.onAttach()</code> instead of <code>.onLoad()</code>. To display
startup messages, always use <code>packageStartupMessage()</code>, and not <code>message()</code>.
(This allows <code>suppressPackageStartupMessages()</code> to selectively suppress
package startup messages).</p>
<pre class="sourceCode r"><code class="sourceCode r">.onAttach &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {
  <span class="kw">packageStartupMessage</span>(<span class="st">&quot;Welcome to my package&quot;</span>)
}</code></pre></li>
<li><p>To set custom options for your package with <code>options()</code>. To avoid conflicts
with other packages, ensure that you prefix option names with the name
of your package. Also be careful not to override options that the user
has already set.</p>
<p>I use the following code in devtools to set up useful options:</p>
<pre class="sourceCode r"><code class="sourceCode r">.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(libname, pkgname) {
  op &lt;-<span class="st"> </span><span class="kw">options</span>()
  op.devtools &lt;-<span class="st"> </span><span class="kw">list</span>(
    <span class="dt">devtools.path =</span> <span class="st">&quot;~/R-dev&quot;</span>,
    <span class="dt">devtools.install.args =</span> <span class="st">&quot;&quot;</span>,
    <span class="dt">devtools.name =</span> <span class="st">&quot;Your name goes here&quot;</span>,
    <span class="dt">devtools.desc.author =</span> <span class="st">&quot;First Last &lt;first.last@example.com&gt; [aut, cre]&quot;</span>,
    <span class="dt">devtools.desc.license =</span> <span class="st">&quot;What license is it under?&quot;</span>,
    <span class="dt">devtools.desc.suggests =</span> <span class="ot">NULL</span>,
    <span class="dt">devtools.desc =</span> <span class="kw">list</span>()
  )
  toset &lt;-<span class="st"> </span><span class="op">!</span>(<span class="kw">names</span>(op.devtools) <span class="op">%in%</span><span class="st"> </span><span class="kw">names</span>(op))
  <span class="cf">if</span>(<span class="kw">any</span>(toset)) <span class="kw">options</span>(op.devtools[toset])

  <span class="kw">invisible</span>()
}</code></pre>
<p>Then devtools functions can use e.g. <code>getOption(&quot;devtools.name&quot;)</code> to
get the name of the package author, and know that a sensible default value
has already been set.</p></li>
<li><p>To connect R to another programming language. For example, if you use rJava
to talk to a <code>.jar</code> file, you need to call <code>rJava::.jpackage()</code>. To
make C++ classes available as reference classes in R with Rcpp modules,
you call <code>Rcpp::loadRcppModules()</code>.</p></li>
<li><p>To register vignette engines with <code>tools::vignetteEngine()</code>.</p></li>
</ul>
<p>As you can see in the examples, <code>.onLoad()</code> and <code>.onAttach()</code> are called with two arguments: <code>libname</code> and <code>pkgname</code>. They’re rarely used (they’re a holdover from the days when you needed to use <code>library.dynam()</code> to load compiled code). They give the path where the package is installed (the “library”), and the name of the package.</p>
<p>If you use <code>.onLoad()</code>, consider using <code>.onUnload()</code> to clean up any side effects. By convention, <code>.onLoad()</code> and friends are usually saved in a file called <code>zzz.R</code>. (Note that <code>.First.lib()</code> and <code>.Last.lib()</code> are old versions of <code>.onLoad()</code> and <code>.onUnload()</code> and should no longer be used.)</p>
</div>
<div id="s4-classes-generics-and-methods" class="section level3">
<h3><span class="header-section-number">3.4.4</span> S4 classes, generics and methods</h3>
<p>Another type of side-effect is defining S4 classes, methods and generics. R packages capture these side-effects so they can be replayed when the package is loaded, but they need to be called in the right order. For example, before you can define a method, you must have defined both the generic and the class. This requires that the R files be sourced in a specific order. This order is controlled by the <code>Collate</code> field in the <code>DESCRIPTION</code>. This is described in more detail in <a href="man.html#man-s4">documenting S4</a>.</p>
</div>
</div>
<div id="r-cran" class="section level2">
<h2><span class="header-section-number">3.5</span> CRAN notes</h2>
<p>(Each chapter will finish with some hints for submitting your package to CRAN. If you don’t plan on submitting your package to CRAN, feel free to ignore them!)</p>
<p>If you’re planning on submitting your package to CRAN, you must use only ASCII characters in your <code>.R</code> files. You can still include unicode characters in strings, but you need to use the special unicode escape <code>&quot;\u1234&quot;</code> format. The easiest way to do that is to use <code>stringi::stri_escape_unicode()</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> &quot;This is a bullet •&quot;</span>
y &lt;-<span class="st"> &quot;This is a bullet \u2022&quot;</span>
<span class="kw">identical</span>(x, y)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(stringi<span class="op">::</span><span class="kw">stri_escape_unicode</span>(x))</code></pre>
<pre><code>## This is a bullet \u2022</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="package-structure.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="description.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/r-pkgs/edit/master/03-code.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>

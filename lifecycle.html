<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Learn how to create a package, the fundamental unit of shareable, reusable, and reproducible R code.">
<title>21&nbsp; Lifecycle – R Packages (2e)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./release.html" rel="next">
<link href="./software-development-practices.html" rel="prev">
<link href="./images/cover-2e-small.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8c563c05ac8c1d64e78fdaf2b4701079.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script defer="" data-domain="r-pkgs.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./software-development-practices.html">Maintenance and distribution</a></li><li class="breadcrumb-item"><a href="./lifecycle.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R Packages (2e)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/hadley/r-pkgs/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./whole-game.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The Whole Game</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">System setup</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Package structure and state</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./workflow101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamental development workflows</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./package-within.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">The package within</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Package components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./misc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other components</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Package metadata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><code>DESCRIPTION</code></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-mindset-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Dependencies: Mindset and Background</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dependencies-in-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Dependencies: In Practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Licensing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Testing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Testing basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Designing your test suite</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./testing-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Advanced testing techniques</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./man.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Function documentation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vignettes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Vignettes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-markdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other markdown files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Website</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Maintenance and distribution</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software-development-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Software development practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lifecycle.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./release.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-CMD-check.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title"><code>R CMD check</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-lifecycle-evolution" id="toc-sec-lifecycle-evolution" class="nav-link active" data-scroll-target="#sec-lifecycle-evolution"><span class="header-section-number">21.1</span> Package evolution</a></li>
  <li><a href="#sec-lifecycle-version-number" id="toc-sec-lifecycle-version-number" class="nav-link" data-scroll-target="#sec-lifecycle-version-number"><span class="header-section-number">21.2</span> Package version number</a></li>
  <li><a href="#sec-lifecycle-version-number-tidyverse" id="toc-sec-lifecycle-version-number-tidyverse" class="nav-link" data-scroll-target="#sec-lifecycle-version-number-tidyverse"><span class="header-section-number">21.3</span> Tidyverse package version conventions</a></li>
  <li><a href="#sec-lifecycle-breaking-change-definition" id="toc-sec-lifecycle-breaking-change-definition" class="nav-link" data-scroll-target="#sec-lifecycle-breaking-change-definition"><span class="header-section-number">21.4</span> Backward compatibility and breaking change</a></li>
  <li>
<a href="#sec-lifecycle-release-type" id="toc-sec-lifecycle-release-type" class="nav-link" data-scroll-target="#sec-lifecycle-release-type"><span class="header-section-number">21.5</span> Major vs minor vs patch release</a>
  <ul class="collapse">
<li><a href="#package-version-mechanics" id="toc-package-version-mechanics" class="nav-link" data-scroll-target="#package-version-mechanics"><span class="header-section-number">21.5.1</span> Package version mechanics</a></li>
  </ul>
</li>
  <li><a href="#sec-lifecycle-breaking-change-pros-cons" id="toc-sec-lifecycle-breaking-change-pros-cons" class="nav-link" data-scroll-target="#sec-lifecycle-breaking-change-pros-cons"><span class="header-section-number">21.6</span> Pros and cons of breaking change</a></li>
  <li>
<a href="#sec-lifecycle-stages-and-package" id="toc-sec-lifecycle-stages-and-package" class="nav-link" data-scroll-target="#sec-lifecycle-stages-and-package"><span class="header-section-number">21.7</span> Lifecycle stages and supporting tools</a>
  <ul class="collapse">
<li><a href="#lifecycle-stages-and-badges" id="toc-lifecycle-stages-and-badges" class="nav-link" data-scroll-target="#lifecycle-stages-and-badges"><span class="header-section-number">21.7.1</span> Lifecycle stages and badges</a></li>
  <li><a href="#deprecating-a-function" id="toc-deprecating-a-function" class="nav-link" data-scroll-target="#deprecating-a-function"><span class="header-section-number">21.7.2</span> Deprecating a function</a></li>
  <li><a href="#deprecating-an-argument" id="toc-deprecating-an-argument" class="nav-link" data-scroll-target="#deprecating-an-argument"><span class="header-section-number">21.7.3</span> Deprecating an argument</a></li>
  <li><a href="#deprecation-helpers" id="toc-deprecation-helpers" class="nav-link" data-scroll-target="#deprecation-helpers"><span class="header-section-number">21.7.4</span> Deprecation helpers</a></li>
  <li><a href="#dealing-with-change-in-a-dependency" id="toc-dealing-with-change-in-a-dependency" class="nav-link" data-scroll-target="#dealing-with-change-in-a-dependency"><span class="header-section-number">21.7.5</span> Dealing with change in a dependency</a></li>
  <li><a href="#superseding-a-function" id="toc-superseding-a-function" class="nav-link" data-scroll-target="#superseding-a-function"><span class="header-section-number">21.7.6</span> Superseding a function</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/lifecycle.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./software-development-practices.html">Maintenance and distribution</a></li><li class="breadcrumb-item"><a href="./lifecycle.html"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-lifecycle" class="quarto-section-identifier"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Lifecycle</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>This chapter is about managing the evolution of your package. The trickiest part of managing change is balancing the interests of various stakeholders:</p>
<ul>
<li><p>The maintainer(s), which includes you and possibly others, especially in the future.</p></li>
<li><p>The existing users, which could be just you or a small group of colleagues or it could be tens or hundreds of thousands of people.</p></li>
<li><p>The future users, which hopefully includes the existing users, but could potentially include many more people.</p></li>
</ul>
<p>It’s impossible to optimize for all of these folks, all of the time, all at once. So we’ll describe how we think about various trade-offs. Even if your priorities differ from those of the tidyverse team, this chapter should still help you identify issues you want to consider.</p>
<p>Very few users complain when a package gains features or gets a bug fix. Instead, we’re mostly going to talk about so-called breaking changes, such as removing a function or narrowing the acceptable inputs for a function. In <a href="#sec-lifecycle-breaking-change-definition" class="quarto-xref"><span>Section 21.4</span></a>, we explore how to determine whether something is a breaking change or, more realistically, to gauge where it lies on a spectrum of “breakingness”. Even though it can be painful, sometimes a breaking change is beneficial for the long-term health of a package (<a href="#sec-lifecycle-breaking-change-pros-cons" class="quarto-xref"><span>Section 21.6</span></a>).</p>
<p>Since change is inevitable, the kindest thing you can do for your users is to communicate clearly and help them adapt to change. Several practices work together to achieve this:</p>
<ul>
<li><p>Package version number: The main form of user-facing change is a package release (<a href="#sec-lifecycle-evolution" class="quarto-xref"><span>Section 21.1</span></a>). Be intentional about what sort of changes are included in, e.g., a patch release versus a major release (<a href="#sec-lifecycle-version-number" class="quarto-xref"><span>Section 21.2</span></a>, <a href="#sec-lifecycle-release-type" class="quarto-xref"><span>Section 21.5</span></a>).</p></li>
<li><p>Lifecycle stage: be explicit when a function or argument is regarded as experimental, superseded, or deprecated, as opposed to stable (the assumed default) (<a href="#sec-lifecycle-stages-and-package" class="quarto-xref"><span>Section 21.7</span></a>).</p></li>
<li><p>Deprecation process: enact change in a phased way, which makes it easier for users to adjust their code (<a href="#sec-lifecycle-stages-and-package" class="quarto-xref"><span>Section 21.7</span></a>).</p></li>
</ul>
<section id="sec-lifecycle-evolution" class="level2" data-number="21.1"><h2 data-number="21.1" class="anchored" data-anchor-id="sec-lifecycle-evolution">
<span class="header-section-number">21.1</span> Package evolution</h2>
<p>First we should establish a working definition of what it means for your package to change. Technically, you could say that the package has changed every time any file in its source changes. This level of pedantry isn’t terribly useful, though. The smallest increment of change that’s meaningful is probably a Git commit. This represents a specific state of the source package that can be talked about, installed from, compared to, subjected to <code>R CMD check</code>, reverted to, and so on. This level of granularity is really only of interest to developers. But the package states accessible via the Git history are genuinely useful for the maintainer, so if you needed any encouragement to be more intentional with your commits, let this be it.</p>
<p>The primary signal of meaningful change is to increment the package version number and release it, for some definition of release, such as releasing on CRAN (<a href="release.html" class="quarto-xref"><span>Chapter 22</span></a>). Recall that this important piece of metadata lives in the <code>Version</code> field of the <code>DESCRIPTION</code> file:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Package</span><span class="kw">:</span><span class="at"> usethis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Title</span><span class="kw">:</span><span class="at"> Automate Package and Project Setup</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Version</span><span class="kw">:</span><span class="at"> </span><span class="fl">2.1.6</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you visit the CRAN landing page for usethis, you can access its history via <em>Downloads &gt; Old sources &gt; <a href="https://cran.r-project.org/src/contrib/Archive/usethis/">usethis archive</a></em>. That links to a folder of package bundles (<a href="structure.html#sec-bundled-package" class="quarto-xref"><span>Section 3.3</span></a>), reflecting usethis’s source for each version released on CRAN, presented in <a href="#tbl-usethis-versions" class="quarto-xref">Table&nbsp;<span>21.1</span></a>:</p>
<div class="cell">
<div id="tbl-usethis-versions" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-usethis-versions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;21.1: Releases of the usethis package.
</figcaption><div aria-describedby="tbl-usethis-versions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Version</th>
<th style="text-align: left;">Date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1.0.0</td>
<td style="text-align: left;">2017-10-22 17:36:29 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.1.0</td>
<td style="text-align: left;">2017-11-17 22:52:07 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.2.0</td>
<td style="text-align: left;">2018-01-19 18:23:54 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.3.0</td>
<td style="text-align: left;">2018-02-24 21:53:51 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.4.0</td>
<td style="text-align: left;">2018-08-14 12:10:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.5.0</td>
<td style="text-align: left;">2019-04-07 10:50:44 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.5.1</td>
<td style="text-align: left;">2019-07-04 11:00:05 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.6.0</td>
<td style="text-align: left;">2020-04-09 04:50:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.6.1</td>
<td style="text-align: left;">2020-04-29 05:50:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.6.3</td>
<td style="text-align: left;">2020-09-17 17:00:03 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.0.0</td>
<td style="text-align: left;">2020-12-10 09:00:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.0.1</td>
<td style="text-align: left;">2021-02-10 10:40:06 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.1.0</td>
<td style="text-align: left;">2021-10-16 23:30:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.1.2</td>
<td style="text-align: left;">2021-10-25 07:30:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.1.3</td>
<td style="text-align: left;">2021-10-27 15:00:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.1.5</td>
<td style="text-align: left;">2021-12-09 23:00:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.1.6</td>
<td style="text-align: left;">2022-05-25 20:50:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2.0</td>
<td style="text-align: left;">2023-06-06 09:30:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.2.1</td>
<td style="text-align: left;">2023-06-23 23:50:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2.2</td>
<td style="text-align: left;">2023-07-06 00:20:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.2.3</td>
<td style="text-align: left;">2024-02-19 16:00:02 UTC</td>
</tr>
<tr class="even">
<td style="text-align: left;">3.0.0</td>
<td style="text-align: left;">2024-07-29 07:20:02 UTC</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.1.0</td>
<td style="text-align: left;">2024-11-26 10:20:02 UTC</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>This is the type of package evolution we’re going to address in this chapter. In <a href="#sec-lifecycle-version-number" class="quarto-xref"><span>Section 21.2</span></a>, we’ll delve into the world of software version numbers, which is a richer topic than you might expect. R also has some specific rules and tools around package version numbers. Finally, we’ll explain the conventions we use for the version numbers of tidyverse packages (<a href="#sec-lifecycle-version-number-tidyverse" class="quarto-xref"><span>Section 21.3</span></a>).</p>
<p>But first, this is a good time to revisit a resource we first pointed out in <a href="structure.html#sec-source-package" class="quarto-xref"><span>Section 3.2</span></a>, when introducing the different states of an R package. Recall that the (unofficial) <code>cran</code> organization on GitHub provides a read-only history of all CRAN packages. For example, you can get a different view of usethis’s released versions at <a href="https://github.com/cran/usethis/" class="uri">https://github.com/cran/usethis/</a>.</p>
<p>The archive provided by CRAN itself allows you to download older versions of usethis as <code>.tar.gz</code> files, which is useful if you truly want to get your hands on the source of an older version. However, if you just want to quickly check something about a version or compare two versions of usethis, the read-only GitHub mirror is much more useful. Each commit in this repo’s history represents a CRAN release, which makes it easy to see exactly what changed: <a href="https://github.com/cran/usethis/commits/HEAD" class="uri">https://github.com/cran/usethis/commits/HEAD</a>. Furthermore, you can browse the state of all the package’s source files at any specific version, such as <a href="https://github.com/cran/usethis/tree/1.0.0">usethis’s initial release at version 1.0.0</a><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>This information is technically available from the repository where usethis is actually developed (<a href="https://github.com/r-lib/usethis" class="uri">https://github.com/r-lib/usethis</a>). But you have to work much harder to zoom out to the level of CRAN releases, amid the clutter of the small incremental steps in which development actually unfolds. These three different views of usethis’s evolution are all useful for different purposes:</p>
<ul>
<li><p><a href="https://cran.r-project.org/src/contrib/Archive/usethis/" class="uri">https://cran.r-project.org/src/contrib/Archive/usethis/</a>: the official CRAN package bundles.</p></li>
<li><p><a href="https://github.com/cran/usethis/commits/HEAD" class="uri">https://github.com/cran/usethis/commits/HEAD</a>: the unofficial read-only CRAN mirror, obtained by unpacking CRAN’s bundles.</p></li>
<li><p><a href="https://github.com/r-lib/usethis/commits/HEAD" class="uri">https://github.com/r-lib/usethis/commits/HEAD</a>: the official development home for usethis.</p></li>
</ul></section><section id="sec-lifecycle-version-number" class="level2" data-number="21.2"><h2 data-number="21.2" class="anchored" data-anchor-id="sec-lifecycle-version-number">
<span class="header-section-number">21.2</span> Package version number</h2>
<p>Formally, an R package version is a sequence of at least two integers separated by either <code>.</code> or <code>-</code>. For example, <code>1.0</code> and <code>0.9.1-10</code> are valid versions, but <code>1</code> and <code>1.0-devel</code> are not. Base R offers the <code><a href="https://rdrr.io/r/base/numeric_version.html">package_version()</a></code> function to parse a package version string into a proper S3 class by the same name. This class makes it easier to do things like compare versions.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1.0"</span>, <span class="st">"0.9.1-10"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '1.0'      '0.9.1.10'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.0"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "package_version" "numeric_version"</span></span>
<span></span>
<span><span class="co"># these versions are not allowed for an R package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: invalid version specification '1'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.0-devel"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: invalid version specification '1.0-devel'</span></span>
<span></span>
<span><span class="co"># comparing package versions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.9"</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.9.0"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.9"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.9.2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"1.9"</span>, <span class="st">"1.9.2"</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"1.10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last examples above make it clear that R considers version <code>1.9</code> to be equal to <code>1.9.0</code> and to be less than <code>1.9.2</code>. And both <code>1.9</code> and <code>1.9.2</code> are less than <code>1.10</code>, which you should think of as version “one point ten”, not “one point one zero”.</p>
<p>If you’re skeptical that the <code>package_version</code> class is really necessary, check out this example:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="st">"2.0"</span> <span class="op">&gt;</span> <span class="st">"10.0"</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"2.0"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"10.0"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The string <code>2.0</code> is considered to be greater than the string <code>10.0</code>, because the character <code>2</code> comes after the character <code>1</code>. By parsing version strings into proper <code>package_version</code> objects, we get the correct comparison, i.e.&nbsp;that version <code>2.0</code> is less than version <code>10.0</code>.</p>
<p>R offers this support for working with package versions, because it’s necessary, for example, to determine whether package dependencies are satisfied (<a href="description.html#sec-description-imports-suggests-minium-version" class="quarto-xref"><span>Section 9.6.1</span></a>). Under-the-hood, this tooling is used to enforce minimum versions recorded like this in <code>DESCRIPTION</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">    dplyr (&gt;= 1.0.0),</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">    tidyr (&gt;= 1.1.0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In your own code, if you need to determine which version of a package is installed, use <code><a href="https://rdrr.io/r/utils/packageDescription.html">utils::packageVersion()</a></code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '3.1.0'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Classes 'package_version', 'numeric_version'  hidden list of 1</span></span>
<span><span class="co">#&gt;  $ : int [1:3] 3 1 0</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric_version.html">package_version</a></span><span class="op">(</span><span class="st">"10.0"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"usethis"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="st">"10.0"</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The return value of <code><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion()</a></code> has the <code>package_version</code> class and is therefore ready for comparison to other version numbers. Note the last example where we seem to be comparing a version number to a string. How can we get the correct result without explicitly converting <code>10.0</code> to a package version? It turns out this conversion is automatic as long as one of the comparators has the <code>package_version</code> class.</p>
</section><section id="sec-lifecycle-version-number-tidyverse" class="level2" data-number="21.3"><h2 data-number="21.3" class="anchored" data-anchor-id="sec-lifecycle-version-number-tidyverse">
<span class="header-section-number">21.3</span> Tidyverse package version conventions</h2>
<p>R considers <code>0.9.1-10</code> to be a valid package version, but you’ll never see a version number like that for a tidyverse package. Here is our recommended framework for managing the package version number:</p>
<ul>
<li><p>Always use <code>.</code> as the separator, never <code>-</code>.</p></li>
<li><p>A released version number consists of three numbers, <code>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;</code>. For version number <code>1.9.2</code>, <code>1</code> is the major number, <code>9</code> is the minor number, and <code>2</code> is the patch number. Never use versions like <code>1.0</code>. Always spell out the three components, <code>1.0.0</code>.</p></li>
<li>
<p>An in-development package has a fourth component: the development version. This should start at 9000. The number 9000 is arbitrary, but provides a clear signal that there’s something different about this version number. There are two reasons for this practice: First, the presence of a fourth component makes it easy to tell if you’re dealing with a released or in-development version. Also, the use of the fourth place means that you’re not limited to what the next released version will be. <code>0.0.1</code>, <code>0.1.0</code>, and <code>1.0.0</code> are all greater than <code>0.0.0.9000</code>.</p>
<p>Increment the development version, e.g.&nbsp;from <code>9000</code> to <code>9001</code>, if you’ve added an important feature and you (or others) need to be able to detect or require the presence of this feature. For example, this can happen when two packages are developing in tandem. This is generally the only reason that we bother to increment the development version. This makes in-development versions special and, in some sense, degenerate. Since we don’t increment the development component with each Git commit, the same package version number is associated with many different states of the package source, in between releases.</p>
</li>
</ul>
<p>The advice above is inspired in part by <a href="https://semver.org">Semantic Versioning</a> and by the <a href="https://www.x.org/releases/X11R7.7/doc/xorg-docs/Versions.html">X.Org</a> versioning schemes. Read them if you’d like to understand more about the standards of versioning used by many open source projects. But we should underscore that our practices are inspired by these schemes and are somewhat less regimented. Finally, know that other maintainers follow different philosophies on how to manage the package version number.</p>
</section><section id="sec-lifecycle-breaking-change-definition" class="level2" data-number="21.4"><h2 data-number="21.4" class="anchored" data-anchor-id="sec-lifecycle-breaking-change-definition">
<span class="header-section-number">21.4</span> Backward compatibility and breaking change</h2>
<p>The version number of your package is always increasing, but it’s more than just an incrementing counter – the way the number changes with each release can convey information about the nature of the changes. The transition from 0.3.1 to 0.3.2, which is a patch release, has a very different vibe from the transition from 0.3.2 to 1.0.0, which is a major release. A package version number can also convey information about where the package is in its lifecycle. For example, the version 1.0.0 often signals that the public interface of a package is considered stable.</p>
<p>How do you decide which type of release to make, i.e.&nbsp;which component(s) of the version should you increment? A key concept is whether the associated changes are backward compatible, meaning that pre-existing code will still “work” with the new version. We put “work” in quotes, because this designation is open to a certain amount of interpretation. A hardliner might take this to mean “the code works in exactly the same way, in all contexts, for all inputs”. A more pragmatic interpretation is that “the code still works, but could produce a different result in some edge cases”. A change that is not backward compatible is often described as a <em>breaking</em> change. Here we’re going to talk about how to assess whether a change is breaking. In <a href="#sec-lifecycle-breaking-change-pros-cons" class="quarto-xref"><span>Section 21.6</span></a> we’ll talk about how to decide if a breaking change is worth it.</p>
<p>In practice, backward compatibility is not a clear-cut distinction. It is typical to assess the impact of a change from a few angles:</p>
<ul>
<li><p>Degree of change in behaviour. The most extreme is to make something that used to be possible into an error, i.e.&nbsp;impossible.</p></li>
<li><p>How the changes fit into the design of the package. A change to low-level infrastructure, such as a utility that gets called in all user-facing functions, is more fraught than a change that only affects one parameter of a single function.</p></li>
<li><p>How much existing usage is affected. This is a combination of how many of your users will perceive the change and how many existing users there are to begin with.</p></li>
</ul>
<p>Here are some concrete examples of breaking change:</p>
<ul>
<li><p>Removing a function</p></li>
<li><p>Removing an argument</p></li>
<li><p>Narrowing the set of valid inputs to a function</p></li>
</ul>
<p>Conversely, these are usually not considered breaking:</p>
<ul>
<li><p>Adding a function. Caveat: there’s a small chance this could introduce a conflict in user code.</p></li>
<li><p>Adding an argument. Caveat: this could be breaking for some usage, e.g.&nbsp;if a user is relying on position-based argument matching. This also requires some care in a function that accepts <code>…</code>.</p></li>
<li><p>Increasing the set of valid inputs.</p></li>
<li><p>Changing the text of a print method or error. Caveat: This can be breaking if other packages depend on yours in fragile ways, such as building logic or a test that relies on an error message from your package.</p></li>
<li><p>Fixing a bug. Caveat: It really can happen that users write code that “depends” on a bug. Sometimes such code was flawed from the beginning, but the problem went undetected until you fixed your bug. Other times this surfaces code that uses your package in an unexpected way, i.e.&nbsp;it’s not necessarily <em>wrong</em>, but neither is it <em>right</em>.</p></li>
</ul>
<p>If reasoning about code was a reliable way to assess how it will work in real life, the world wouldn’t have so much buggy software. The best way to gauge the consequences of a change in your package is to try it and see what happens. In addition to running your own tests, you can also run the tests of your reverse dependencies and see if your proposed change breaks anything. The tidyverse team has a fairly extensive set of tools for running so-called reverse dependency checks (<a href="release.html#sec-release-revdep-checks" class="quarto-xref"><span>Section 22.5</span></a>), where we run <code>R CMD check</code> on all the packages that depend on ours. Sometimes we use this infrastructure to study the impact of a potential change, i.e.&nbsp;reverse dependency checks can be used to guide development, not only as a last-minute, pre-release check. This leads to yet another, deeply pragmatic definition of a breaking change:</p>
<blockquote class="blockquote">
<p>A change is breaking if it causes a CRAN package that was previously passing <code>R CMD check</code> to now fail AND the package’s original usage and behavior is correct.</p>
</blockquote>
<p>This is obviously a narrow and incomplete definition of breaking change, but at least it’s relatively easy to get solid data.</p>
<p>Hopefully we’ve made the point that backward compatibility is not always a clearcut distinction. But hopefully we’ve also provided plenty of concrete criteria to consider when thinking about whether a change could break someone else’s code.</p>
</section><section id="sec-lifecycle-release-type" class="level2" data-number="21.5"><h2 data-number="21.5" class="anchored" data-anchor-id="sec-lifecycle-release-type">
<span class="header-section-number">21.5</span> Major vs minor vs patch release</h2>
<p>Recall that a version number will have one of these forms, if you’re following the conventions described in <a href="#sec-lifecycle-version-number-tidyverse" class="quarto-xref"><span>Section 21.3</span></a>:</p>
<pre class="text"><code>&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;        # released version
&lt;major&gt;.&lt;minor&gt;.&lt;patch&gt;.&lt;dev&gt;  # in-development version</code></pre>
<p>If the current package version is <code>0.8.1.9000</code>, here’s our advice on how to pick the version number for the next release:</p>
<ul>
<li><p>Increment <code>patch</code>, e.g.&nbsp;<code>0.8.2</code> for a <strong>patch release</strong>: you’ve fixed bugs, but you haven’t added any significant new features and there are no breaking changes. For example, if we discover a show-stopping bug shortly after a release, we would make a quick patch release with the fix. Most releases will have a patch number of 0.</p></li>
<li><p>Increment <code>minor</code>, e.g.&nbsp;<code>0.9.0</code>, for a <strong>minor release</strong>. A minor release can include bug fixes, new features, and changes that are backward compatible<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. This is the most common type of release. It’s perfectly fine to have so many minor releases that you need to use two (or even three!) digits, e.g.&nbsp;<code>1.17.0</code>.</p></li>
<li><p>Increment <code>major</code>, e.g.&nbsp;<code>1.0.0</code>, for a <strong>major release</strong>. This is the most appropriate time to make changes that are not backward compatible and that are likely to affect many users. The <code>1.0.0</code> release has special significance and typically indicates that your package is feature complete with a stable API.</p></li>
</ul>
<p>The trickiest decision you are likely to face is whether a change is “breaking” enough to deserve a major release. For example, if you make an API-incompatible change to a rarely-used part of your code, it may not make sense to increase the major number. But if you fix a bug that many people depend on (it happens!), it will feel like a breaking change to those folks. It’s conceivable that such a bug fix could merit a major release.</p>
<p>We’re mostly dwelling on breaking change, but let’s not forget that sometimes you also add exciting new features to your package. From a marketing perspective, you probably want to save these for a major release, because your users are more likely to learn about the new goodies, from reading a blog post or <code>NEWS</code>.</p>
<p>Here are a few tidyverse blog posts that have accompanied different types of package releases:</p>
<ul>
<li><p>Major release: <a href="https://www.tidyverse.org/blog/2020/06/dplyr-1-0-0/">dplyr 1.0.0</a>, <a href="https://www.tidyverse.org/blog/2022/12/purrr-1-0-0/">purrr 1.0.0</a>, <a href="https://www.tidyverse.org/blog/2021/12/pkgdown-2-0-0/">pkgdown 2.0.0</a>, <a href="https://www.tidyverse.org/blog/2021/07/readr-2-0-0/">readr 2.0.0</a></p></li>
<li><p>Minor release: <a href="https://www.tidyverse.org/blog/2022/12/stringr-1-5-0/">stringr 1.5.0</a>, <a href="https://www.tidyverse.org/blog/2022/11/ggplot2-3-4-0/">ggplot2 3.4.0</a></p></li>
<li><p>Patch release: These are usually not considered worthy of a blog post.</p></li>
</ul>
<section id="package-version-mechanics" class="level3" data-number="21.5.1"><h3 data-number="21.5.1" class="anchored" data-anchor-id="package-version-mechanics">
<span class="header-section-number">21.5.1</span> Package version mechanics</h3>
<p>Your package should start with version number <code>0.0.0.9000</code>. <code><a href="https://usethis.r-lib.org/reference/create_package.html">usethis::create_package()</a></code> starts with this version, by default.</p>
<p>From that point on, you can use <code><a href="https://usethis.r-lib.org/reference/use_version.html">usethis::use_version()</a></code> to increment the package version. When called interactively, with no argument, it presents a helpful menu:</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_version.html">use_version</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Current version is 0.1.</span></span>
<span><span class="co">#&gt; What should the new version be? (0 to exit) </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1: major --&gt; 1.0</span></span>
<span><span class="co">#&gt; 2: minor --&gt; 0.2</span></span>
<span><span class="co">#&gt; 3: patch --&gt; 0.1.1</span></span>
<span><span class="co">#&gt; 4:   dev --&gt; 0.1.0.9000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Selection: </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition to incrementing <code>Version</code> in <code>DESCRIPTION</code> (<a href="description.html" class="quarto-xref"><span>Chapter 9</span></a>), <code>use_version()</code> also adds a new heading in <code>NEWS.md</code> (<a href="other-markdown.html#sec-news" class="quarto-xref"><span>Section 18.2</span></a>).</p>
</section></section><section id="sec-lifecycle-breaking-change-pros-cons" class="level2" data-number="21.6"><h2 data-number="21.6" class="anchored" data-anchor-id="sec-lifecycle-breaking-change-pros-cons">
<span class="header-section-number">21.6</span> Pros and cons of breaking change</h2>
<p>The big difference between major and minor releases is whether or not the code is backward compatible. In the general software world, the idea is that a major release signals to users that it may contain breaking changes and they should only upgrade when they have the capacity to deal with any issues that emerge.</p>
<p>Reality is a bit different in the R community, because of the way most users manage package installation. If we’re being honest, most R users don’t manage package versions in a very intentional way. Given the way <code><a href="https://rdrr.io/r/utils/update.packages.html">update.packages()</a></code> and <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code> work, it’s quite easy to upgrade a package to a new major version without really meaning to, especially for dependencies of the target package. This, in turn, can lead to unexpected exposure to breaking changes in code that previously worked. This unpleasantness has implications both for users and for maintainers.</p>
<p>If it’s important to protect a data product against change in its R package dependencies, we recommend the use of a project-specific package library. In particular, we like to implement this approach using the <a href="https://rstudio.github.io/renv/">renv package</a>. This supports a lifestyle where a user’s default package library is managed in the usual, somewhat haphazard way. But any project that has a specific, higher requirement for reproducibility is managed with renv. This keeps package updates triggered by work in project A from breaking the code in project B and also helps with collaboration and deployment.</p>
<p>We suspect that project-specific libraries and tools like renv are currently under-utilized in the R world. That is, lots of R users still use just one package library. Therefore, package maintainers still need to exercise considerable caution and care when they introduce breaking changes, regardless of what’s happening with the version number. In <a href="#sec-lifecycle-stages-and-package" class="quarto-xref"><span>Section 21.7</span></a>, we describe how tidyverse packages approach this, supported by tools in the lifecycle package.</p>
<p>As with dependencies (<a href="dependencies-mindset-background.html#sec-dependencies-pros-cons" class="quarto-xref"><span>Section 10.1</span></a>), we find that extremism isn’t a very productive stance. Extreme resistance to breaking change puts a significant drag on ongoing development and maintenance. Backward compatible code tends to be harder to work with because of the need to maintain multiple paths to support functionality from previous versions. The harder you strive to maintain backward compatibility, the harder it is to develop new features or fix old mistakes. This, in turn, can discourage adoption by new users and can make it harder to recruit new contributors. On the other hand, if you constantly make breaking changes, users will become very frustrated with your package and will decide they’re better off without it. Find a happy medium. Be concerned about backward compatibility, but don’t let it paralyze you.</p>
<p>The importance of backward compatibility is directly proportional to the number of people using your package: you are trading your time and pain for that of your users. There are good reasons to make backward incompatible changes. Once you’ve decided it’s necessary, your main priority is to use a humane process that is respectful of your users.</p>
</section><section id="sec-lifecycle-stages-and-package" class="level2" data-number="21.7"><h2 data-number="21.7" class="anchored" data-anchor-id="sec-lifecycle-stages-and-package">
<span class="header-section-number">21.7</span> Lifecycle stages and supporting tools</h2>
<p>The tidyverse team’s approach to package evolution has become more structured and deliberate over the years. The associated tooling and documentation lives in the lifecycle package (<a href="https://lifecycle.r-lib.org/index.html">lifecycle.r-lib.org</a>). The approach relies on two major components:</p>
<ul>
<li><p>Lifecycle stages, which can be applied at different levels, i.e.&nbsp;to an individual argument or function or to an entire package.</p></li>
<li><p>Conventions and functions to use when transitioning a function from one lifecycle stage to another. The deprecation process is the one that demands the most care.</p></li>
</ul>
<p>We won’t duplicate too much of the lifecycle documentation here. Instead, we highlight the general principles of lifecycle management and present specific examples of successful lifecycle “moves”.</p>
<section id="lifecycle-stages-and-badges" class="level3" data-number="21.7.1"><h3 data-number="21.7.1" class="anchored" data-anchor-id="lifecycle-stages-and-badges">
<span class="header-section-number">21.7.1</span> Lifecycle stages and badges</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-lifecycle-stages" class="quarto-float quarto-figure quarto-figure-center anchored" alt="A diagram showing the transitions between the four main stages: experimental can become stable and stable can become deprecated or superseded.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-lifecycle-stages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="diagrams/lifecycle.svg" class="img-fluid figure-img" style="width:75.0%" alt="A diagram showing the transitions between the four main stages: experimental can become stable and stable can become deprecated or superseded.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lifecycle-stages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21.1: The four primary stages of the tidyverse lifecycle: stable, deprecated, superseded, and experimental.
</figcaption></figure>
</div>
</div>
</div>
<p>The four lifecycle stages are:</p>
<ul>
<li><p>Stable. This is the default stage and signals that users should feel comfortable relying on a function or package. Breaking changes should be rare and should happen gradually, giving users sufficient time and guidance to adapt their usage.</p></li>
<li><p>Experimental. This is appropriate when a function is first introduced and the maintainer reserves the right to change it without much of a deprecation process. This is the implied stage for any package with a major version of <code>0</code>, i.e.&nbsp;that hasn’t had a <code>1.0.0</code> release yet.</p></li>
<li><p>Deprecated. This applies to functionality that is slated for removal. Initially, it still works, but triggers a deprecation warning with information about preferred alternatives. After a suitable amount of time and with an appropriate version change, such functions are typically removed.</p></li>
<li><p>Superseded. This is a softer version of deprecated, where legacy functionality is preserved as if in a time capsule. Superseded functions receive only minimal maintenance, such as critical bug fixes.</p></li>
</ul>
<p>You can get much more detail in <code><a href="https://lifecycle.r-lib.org/articles/stages.html">vignette("stages", package = "lifecycle")</a></code>.</p>
<p>The lifecycle stage is often communicated through a badge. If you’d like to use lifecycle badges, call <code><a href="https://usethis.r-lib.org/reference/use_lifecycle.html">usethis::use_lifecycle()</a></code> to do some one-time setup:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_lifecycle.html">use_lifecycle</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ Adding lifecycle to 'Imports' field in DESCRIPTION.</span></span>
<span><span class="co">#&gt; ☐ Refer to functions with `lifecycle::fun()`.</span></span>
<span><span class="co">#&gt; ✔ Adding "@importFrom lifecycle deprecated" to</span></span>
<span><span class="co">#&gt;   'R/somepackage-package.R'.</span></span>
<span><span class="co">#&gt; ✔ Writing 'NAMESPACE'.</span></span>
<span><span class="co">#&gt; ✔ Creating 'man/figures/'.</span></span>
<span><span class="co">#&gt; ✔ Copied SVG badges to 'man/figures/'.</span></span>
<span><span class="co">#&gt; ☐ Add badges in documentation topics by inserting a line like this:</span></span>
<span><span class="co">#&gt;   #' `r lifecycle::badge('experimental')`</span></span>
<span><span class="co">#&gt;   #' `r lifecycle::badge('superseded')`</span></span>
<span><span class="co">#&gt;   #' `r lifecycle::badge('deprecated')`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This leaves you in a position to use lifecycle badges in help topics and to use lifecycle functions, as described in the remainder of this section.</p>
<p>For a function, include the badge in its <code>@description</code> block. Here’s how we indicate that <code><a href="https://dplyr.tidyverse.org/reference/top_n.html">dplyr::top_n()</a></code> is superseded:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' Select top (or bottom) n rows (by value)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description</span></span>
<span><span class="co">#' `r lifecycle::badge("superseded")`</span></span>
<span><span class="co">#' `top_n()` has been superseded in favour of ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For a function argument, include the badge in the <code>@param</code> tag. Here’s how the deprecation of <code>readr::write_file(path =)</code> is documented:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @param path `r lifecycle::badge("deprecated")` Use the `file` argument</span></span>
<span><span class="co">#'   instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Call <code><a href="https://usethis.r-lib.org/reference/badges.html">usethis::use_lifecycle_badge()</a></code> if you want to use a badge in <code>README</code> to indicate the lifecycle of an entire package (<a href="other-markdown.html#sec-readme" class="quarto-xref"><span>Section 18.1</span></a>).</p>
<p>If the lifecycle of a package is stable, it’s not really necessary to use a badge, since that is the assumed default stage. Similarly, we typically only use a badge for a function if its stage differs from that of the associated package and likewise for an argument and the associated function.</p>
</section><section id="deprecating-a-function" class="level3" data-number="21.7.2"><h3 data-number="21.7.2" class="anchored" data-anchor-id="deprecating-a-function">
<span class="header-section-number">21.7.2</span> Deprecating a function</h3>
<p>If you’re going to remove or make significant changes to a function, it’s usually best to do so in phases. Deprecation is a general term for the situation where something is explicitly discouraged, but it has not yet been removed. Various deprecation scenarios are explored in <code><a href="https://lifecycle.r-lib.org/articles/communicate.html">vignette("communicate", package = "lifecycle")</a></code>; we’re just going to cover the main idea here.</p>
<p>The <code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_warn()</a></code> function can be used inside a function to inform your user that they’re using a deprecated feature and, ideally, to let them know about the preferred alternative. In this example, the <code>plus3()</code> function is being replaced by <code>add3()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># new function</span></span>
<span><span class="va">add3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># old function</span></span>
<span><span class="va">plus3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.0.0"</span>, <span class="st">"plus3()"</span>, <span class="st">"add3()"</span><span class="op">)</span></span>
<span>  <span class="fu">add3</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plus3</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `plus3()` was deprecated in somepackage 1.0.0.</span></span>
<span><span class="co">#&gt; ℹ Please use `add3()` instead.</span></span>
<span><span class="co">#&gt; [1] 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, a user who calls <code>plus3()</code> sees a warning explaining that the function has a new name, but we go ahead and call <code>add3()</code> with their inputs. Pre-existing code still “works”. In some future major release, <code>plus3()</code> could be removed entirely.</p>
<p><code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_warn()</a></code> and friends have a few features that are worth highlighting:</p>
<ul>
<li><p>The warning message is built up from inputs like <code>when</code>, <code>what</code>, <code>with</code>, and <code>details</code>, which gives deprecation warnings a predictable form across different functions, packages, and time. The intent is to reduce the cognitive load for users who may already be somewhat stressed.</p></li>
<li><p>By default, a specific warning is only issued once every 8 hours, in an effort to cause just the right amount of aggravation. The goal is to be just annoying enough to motivate the user to update their code before the function or argument goes away, but not so annoying that they fling their computer into the sea. Near the end of the deprecation process, the <code>always</code> argument can be set to <code>TRUE</code> to warn on every call.</p></li>
<li><p>If you use <code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_soft()</a></code> (instead of <code>deprecate_warn()</code>), a warning is only issued if the person reading it is the one who can actually do something about it, i.e.&nbsp;update the offending code. If a user calls a deprecated function indirectly, i.e.&nbsp;because they are using a package that’s using a deprecated function, by default that user doesn’t get a warning. (But the maintainer of the guilty package will see these warnings in their test results.)</p></li>
</ul>
<p>Here’s a hypothetical schedule for removing a function <code>fun()</code>:</p>
<ul>
<li><p>Package version <code>1.5.0</code>: <code>fun()</code> exists. The lifecycle stage of the package is stable, as indicated by its post-<code>1.0.0</code> version number and, perhaps, a package-level badge. The lifecycle stage of <code>fun()</code> is also stable, by extension, since it hasn’t been specifically marked as experimental.</p></li>
<li>
<p>Package version <code>1.6.0</code>: The deprecation process of <code>fun()</code> begins. We insert a badge in its help topic:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#' @description</span></span>
<span><span class="co">#' `r lifecycle::badge("deprecated")`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the body of <code>fun()</code>, we add a call to <code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_warn()</a></code> to inform users about the situation. Otherwise, <code>fun()</code> still works as it always has.</p>
</li>
<li><p>Package version <code>1.7.0</code> or <code>2.0.0</code>: <code>fun()</code> is removed. Whether this happens in a minor or major release will depend on the context, i.e.&nbsp;how widely used this package and function are.</p></li>
</ul>
<p>If you’re using base R only, the <code><a href="https://rdrr.io/r/base/Deprecated.html">.Deprecated()</a></code> and <code><a href="https://rdrr.io/r/base/Defunct.html">.Defunct()</a></code> functions are the closest substitutes for <code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_warn()</a></code> and friends.</p>
</section><section id="deprecating-an-argument" class="level3" data-number="21.7.3"><h3 data-number="21.7.3" class="anchored" data-anchor-id="deprecating-an-argument">
<span class="header-section-number">21.7.3</span> Deprecating an argument</h3>
<p><code><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">lifecycle::deprecate_warn()</a></code> is also useful when deprecating an argument. In this case, it’s also handy to use <code><a href="https://lifecycle.r-lib.org/reference/deprecated.html">lifecycle::deprecated()</a></code> as the default value for the deprecated argument. Here we continue an example from above, i.e.&nbsp;the switch from <code>path</code> to <code>file</code> in <code><a href="https://readr.tidyverse.org/reference/read_file.html">readr::write_file()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">write_file</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>                       <span class="va">file</span>,</span>
<span>                       <span class="va">append</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                       <span class="va">path</span> <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu">is_present</span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span><span class="st">"1.4.0"</span>, <span class="st">"write_file(path)"</span>, <span class="st">"write_file(file)"</span><span class="op">)</span></span>
<span>    <span class="va">file</span> <span class="op">&lt;-</span> <span class="va">path</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s what a user sees if they use the deprecated argument:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html">write_file</a></span><span class="op">(</span><span class="st">"hi"</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="st">"lifecycle-demo-"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The `path` argument of `write_file()` is deprecated as of readr</span></span>
<span><span class="co">#&gt; 1.4.0.</span></span>
<span><span class="co">#&gt; ℹ Please use the `file` argument instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The use of <code>deprecated()</code> as the default accomplishes two things. First, if the user reads the documentation, this is a strong signal that an argument is deprecated. But <code>deprecated()</code> also has benefits for the package maintainer. Inside the affected function, you can use <code><a href="https://lifecycle.r-lib.org/reference/deprecated.html">lifecycle::is_present()</a></code> to determine if the user has specified the deprecated argument and proceed accordingly, as shown above.</p>
<p>If you’re using base R only, the <code><a href="https://rdrr.io/r/base/missing.html">missing()</a></code> function has substantial overlap with <code><a href="https://lifecycle.r-lib.org/reference/deprecated.html">lifecycle::is_present()</a></code>, although it can be trickier to finesse issues around default values.</p>
</section><section id="deprecation-helpers" class="level3" data-number="21.7.4"><h3 data-number="21.7.4" class="anchored" data-anchor-id="deprecation-helpers">
<span class="header-section-number">21.7.4</span> Deprecation helpers</h3>
<p>Sometimes a deprecation affects code in multiple places and it’s clunky to inline the full logic everywhere. In this case, you might create an internal helper to centralize the deprecation logic.</p>
<p>This happened in googledrive, when we changed how to control the package’s verbosity. The original design let the user specify this in every single function, via the <code>verbose = TRUE/FALSE</code> argument. Later, we decided it made more sense to use a global option to control verbosity at the package level. This is a case of (eventually) removing an argument, but it affects practically every single function in the package. Here’s what a typical function looks like after starting the deprecation process:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">drive_publish</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span>, <span class="va">...</span>, <span class="va">verbose</span> <span class="op">=</span> <span class="fu">deprecated</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">warn_for_verbose</span><span class="op">(</span><span class="va">verbose</span><span class="op">)</span></span>
<span>  <span class="co"># rest of the function ...</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note the use of <code>verbose = deprecated()</code>. Here’s a slightly simplified version of <code>warn_for_verbose()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">warn_for_verbose</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">verbose</span> <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                             <span class="va">env</span> <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html">caller_env</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                             <span class="va">user_env</span> <span class="op">=</span> <span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/stack.html">caller_env</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This function is not meant to be called directly, so don't worry about its</span></span>
<span>  <span class="co"># default of `verbose = TRUE`.</span></span>
<span>  <span class="co"># In authentic, indirect usage of this helper, this picks up on whether</span></span>
<span>  <span class="co"># `verbose` was present in the **user's** call to the calling function.</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html">is_present</a></span><span class="op">(</span><span class="va">verbose</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">verbose</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecate_soft.html">deprecate_warn</a></span><span class="op">(</span></span>
<span>    when <span class="op">=</span> <span class="st">"2.0.0"</span>,</span>
<span>    what <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="st">"The `verbose` argument"</span><span class="op">)</span>,</span>
<span>    details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"Set `options(googledrive_quiet = TRUE)` to suppress all googledrive messages."</span>,</span>
<span>      <span class="st">"For finer control, use `local_drive_quiet()` or `with_drive_quiet()`."</span>,</span>
<span>      <span class="st">"googledrive's `verbose` argument will be removed in the future."</span></span>
<span>    <span class="op">)</span>,</span>
<span>    user_env <span class="op">=</span> <span class="va">user_env</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># only set the option during authentic, indirect usage</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">env</span>, <span class="fu">global_env</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">local_drive_quiet</span><span class="op">(</span>env <span class="op">=</span> <span class="va">env</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The user calls a function, such as <code>drive_publish()</code>, which then calls <code>warn_for_verbose()</code>. If the user leaves <code>verbose</code> unspecified or if they request <code>verbose = TRUE</code> (default behavior), <code>warn_for_verbose()</code> does nothing. But if they explicitly ask for <code>verbose = FALSE</code>, we throw a warning with advice on the preferred way to suppress googledrive’s messaging. We also go ahead and honor their wishes for the time being, via the call to <code><a href="https://googledrive.tidyverse.org/reference/googledrive-configuration.html">googledrive::local_drive_quiet()</a></code>. In the next major release, the <code>verbose</code> argument can be removed everywhere and this helper can be deleted.</p>
</section><section id="dealing-with-change-in-a-dependency" class="level3" data-number="21.7.5"><h3 data-number="21.7.5" class="anchored" data-anchor-id="dealing-with-change-in-a-dependency">
<span class="header-section-number">21.7.5</span> Dealing with change in a dependency</h3>
<p>What if you want to use functionality in a new version of another package? Or the less happy version: what if changes in another package are going to break your package? There are a few possible scenarios, depending on whether the other package has been released and the experience you want for your users. We’ll start with the simple, happier case of using features newly available in a dependency.</p>
<p>If the other package has already been released, you could bump the minimum version you declare for it in <code>DESCRIPTION</code> and use the new functionality unconditionally. This also means that users who update your package will be forced to update the other package, which you should at least contemplate. Note, also, that this only works for a dependency in <code>Imports</code>. While it’s a good idea to record a minimum version for a suggested package, it’s not generally enforced the same as for <code>Imports</code>.</p>
<p>If you don’t want to require your users to update this other package, you could make your package work with both new and old versions. This means you’ll check its version at run-time and proceed accordingly. Here is a sketch of how that might look in the context of an existing or new function:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">your_existing_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">cool_new_feature</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span><span class="op">(</span><span class="va">cool_new_feature</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"otherpkg"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">"1.0.0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"otherpkg &gt;= 1.0.0 is needed for cool_new_feature"</span><span class="op">)</span></span>
<span>    <span class="va">cool_new_feature</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># the rest of the function</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">your_new_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"otherpkg"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="st">"1.0.0"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"otherpkg &gt;= 1.0.0 needed for this function."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># the rest of the function</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, this would also be a great place to use <code><a href="https://rlang.r-lib.org/reference/is_installed.html">rlang::is_installed()</a></code> and <code><a href="https://rlang.r-lib.org/reference/is_installed.html">rlang::check_installed()</a></code> with the <code>version</code> argument (see examples of usage in <a href="dependencies-in-practice.html#sec-dependencies-in-suggests-r-code" class="quarto-xref"><span>Section 11.5.1</span></a>).</p>
<p>This approach can also be adapted if you’re responding to not-yet-released changes that are coming soon in one of your dependencies. It’s helpful to have a version of your package that works both before and after the change. This allows you to release your package at any time, even before the other package. Sometimes you can refactor your code to make it work with either version of the other package, in which case you don’t need to condition on the other package’s version at all. But sometimes you might really need different code for the two versions. Consider this example:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">your_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"otherpkg"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"1.3.9000"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">otherpkg</span><span class="fu">::</span><span class="fu">their_new_function</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu">otherpkg</span><span class="fu">::</span><span class="fu">their_old_function</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># the rest of the function</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The hypothetical minimum version of <code>1.3.9000</code> suggests a case where the development version of otherpkg already has the change you’re responding to, which is a new function in this case. Assuming <code>their_new_function()</code> doesn’t exist in the latest release of otherpkg, you’ll get a note from <code>R CMD check</code> stating that <code>their_new_function()</code> doesn’t exist in otherpkg’s namespace. If you’re submitting such a version to CRAN, you can explain that you’re doing this for the sake of backward and forward compatibility with otherpkg and they are likely to be satisfied.</p>
</section><section id="superseding-a-function" class="level3" data-number="21.7.6"><h3 data-number="21.7.6" class="anchored" data-anchor-id="superseding-a-function">
<span class="header-section-number">21.7.6</span> Superseding a function</h3>
<p>The last lifecycle stage that we’ll talk about is superseded. This is appropriate when you feel like a function is no longer the preferred solution to a problem, but it has enough usage and history that you don’t want to initiate the process of removing it. Good examples of this are <code><a href="https://tidyr.tidyverse.org/reference/spread.html">tidyr::spread()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/gather.html">tidyr::gather()</a></code>. Those functions have been superseded by <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">tidyr::pivot_wider()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">tidyr::pivot_longer()</a></code>. But some users still prefer the older functions and it’s likely that they’ve been used a lot in projects that are not under active development. Thus <code>spread()</code> and <code>gather()</code> are marked as superseded, they don’t receive any new innovations, but they aren’t at risk of removal.</p>
<p>A related phenomenon is when you want to change some aspect of a package, but you also want to give existing users a way to opt-in to the legacy behaviour. The idea is to provide users a band-aid they can apply to get old code working quickly, until they have the bandwidth to do a more thorough update (which might not ever happen, in some cases). Here are some examples where legacy behaviour was preserved for users who opt-in:</p>
<ul>
<li><p>In tidyr 1.0.0, the interface of <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::nest()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/unnest.html">tidyr::unnest()</a></code> changed. Most authentic usage can be translated to the new syntax, which tidyr does automatically, along with conveying the preferred modern syntax via a warning. But the old interface remains available via <code><a href="https://tidyr.tidyverse.org/reference/nest_legacy.html">tidyr::nest_legacy()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/nest_legacy.html">tidyr::unnest_legacy()</a></code>, which were marked superseded upon creation.</p></li>
<li><p>dplyr 1.1.0 takes advantage of a much faster algorithm for computing groups. But this speedier method also sorts the groups with respect to the C locale, whereas previously the system locale was used. The global option <code>dplyr.legacy_locale</code> allows a user to explicitly request the legacy behaviour.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p></li>
<li><p>The tidyverse packages have been standardizing on a common approach to name repair, which is implemented in <code><a href="https://vctrs.r-lib.org/reference/vec_as_names.html">vctrs::vec_as_names()</a></code>. The vctrs package also offers <code><a href="https://vctrs.r-lib.org/reference/vec_as_names_legacy.html">vctrs::vec_as_names_legacy()</a></code>, which makes it easier to get names repaired with older strategies previously used in packages like tibble, tidyr, and readxl.</p></li>
<li><p>readr 2.0.0 introduced a so-called second edition, marking the switch to a backend provided by the vroom package. Functions like <code>readr::with_edition(1, ...)</code> and <code>readr::local_edition(1)</code> make it easier for a user to request first edition behaviour for a specific bit of code or for a specific script.</p></li>
</ul>


</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>It’s unusual for an initial release to be version 1.0.0, but remember that usethis was basically carved out of a very mature package (devtools).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>As with <code><a href="https://rdrr.io/r/base/numeric_version.html">package_version()</a></code>, in package code, you should use the <code><a href="https://rdrr.io/r/utils/packageDescription.html">utils::packageVersion()</a></code> form and list the utils package in <code>Imports</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>For some suitably pragmatic definition of “backward compatible”.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You can learn more about the analysis leading up to this change in <a href="https://github.com/tidyverse/tidyups/blob/main/006-dplyr-group-by-ordering.md" class="uri">https://github.com/tidyverse/tidyups/blob/main/006-dplyr-group-by-ordering.md</a>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/r-pkgs\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./software-development-practices.html" class="pagination-link" aria-label="Software development practices">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Software development practices</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./release.html" class="pagination-link" aria-label="Releasing to CRAN">
        <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Releasing to CRAN</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/hadley/r-pkgs/edit/main/lifecycle.Rmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/hadley/r-pkgs/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>